<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ValueSepUTxO.UTxO</title><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css'/><style>.github-fork-ribbon:before { background-color: #333; }</style><link rel="stylesheet" href="css/Agda.css"></head><body><a class='github-fork-ribbon'href='https://github.com/omelkonian/hoare-ledgers/tree/master/ValueSepUTxO/UTxO.agda'data-ribbon='Source code on Github' title='Source code on Github'>Source code on Github</a><pre class="Agda"><a id="1" class="Comment">----------------------------------------------</a>
<a id="48" class="Comment">-- ** Abstract definition for UTxO-based ledgers.</a>

<a id="99" class="Keyword">module</a> <a id="106" href="ValueSepUTxO.UTxO.html" class="Module">ValueSepUTxO.UTxO</a> <a id="124" class="Keyword">where</a>

<a id="131" class="Keyword">open</a> <a id="136" class="Keyword">import</a> <a id="143" href="Prelude.Init.html" class="Module">Prelude.Init</a><a id="155" class="Symbol">;</a> <a id="157" class="Keyword">open</a> <a id="162" href="Prelude.Init.html#504" class="Module">SetAsType</a>
<a id="172" class="Keyword">open</a> <a id="177" href="Prelude.Init.html#7118" class="Module">L.Mem</a>
<a id="183" class="Keyword">open</a> <a id="188" class="Keyword">import</a> <a id="195" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="211" class="Keyword">open</a> <a id="216" class="Keyword">import</a> <a id="223" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="237" class="Keyword">open</a> <a id="242" class="Keyword">import</a> <a id="249" href="Prelude.Decidable.html" class="Module">Prelude.Decidable</a>
<a id="267" class="Keyword">open</a> <a id="272" class="Keyword">import</a> <a id="279" href="Prelude.ToN.html" class="Module">Prelude.ToN</a>
<a id="291" class="Keyword">open</a> <a id="296" class="Keyword">import</a> <a id="303" href="Prelude.Lists.html" class="Module">Prelude.Lists</a> <a id="317" class="Keyword">hiding</a> <a id="324" class="Symbol">(</a><a id="325" href="Prelude.Lists.Mappings.html#697" class="Function">map↦</a><a id="329" class="Symbol">)</a>
<a id="331" class="Keyword">open</a> <a id="336" class="Keyword">import</a> <a id="343" href="Prelude.Lists.Dec.html" class="Module">Prelude.Lists.Dec</a>
<a id="361" class="Keyword">open</a> <a id="366" class="Keyword">import</a> <a id="373" href="Prelude.Functor.html" class="Module">Prelude.Functor</a>
<a id="389" class="Keyword">open</a> <a id="394" class="Keyword">import</a> <a id="401" href="Prelude.Applicative.html" class="Module">Prelude.Applicative</a>
<a id="421" class="Keyword">open</a> <a id="426" class="Keyword">import</a> <a id="433" href="Prelude.FromList.html" class="Module">Prelude.FromList</a><a id="449" class="Symbol">;</a> <a id="451" class="Keyword">open</a> <a id="456" class="Keyword">import</a> <a id="463" href="Prelude.ToList.html" class="Module">Prelude.ToList</a>
<a id="478" class="Keyword">open</a> <a id="483" class="Keyword">import</a> <a id="490" href="Prelude.Ord.html" class="Module">Prelude.Ord</a>
<a id="502" class="Keyword">open</a> <a id="507" class="Keyword">import</a> <a id="514" href="Prelude.Semigroup.html" class="Module">Prelude.Semigroup</a>
<a id="532" class="Keyword">open</a> <a id="537" class="Keyword">import</a> <a id="544" href="Prelude.Monoid.html" class="Module">Prelude.Monoid</a>

<a id="560" class="Keyword">open</a> <a id="565" class="Keyword">import</a> <a id="572" href="Prelude.Bags.html" class="Module">Prelude.Bags</a>
<a id="585" class="Keyword">instance</a>
  <a id="Sℕ"></a><a id="596" href="ValueSepUTxO.UTxO.html#596" class="Function">Sℕ</a>  <a id="600" class="Symbol">=</a> <a id="602" href="Prelude.Semigroup.html#4333" class="Function">Semigroup-ℕ-+</a><a id="615" class="Symbol">;</a> <a id="Sℕ⁺"></a><a id="617" href="ValueSepUTxO.UTxO.html#617" class="Function">Sℕ⁺</a> <a id="621" class="Symbol">=</a> <a id="623" href="Prelude.Semigroup.html#4626" class="Function">SemigroupLaws-ℕ-+</a>
  <a id="Mℕ"></a><a id="643" href="ValueSepUTxO.UTxO.html#643" class="Function">Mℕ</a>  <a id="647" class="Symbol">=</a> <a id="649" href="Prelude.Monoid.html#3120" class="Function">Monoid-ℕ-+</a><a id="659" class="Symbol">;</a>    <a id="Mℕ⁺"></a><a id="664" href="ValueSepUTxO.UTxO.html#664" class="Function">Mℕ⁺</a> <a id="668" class="Symbol">=</a> <a id="670" href="Prelude.Monoid.html#3191" class="Function">MonoidLaws-ℕ-+</a>

<a id="686" class="Keyword">open</a> <a id="691" class="Keyword">import</a> <a id="698" href="Common.html" class="Module">Common</a> <a id="705" class="Keyword">public</a>
<a id="TxOutputRef"></a><a id="712" href="ValueSepUTxO.UTxO.html#712" class="Function">TxOutputRef</a> <a id="724" class="Symbol">=</a> <a id="726" href="Common.html#593" class="Record">TxOutput</a>
<a id="735" class="Keyword">open</a> <a id="740" href="Common.html#1247" class="Module">CommonInfo</a> <a id="751" href="ValueSepUTxO.UTxO.html#712" class="Function">TxOutputRef</a> <a id="763" class="Keyword">public</a>

<a id="771" class="Comment">-- The state of a ledger maps addresses to a value.</a>

<a id="S"></a><a id="824" href="ValueSepUTxO.UTxO.html#824" class="Function">S</a> <a id="826" class="Symbol">:</a> <a id="828" href="Agda.Primitive.html#320" class="Primitive">Type</a>
<a id="833" href="ValueSepUTxO.UTxO.html#824" class="Function">S</a> <a id="835" class="Symbol">=</a> <a id="837" href="Prelude.Bags.AsLists.html#820" class="Record">Bag⟨</a> <a id="842" href="Common.html#593" class="Record">TxOutput</a> <a id="851" href="Prelude.Bags.AsLists.html#820" class="Record">⟩</a>

<a id="stxoTx"></a><a id="854" href="ValueSepUTxO.UTxO.html#854" class="Function">stxoTx</a> <a id="utxoTx"></a><a id="861" href="ValueSepUTxO.UTxO.html#861" class="Function">utxoTx</a> <a id="868" class="Symbol">:</a> <a id="870" href="Common.html#1452" class="Record">Tx</a> <a id="873" class="Symbol">→</a> <a id="875" href="ValueSepUTxO.UTxO.html#824" class="Function">S</a>
<a id="877" href="ValueSepUTxO.UTxO.html#854" class="Function">stxoTx</a> <a id="884" class="Symbol">=</a> <a id="886" href="Prelude.FromList.html#197" class="Field">fromList</a> <a id="895" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="897" href="Common.html#2104" class="Function">outputRefs</a>
<a id="908" href="ValueSepUTxO.UTxO.html#861" class="Function">utxoTx</a> <a id="915" class="Symbol">=</a> <a id="917" href="Prelude.FromList.html#197" class="Field">fromList</a> <a id="926" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="928" href="Common.html#1511" class="Field">outputs</a>

<a id="resolved"></a><a id="937" href="ValueSepUTxO.UTxO.html#937" class="Function">resolved</a> <a id="946" class="Symbol">:</a> <a id="948" class="Symbol">∀</a> <a id="950" href="ValueSepUTxO.UTxO.html#950" class="Bound">tx</a> <a id="953" class="Symbol">→</a> <a id="955" href="Common.html#2180" class="Function">Resolved</a> <a id="964" href="ValueSepUTxO.UTxO.html#950" class="Bound">tx</a>
<a id="967" href="ValueSepUTxO.UTxO.html#937" class="Function">resolved</a> <a id="976" class="Symbol">_</a> <a id="978" class="Symbol">{</a><a id="979" href="ValueSepUTxO.UTxO.html#979" class="Bound">r</a><a id="980" class="Symbol">}</a> <a id="982" class="Symbol">_</a> <a id="984" class="Symbol">=</a> <a id="986" href="ValueSepUTxO.UTxO.html#979" class="Bound">r</a>

<a id="989" class="Keyword">record</a> <a id="IsValidTx"></a><a id="996" href="ValueSepUTxO.UTxO.html#996" class="Record">IsValidTx</a> <a id="1006" class="Symbol">(</a><a id="1007" href="ValueSepUTxO.UTxO.html#1007" class="Bound">tx</a> <a id="1010" class="Symbol">:</a> <a id="1012" href="Common.html#1452" class="Record">Tx</a><a id="1014" class="Symbol">)</a> <a id="1016" class="Symbol">(</a><a id="1017" href="ValueSepUTxO.UTxO.html#1017" class="Bound">utxos</a> <a id="1023" class="Symbol">:</a> <a id="1025" href="ValueSepUTxO.UTxO.html#824" class="Function">S</a><a id="1026" class="Symbol">)</a> <a id="1028" class="Symbol">:</a> <a id="1030" href="Agda.Primitive.html#320" class="Primitive">Type</a> <a id="1035" class="Keyword">where</a>
  <a id="1043" class="Keyword">field</a>
    <a id="IsValidTx.validOutputRefs"></a><a id="1053" href="ValueSepUTxO.UTxO.html#1053" class="Field">validOutputRefs</a> <a id="1069" class="Symbol">:</a>
      <a id="1077" href="ValueSepUTxO.UTxO.html#854" class="Function">stxoTx</a> <a id="1084" href="ValueSepUTxO.UTxO.html#1007" class="Bound">tx</a> <a id="1087" href="Prelude.Bags.AsLists.html#3008" class="Function Operator">⊆ˢ</a> <a id="1090" href="ValueSepUTxO.UTxO.html#1017" class="Bound">utxos</a>

    <a id="IsValidTx.preservesValues"></a><a id="1101" href="ValueSepUTxO.UTxO.html#1101" class="Field">preservesValues</a> <a id="1117" class="Symbol">:</a>
      <a id="1125" href="ValueSepUTxO.UTxO.html#1007" class="Bound">tx</a> <a id="1128" class="Symbol">.</a><a id="1129" href="Common.html#1545" class="Field">forge</a> <a id="1135" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">+</a> <a id="1137" href="Common.html#514" class="Function">∑</a> <a id="1139" class="Symbol">(</a><a id="1140" href="ValueSepUTxO.UTxO.html#1007" class="Bound">tx</a> <a id="1143" class="Symbol">.</a><a id="1144" href="Common.html#1478" class="Field">inputs</a><a id="1150" class="Symbol">)</a> <a id="1152" class="Symbol">(</a><a id="1153" href="Common.html#642" class="Field">value</a> <a id="1159" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1161" href="Common.html#1326" class="Field">outputRef</a><a id="1170" class="Symbol">)</a> <a id="1172" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1174" href="Common.html#514" class="Function">∑</a> <a id="1176" class="Symbol">(</a><a id="1177" href="ValueSepUTxO.UTxO.html#1007" class="Bound">tx</a> <a id="1180" class="Symbol">.</a><a id="1181" href="Common.html#1511" class="Field">outputs</a><a id="1188" class="Symbol">)</a> <a id="1190" href="Common.html#642" class="Field">value</a>

  <a id="IsValidTx.txInfo"></a><a id="1199" href="ValueSepUTxO.UTxO.html#1199" class="Function">txInfo</a> <a id="1206" class="Symbol">=</a> <a id="1208" href="Common.html#2893" class="Function">mkTxInfo</a> <a id="1217" href="ValueSepUTxO.UTxO.html#1007" class="Bound">tx</a> <a id="1220" class="Symbol">(</a><a id="1221" href="ValueSepUTxO.UTxO.html#937" class="Function">resolved</a> <a id="1230" href="ValueSepUTxO.UTxO.html#1007" class="Bound">tx</a><a id="1232" class="Symbol">)</a>

  <a id="1237" class="Keyword">field</a>
    <a id="IsValidTx.allInputsValidate"></a><a id="1247" href="ValueSepUTxO.UTxO.html#1247" class="Field">allInputsValidate</a> <a id="1265" class="Symbol">:</a>
      <a id="1273" href="Common.html#3090" class="Function">∀[</a> <a id="1276" href="ValueSepUTxO.UTxO.html#1276" class="Bound">i</a> <a id="1278" href="Common.html#3090" class="Function">∈</a> <a id="1280" href="ValueSepUTxO.UTxO.html#1007" class="Bound">tx</a> <a id="1283" class="Symbol">.</a><a id="1284" href="Common.html#1478" class="Field">inputs</a> <a id="1291" href="Common.html#3090" class="Function">]</a>
        <a id="1301" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="1303" class="Symbol">(</a><a id="1304" href="ValueSepUTxO.UTxO.html#1276" class="Bound">i</a> <a id="1306" class="Symbol">.</a><a id="1307" href="Common.html#1360" class="Field">validator</a> <a id="1317" href="ValueSepUTxO.UTxO.html#1199" class="Function">txInfo</a> <a id="1324" class="Symbol">(</a><a id="1325" href="ValueSepUTxO.UTxO.html#1276" class="Bound">i</a> <a id="1327" class="Symbol">.</a><a id="1328" href="Common.html#1403" class="Field">redeemer</a><a id="1336" class="Symbol">))</a>

    <a id="IsValidTx.validateValidHashes"></a><a id="1344" href="ValueSepUTxO.UTxO.html#1344" class="Field">validateValidHashes</a> <a id="1364" class="Symbol">:</a>
      <a id="1372" href="Common.html#3090" class="Function">∀[</a> <a id="1375" href="ValueSepUTxO.UTxO.html#1375" class="Bound">i</a> <a id="1377" href="Common.html#3090" class="Function">∈</a> <a id="1379" href="ValueSepUTxO.UTxO.html#1007" class="Bound">tx</a> <a id="1382" class="Symbol">.</a><a id="1383" href="Common.html#1478" class="Field">inputs</a> <a id="1390" href="Common.html#3090" class="Function">]</a>
        <a id="1400" class="Symbol">(</a><a id="1401" href="ValueSepUTxO.UTxO.html#1375" class="Bound">i</a> <a id="1403" class="Symbol">.</a><a id="1404" href="Common.html#1326" class="Field">outputRef</a> <a id="1414" class="Symbol">.</a><a id="1415" href="Common.html#667" class="Field">address</a> <a id="1423" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1425" href="ValueSepUTxO.UTxO.html#1375" class="Bound">i</a> <a id="1427" class="Symbol">.</a><a id="1428" href="Common.html#1360" class="Field">validator</a> <a id="1438" href="Common.html#427" class="Postulate Operator">♯</a><a id="1439" class="Symbol">)</a>

<a id="1442" class="Keyword">open</a> <a id="1447" href="ValueSepUTxO.UTxO.html#996" class="Module">IsValidTx</a> <a id="1457" class="Keyword">public</a>

<a id="isValidTx?"></a><a id="1465" href="ValueSepUTxO.UTxO.html#1465" class="Function">isValidTx?</a> <a id="1476" class="Symbol">:</a> <a id="1478" class="Symbol">∀</a> <a id="1480" href="ValueSepUTxO.UTxO.html#1480" class="Bound">tx</a> <a id="1483" href="ValueSepUTxO.UTxO.html#1483" class="Bound">s</a> <a id="1485" class="Symbol">→</a> <a id="1487" href="Relation.Nullary.html#1520" class="Record">Dec</a> <a id="1491" class="Symbol">(</a><a id="1492" href="ValueSepUTxO.UTxO.html#996" class="Record">IsValidTx</a> <a id="1502" href="ValueSepUTxO.UTxO.html#1480" class="Bound">tx</a> <a id="1505" href="ValueSepUTxO.UTxO.html#1483" class="Bound">s</a><a id="1506" class="Symbol">)</a>
<a id="1508" href="ValueSepUTxO.UTxO.html#1465" class="Function">isValidTx?</a> <a id="1519" class="Symbol">_</a> <a id="1521" class="Symbol">_</a> <a id="1523" class="Keyword">with</a> <a id="1528" href="Prelude.Decidable.Core.html#166" class="Field">dec</a>
<a id="1532" class="Symbol">...</a> <a id="1536" class="Symbol">|</a> <a id="1538" href="Relation.Nullary.html#1694" class="InductiveConstructor">no</a> <a id="1541" href="ValueSepUTxO.UTxO.html#1541" class="Bound">¬p</a> <a id="1544" class="Symbol">=</a> <a id="1546" href="Relation.Nullary.html#1694" class="InductiveConstructor">no</a> <a id="1549" class="Symbol">(</a><a id="1550" href="ValueSepUTxO.UTxO.html#1541" class="Bound">¬p</a> <a id="1553" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1555" href="ValueSepUTxO.UTxO.html#1053" class="Field">validOutputRefs</a><a id="1570" class="Symbol">)</a>
<a id="1572" class="Symbol">...</a> <a id="1576" class="Symbol">|</a> <a id="1578" href="Relation.Nullary.html#1657" class="InductiveConstructor">yes</a> <a id="1582" href="ValueSepUTxO.UTxO.html#1582" class="Bound">vor</a> <a id="1586" class="Keyword">with</a> <a id="1591" href="Prelude.Decidable.Core.html#166" class="Field">dec</a>
<a id="1595" class="Symbol">...</a> <a id="1599" class="Symbol">|</a> <a id="1601" href="Relation.Nullary.html#1694" class="InductiveConstructor">no</a> <a id="1604" href="ValueSepUTxO.UTxO.html#1604" class="Bound">¬p</a> <a id="1607" class="Symbol">=</a> <a id="1609" href="Relation.Nullary.html#1694" class="InductiveConstructor">no</a> <a id="1612" class="Symbol">(</a><a id="1613" href="ValueSepUTxO.UTxO.html#1604" class="Bound">¬p</a> <a id="1616" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1618" href="ValueSepUTxO.UTxO.html#1101" class="Field">preservesValues</a><a id="1633" class="Symbol">)</a>
<a id="1635" class="Symbol">...</a> <a id="1639" class="Symbol">|</a> <a id="1641" href="Relation.Nullary.html#1657" class="InductiveConstructor">yes</a> <a id="1645" href="ValueSepUTxO.UTxO.html#1645" class="Bound">pv</a> <a id="1648" class="Keyword">with</a> <a id="1653" href="Prelude.Decidable.Core.html#166" class="Field">dec</a>
<a id="1657" class="Symbol">...</a> <a id="1661" class="Symbol">|</a> <a id="1663" href="Relation.Nullary.html#1694" class="InductiveConstructor">no</a> <a id="1666" href="ValueSepUTxO.UTxO.html#1666" class="Bound">¬p</a> <a id="1669" class="Symbol">=</a> <a id="1671" href="Relation.Nullary.html#1694" class="InductiveConstructor">no</a> <a id="1674" class="Symbol">(</a><a id="1675" href="ValueSepUTxO.UTxO.html#1666" class="Bound">¬p</a> <a id="1678" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1680" href="ValueSepUTxO.UTxO.html#1247" class="Field">allInputsValidate</a><a id="1697" class="Symbol">)</a>
<a id="1699" class="Symbol">...</a> <a id="1703" class="Symbol">|</a> <a id="1705" href="Relation.Nullary.html#1657" class="InductiveConstructor">yes</a> <a id="1709" href="ValueSepUTxO.UTxO.html#1709" class="Bound">aiv</a> <a id="1713" class="Keyword">with</a> <a id="1718" href="Prelude.Decidable.Core.html#166" class="Field">dec</a>
<a id="1722" class="Symbol">...</a> <a id="1726" class="Symbol">|</a> <a id="1728" href="Relation.Nullary.html#1694" class="InductiveConstructor">no</a> <a id="1731" href="ValueSepUTxO.UTxO.html#1731" class="Bound">¬p</a> <a id="1734" class="Symbol">=</a> <a id="1736" href="Relation.Nullary.html#1694" class="InductiveConstructor">no</a> <a id="1739" class="Symbol">(</a><a id="1740" href="ValueSepUTxO.UTxO.html#1731" class="Bound">¬p</a> <a id="1743" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1745" href="ValueSepUTxO.UTxO.html#1344" class="Field">validateValidHashes</a><a id="1764" class="Symbol">)</a>
<a id="1766" class="Symbol">...</a> <a id="1770" class="Symbol">|</a> <a id="1772" href="Relation.Nullary.html#1657" class="InductiveConstructor">yes</a> <a id="1776" href="ValueSepUTxO.UTxO.html#1776" class="Bound">vvh</a> <a id="1780" class="Symbol">=</a> <a id="1782" href="Relation.Nullary.html#1657" class="InductiveConstructor">yes</a> <a id="1786" class="Keyword">record</a>
  <a id="1795" class="Symbol">{</a> <a id="1797" href="ValueSepUTxO.UTxO.html#1053" class="Field">validOutputRefs</a> <a id="1813" class="Symbol">=</a> <a id="1815" class="Bound">vor</a>
  <a id="1821" class="Symbol">;</a> <a id="1823" href="ValueSepUTxO.UTxO.html#1101" class="Field">preservesValues</a> <a id="1839" class="Symbol">=</a> <a id="1841" class="Bound">pv</a>
  <a id="1846" class="Symbol">;</a> <a id="1848" href="ValueSepUTxO.UTxO.html#1247" class="Field">allInputsValidate</a> <a id="1866" class="Symbol">=</a> <a id="1868" class="Bound">aiv</a>
  <a id="1874" class="Symbol">;</a> <a id="1876" href="ValueSepUTxO.UTxO.html#1344" class="Field">validateValidHashes</a> <a id="1896" class="Symbol">=</a> <a id="1898" href="ValueSepUTxO.UTxO.html#1776" class="Bound">vvh</a> <a id="1902" class="Symbol">}</a>

<a id="isValidTx"></a><a id="1905" href="ValueSepUTxO.UTxO.html#1905" class="Function">isValidTx</a> <a id="1915" class="Symbol">:</a> <a id="1917" href="Common.html#1452" class="Record">Tx</a> <a id="1920" class="Symbol">→</a> <a id="1922" href="ValueSepUTxO.UTxO.html#824" class="Function">S</a> <a id="1924" class="Symbol">→</a> <a id="1926" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
<a id="1931" href="ValueSepUTxO.UTxO.html#1905" class="Function">isValidTx</a> <a id="1941" href="ValueSepUTxO.UTxO.html#1941" class="Bound">tx</a> <a id="1944" href="ValueSepUTxO.UTxO.html#1944" class="Bound">s</a> <a id="1946" class="Symbol">=</a> <a id="1948" href="Relation.Nullary.Decidable.Core.html#1321" class="Function Operator">⌊</a> <a id="1950" href="ValueSepUTxO.UTxO.html#1465" class="Function">isValidTx?</a> <a id="1961" href="ValueSepUTxO.UTxO.html#1941" class="Bound">tx</a> <a id="1964" href="ValueSepUTxO.UTxO.html#1944" class="Bound">s</a> <a id="1966" href="Relation.Nullary.Decidable.Core.html#1321" class="Function Operator">⌋</a>
</pre></body></html>