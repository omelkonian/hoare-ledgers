<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>UTxO.Ledger</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------</a>
<a id="44" class="Comment">-- ** Denotational &amp; operational semantics</a>

<a id="88" class="Keyword">module</a> <a id="95" href="UTxO.Ledger.html" class="Module">UTxO.Ledger</a> <a id="107" class="Keyword">where</a>

<a id="114" class="Keyword">open</a> <a id="119" class="Keyword">import</a> <a id="126" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="139" class="Keyword">open</a> <a id="144" class="Keyword">import</a> <a id="151" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="167" class="Keyword">open</a> <a id="172" class="Keyword">import</a> <a id="179" href="Prelude.Sets.html" class="Module">Prelude.Sets</a>
<a id="192" class="Keyword">open</a> <a id="197" class="Keyword">import</a> <a id="204" href="Prelude.Membership.html" class="Module">Prelude.Membership</a>
<a id="223" class="Keyword">open</a> <a id="228" class="Keyword">import</a> <a id="235" href="Prelude.ToList.html" class="Module">Prelude.ToList</a>
<a id="250" class="Keyword">open</a> <a id="255" class="Keyword">import</a> <a id="262" href="Prelude.FromList.html" class="Module">Prelude.FromList</a>

<a id="280" class="Keyword">open</a> <a id="285" class="Keyword">import</a> <a id="292" href="UTxO.UTxO.html" class="Module">UTxO.UTxO</a>

<a id="303" class="Comment">-- ** Denotational semantics</a>

<a id="333" class="Comment">-- The meaning of a transaction or a whole ledger will be denoted by state transformers,</a>
<a id="422" class="Comment">-- i.e. function from the current state to the updated one.</a>
<a id="Domain"></a><a id="482" href="UTxO.Ledger.html#482" class="Function">Domain</a> <a id="489" class="Symbol">=</a> <a id="491" href="UTxO.UTxO.html#2026" class="Function">S</a> <a id="493" class="Symbol">→</a> <a id="495" href="UTxO.UTxO.html#2026" class="Function">S</a>

<a id="498" class="Keyword">record</a> <a id="Denotable"></a><a id="505" href="UTxO.Ledger.html#505" class="Record">Denotable</a> <a id="515" class="Symbol">(</a><a id="516" href="UTxO.Ledger.html#516" class="Bound">A</a> <a id="518" class="Symbol">:</a> <a id="520" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="523" class="Symbol">)</a> <a id="525" class="Symbol">:</a> <a id="527" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="531" class="Keyword">where</a>
  <a id="539" class="Keyword">field</a> <a id="Denotable.⟦_⟧"></a><a id="545" href="UTxO.Ledger.html#545" class="Field Operator">⟦_⟧</a> <a id="549" class="Symbol">:</a> <a id="551" href="UTxO.Ledger.html#516" class="Bound">A</a> <a id="553" class="Symbol">→</a> <a id="555" href="UTxO.Ledger.html#482" class="Function">Domain</a>
<a id="562" class="Keyword">open</a> <a id="567" href="UTxO.Ledger.html#505" class="Module">Denotable</a> <a id="577" class="Symbol">⦃...⦄</a> <a id="583" class="Keyword">public</a>

<a id="591" class="Keyword">instance</a>
  <a id="602" class="Comment">-- we denote a transaction as simply running the transaction based on the transfer operation above</a>
  <a id="⟦Tx⟧"></a><a id="703" href="UTxO.Ledger.html#703" class="Function">⟦Tx⟧</a> <a id="708" class="Symbol">:</a> <a id="710" href="UTxO.Ledger.html#505" class="Record">Denotable</a> <a id="720" href="UTxO.UTxO.html#1503" class="Record">Tx</a>
  <a id="725" href="UTxO.Ledger.html#703" class="Function">⟦Tx⟧</a> <a id="730" class="Symbol">.</a><a id="731" href="UTxO.Ledger.html#545" class="Field Operator">⟦_⟧</a> <a id="735" href="UTxO.Ledger.html#735" class="Bound">tx</a> <a id="738" href="UTxO.Ledger.html#738" class="Bound">utxos</a> <a id="744" class="Symbol">=</a>
    <a id="750" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="753" href="UTxO.UTxO.html#4499" class="Function">isValidTx</a> <a id="763" href="UTxO.Ledger.html#735" class="Bound">tx</a> <a id="766" href="UTxO.Ledger.html#738" class="Bound">utxos</a> <a id="772" href="Data.Bool.Base.html#1283" class="Function Operator">then</a>
        <a id="785" href="Prelude.FromList.html#174" class="Field">fromList</a> <a id="794" class="Symbol">(</a><a id="795" href="Data.List.Base.html#8092" class="Function">filter</a> <a id="802" class="Symbol">((</a><a id="804" href="Prelude.Membership.html#585" class="Function Operator">_∉?</a> <a id="808" href="UTxO.UTxO.html#2214" class="Function">outputRefs</a> <a id="819" href="UTxO.Ledger.html#735" class="Bound">tx</a><a id="821" class="Symbol">)</a> <a id="823" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="825" href="UTxO.UTxO.html#1839" class="Field">UTXO.outRef</a><a id="836" class="Symbol">)</a> <a id="838" class="Symbol">(</a><a id="839" href="Prelude.ToList.html#170" class="Field">toList</a> <a id="846" href="UTxO.Ledger.html#738" class="Bound">utxos</a><a id="851" class="Symbol">))</a>
      <a id="860" href="Prelude.Sets.AsUniqueLists.Core.html#2841" class="Function Operator">∪</a> <a id="862" href="Prelude.FromList.html#174" class="Field">fromList</a> <a id="871" class="Symbol">(</a><a id="872" href="Prelude.Membership.html#1337" class="Field">mapWith∈</a> <a id="881" class="Symbol">(</a><a id="882" href="UTxO.Ledger.html#735" class="Bound">tx</a> <a id="885" class="Symbol">.</a><a id="886" href="UTxO.UTxO.html#1557" class="Field">outputs</a><a id="893" class="Symbol">)</a> <a id="895" class="Symbol">(</a><a id="896" href="UTxO.UTxO.html#2051" class="Function">mkUtxo</a> <a id="903" href="UTxO.Ledger.html#735" class="Bound">tx</a><a id="905" class="Symbol">))</a>
    <a id="912" href="Data.Bool.Base.html#1283" class="Function Operator">else</a>
      <a id="923" href="UTxO.Ledger.html#738" class="Bound">utxos</a>

  <a id="932" class="Comment">-- we denote a ledger as the composition of the denotations of its transactions,</a>
  <a id="1015" class="Comment">-- i.e. we run all transactions in sequence</a>
  <a id="⟦L⟧"></a><a id="1061" href="UTxO.Ledger.html#1061" class="Function">⟦L⟧</a> <a id="1065" class="Symbol">:</a> <a id="1067" href="UTxO.Ledger.html#505" class="Record">Denotable</a> <a id="1077" href="UTxO.UTxO.html#1794" class="Function">L</a>
  <a id="1081" href="UTxO.Ledger.html#1061" class="Function">⟦L⟧</a> <a id="1085" class="Symbol">.</a><a id="1086" href="UTxO.Ledger.html#545" class="Field Operator">⟦_⟧</a> <a id="1090" class="Symbol">=</a> <a id="1092" class="Symbol">λ</a> <a id="1094" class="Keyword">where</a>
    <a id="1104" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>      <a id="1112" class="Symbol">→</a> <a id="1114" href="Function.Base.html#615" class="Function">id</a>
    <a id="1121" class="Symbol">(</a><a id="1122" href="UTxO.Ledger.html#1122" class="Bound">t</a> <a id="1124" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1126" href="UTxO.Ledger.html#1126" class="Bound">l</a><a id="1127" class="Symbol">)</a> <a id="1129" class="Symbol">→</a> <a id="1131" href="UTxO.Ledger.html#545" class="Field Operator">⟦</a> <a id="1133" href="UTxO.Ledger.html#1126" class="Bound">l</a> <a id="1135" href="UTxO.Ledger.html#545" class="Field Operator">⟧</a> <a id="1137" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="1139" href="UTxO.Ledger.html#545" class="Field Operator">⟦</a> <a id="1141" href="UTxO.Ledger.html#1122" class="Bound">t</a> <a id="1143" href="UTxO.Ledger.html#545" class="Field Operator">⟧</a>

<a id="1146" class="Keyword">variable</a>
  <a id="1157" href="UTxO.Ledger.html#1157" class="Generalizable">s</a> <a id="1159" href="UTxO.Ledger.html#1159" class="Generalizable">s′</a> <a id="1162" href="UTxO.Ledger.html#1162" class="Generalizable">s″</a> <a id="1165" href="UTxO.Ledger.html#1165" class="Generalizable">s₁</a> <a id="1168" href="UTxO.Ledger.html#1168" class="Generalizable">s₂</a> <a id="1171" class="Symbol">:</a> <a id="1173" href="UTxO.UTxO.html#2026" class="Function">S</a>
  <a id="1177" href="UTxO.Ledger.html#1177" class="Generalizable">t</a> <a id="1179" href="UTxO.Ledger.html#1179" class="Generalizable">t′</a> <a id="1182" href="UTxO.Ledger.html#1182" class="Generalizable">t″</a> <a id="1185" class="Symbol">:</a> <a id="1187" href="UTxO.UTxO.html#1503" class="Record">Tx</a>
  <a id="1192" href="UTxO.Ledger.html#1192" class="Generalizable">l</a> <a id="1194" href="UTxO.Ledger.html#1194" class="Generalizable">l′</a> <a id="1197" href="UTxO.Ledger.html#1197" class="Generalizable">l″</a> <a id="1200" href="UTxO.Ledger.html#1200" class="Generalizable">l₁</a> <a id="1203" href="UTxO.Ledger.html#1203" class="Generalizable">l₂</a> <a id="1206" class="Symbol">:</a> <a id="1208" href="UTxO.UTxO.html#1794" class="Function">L</a>
  <a id="1212" href="UTxO.Ledger.html#1212" class="Generalizable">ls</a> <a id="1215" href="UTxO.Ledger.html#1215" class="Generalizable">ls′</a> <a id="1219" href="UTxO.Ledger.html#1219" class="Generalizable">ls″</a> <a id="1223" class="Symbol">:</a> <a id="1225" href="UTxO.UTxO.html#1794" class="Function">L</a> <a id="1227" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="1229" href="UTxO.UTxO.html#2026" class="Function">S</a>

<a id="comp"></a><a id="1232" href="UTxO.Ledger.html#1232" class="Function">comp</a> <a id="1237" class="Symbol">:</a> <a id="1239" class="Symbol">∀</a> <a id="1241" href="UTxO.Ledger.html#1241" class="Bound">x</a> <a id="1243" class="Symbol">→</a> <a id="1245" href="UTxO.Ledger.html#545" class="Field Operator">⟦</a> <a id="1247" href="UTxO.Ledger.html#1192" class="Generalizable">l</a> <a id="1249" href="Data.List.Base.html#1810" class="Function Operator">++</a> <a id="1252" href="UTxO.Ledger.html#1194" class="Generalizable">l′</a> <a id="1255" href="UTxO.Ledger.html#545" class="Field Operator">⟧</a> <a id="1257" href="UTxO.Ledger.html#1241" class="Bound">x</a> <a id="1259" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1261" class="Symbol">(</a><a id="1262" href="UTxO.Ledger.html#545" class="Field Operator">⟦</a> <a id="1264" href="UTxO.Ledger.html#1194" class="Generalizable">l′</a> <a id="1267" href="UTxO.Ledger.html#545" class="Field Operator">⟧</a> <a id="1269" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="1271" href="UTxO.Ledger.html#545" class="Field Operator">⟦</a> <a id="1273" href="UTxO.Ledger.html#1192" class="Generalizable">l</a> <a id="1275" href="UTxO.Ledger.html#545" class="Field Operator">⟧</a><a id="1276" class="Symbol">)</a> <a id="1278" href="UTxO.Ledger.html#1241" class="Bound">x</a>
<a id="1280" href="UTxO.Ledger.html#1232" class="Function">comp</a> <a id="1285" class="Symbol">{</a><a id="1286" class="Argument">l</a> <a id="1288" class="Symbol">=</a> <a id="1290" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="1292" class="Symbol">}</a>    <a id="1297" class="Symbol">{</a><a id="1298" href="UTxO.Ledger.html#1298" class="Bound">l′</a><a id="1300" class="Symbol">}</a> <a id="1302" href="UTxO.Ledger.html#1302" class="Bound">x</a> <a id="1304" class="Symbol">=</a> <a id="1306" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="1311" href="UTxO.Ledger.html#1232" class="Function">comp</a> <a id="1316" class="Symbol">{</a><a id="1317" class="Argument">l</a> <a id="1319" class="Symbol">=</a> <a id="1321" href="UTxO.Ledger.html#1321" class="Bound">t</a> <a id="1323" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1325" href="UTxO.Ledger.html#1325" class="Bound">l</a><a id="1326" class="Symbol">}</a> <a id="1328" class="Symbol">{</a><a id="1329" href="UTxO.Ledger.html#1329" class="Bound">l′</a><a id="1331" class="Symbol">}</a> <a id="1333" href="UTxO.Ledger.html#1333" class="Bound">x</a> <a id="1335" class="Keyword">rewrite</a> <a id="1343" href="UTxO.Ledger.html#1232" class="Function">comp</a> <a id="1348" class="Symbol">{</a><a id="1349" href="UTxO.Ledger.html#1325" class="Bound">l</a><a id="1350" class="Symbol">}{</a><a id="1352" href="UTxO.Ledger.html#1329" class="Bound">l′</a><a id="1354" class="Symbol">}</a> <a id="1356" class="Symbol">(</a><a id="1357" href="UTxO.Ledger.html#545" class="Field Operator">⟦</a> <a id="1359" href="UTxO.Ledger.html#1321" class="Bound">t</a> <a id="1361" href="UTxO.Ledger.html#545" class="Field Operator">⟧</a> <a id="1363" href="UTxO.Ledger.html#1333" class="Bound">x</a><a id="1364" class="Symbol">)</a> <a id="1366" class="Symbol">=</a> <a id="1368" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre></body></html>