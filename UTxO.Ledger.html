<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>UTxO.Ledger</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------</a>
<a id="44" class="Comment">-- ** Denotational &amp; operational semantics</a>

<a id="88" class="Keyword">module</a> <a id="95" href="UTxO.Ledger.html" class="Module">UTxO.Ledger</a> <a id="107" class="Keyword">where</a>

<a id="114" class="Keyword">open</a> <a id="119" class="Keyword">import</a> <a id="126" href="Prelude.Init.html" class="Module">Prelude.Init</a><a id="138" class="Symbol">;</a> <a id="140" class="Keyword">open</a> <a id="145" href="Prelude.Init.html#397" class="Module">SetAsType</a>
<a id="155" class="Keyword">open</a> <a id="160" class="Keyword">import</a> <a id="167" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="183" class="Keyword">open</a> <a id="188" class="Keyword">import</a> <a id="195" href="Prelude.Membership.html" class="Module">Prelude.Membership</a>
<a id="214" class="Keyword">open</a> <a id="219" class="Keyword">import</a> <a id="226" href="Prelude.ToList.html" class="Module">Prelude.ToList</a>
<a id="241" class="Keyword">open</a> <a id="246" class="Keyword">import</a> <a id="253" href="Prelude.FromList.html" class="Module">Prelude.FromList</a>

<a id="271" class="Keyword">open</a> <a id="276" class="Keyword">import</a> <a id="283" href="Prelude.Sets.html" class="Module">Prelude.Sets</a>
<a id="296" class="Keyword">open</a> <a id="301" class="Keyword">import</a> <a id="308" href="UTxO.UTxO.html" class="Module">UTxO.UTxO</a>

<a id="319" class="Comment">-- ** Denotational semantics</a>

<a id="349" class="Comment">-- The meaning of a transaction or a whole ledger will be denoted by state transformers,</a>
<a id="438" class="Comment">-- i.e. function from the current state to the updated one.</a>
<a id="Domain"></a><a id="498" href="UTxO.Ledger.html#498" class="Function">Domain</a> <a id="505" class="Symbol">=</a> <a id="507" href="UTxO.UTxO.html#2051" class="Function">S</a> <a id="509" class="Symbol">→</a> <a id="511" href="UTxO.UTxO.html#2051" class="Function">S</a>

<a id="514" class="Keyword">record</a> <a id="Denotable"></a><a id="521" href="UTxO.Ledger.html#521" class="Record">Denotable</a> <a id="531" class="Symbol">(</a><a id="532" href="UTxO.Ledger.html#532" class="Bound">A</a> <a id="534" class="Symbol">:</a> <a id="536" href="Agda.Primitive.html#326" class="Primitive">Type</a><a id="540" class="Symbol">)</a> <a id="542" class="Symbol">:</a> <a id="544" href="Agda.Primitive.html#326" class="Primitive">Type</a> <a id="549" class="Keyword">where</a>
  <a id="557" class="Keyword">field</a> <a id="Denotable.⟦_⟧"></a><a id="563" href="UTxO.Ledger.html#563" class="Field Operator">⟦_⟧</a> <a id="567" class="Symbol">:</a> <a id="569" href="UTxO.Ledger.html#532" class="Bound">A</a> <a id="571" class="Symbol">→</a> <a id="573" href="UTxO.Ledger.html#498" class="Function">Domain</a>
<a id="580" class="Keyword">open</a> <a id="585" href="UTxO.Ledger.html#521" class="Module">Denotable</a> <a id="595" class="Symbol">⦃...⦄</a> <a id="601" class="Keyword">public</a>

<a id="609" class="Keyword">instance</a>
  <a id="620" class="Comment">-- we denote a transaction as simply running the transaction based on the transfer operation above</a>
  <a id="⟦Tx⟧"></a><a id="721" href="UTxO.Ledger.html#721" class="Function">⟦Tx⟧</a> <a id="726" class="Symbol">:</a> <a id="728" href="UTxO.Ledger.html#521" class="Record">Denotable</a> <a id="738" href="UTxO.UTxO.html#1526" class="Record">Tx</a>
  <a id="743" href="UTxO.Ledger.html#721" class="Function">⟦Tx⟧</a> <a id="748" class="Symbol">.</a><a id="749" href="UTxO.Ledger.html#563" class="Field Operator">⟦_⟧</a> <a id="753" href="UTxO.Ledger.html#753" class="Bound">tx</a> <a id="756" href="UTxO.Ledger.html#756" class="Bound">utxos</a> <a id="762" class="Symbol">=</a>
    <a id="768" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="771" href="UTxO.UTxO.html#4529" class="Function">isValidTx</a> <a id="781" href="UTxO.Ledger.html#753" class="Bound">tx</a> <a id="784" href="UTxO.Ledger.html#756" class="Bound">utxos</a> <a id="790" href="Data.Bool.Base.html#1283" class="Function Operator">then</a>
        <a id="803" href="Prelude.FromList.html#174" class="Field">fromList</a> <a id="812" class="Symbol">(</a><a id="813" href="Data.List.Base.html#8092" class="Function">filter</a> <a id="820" class="Symbol">((</a><a id="822" href="Prelude.Membership.html#585" class="Function Operator">_∉?</a> <a id="826" href="UTxO.UTxO.html#2240" class="Function">outputRefs</a> <a id="837" href="UTxO.Ledger.html#753" class="Bound">tx</a><a id="839" class="Symbol">)</a> <a id="841" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="843" href="UTxO.UTxO.html#1864" class="Field">UTXO.outRef</a><a id="854" class="Symbol">)</a> <a id="856" class="Symbol">(</a><a id="857" href="Prelude.ToList.html#170" class="Field">toList</a> <a id="864" href="UTxO.Ledger.html#756" class="Bound">utxos</a><a id="869" class="Symbol">))</a>
      <a id="878" href="Prelude.Sets.AsUniqueLists.Core.html#3056" class="Function Operator">∪</a> <a id="880" href="Prelude.FromList.html#174" class="Field">fromList</a> <a id="889" class="Symbol">(</a><a id="890" href="Prelude.Membership.html#1335" class="Field">mapWith∈</a> <a id="899" class="Symbol">(</a><a id="900" href="UTxO.Ledger.html#753" class="Bound">tx</a> <a id="903" class="Symbol">.</a><a id="904" href="UTxO.UTxO.html#1581" class="Field">outputs</a><a id="911" class="Symbol">)</a> <a id="913" class="Symbol">(</a><a id="914" href="UTxO.UTxO.html#2077" class="Function">mkUtxo</a> <a id="921" href="UTxO.Ledger.html#753" class="Bound">tx</a><a id="923" class="Symbol">))</a>
    <a id="930" href="Data.Bool.Base.html#1283" class="Function Operator">else</a>
      <a id="941" href="UTxO.Ledger.html#756" class="Bound">utxos</a>

  <a id="950" class="Comment">-- we denote a ledger as the composition of the denotations of its transactions,</a>
  <a id="1033" class="Comment">-- i.e. we run all transactions in sequence</a>
  <a id="⟦L⟧"></a><a id="1079" href="UTxO.Ledger.html#1079" class="Function">⟦L⟧</a> <a id="1083" class="Symbol">:</a> <a id="1085" href="UTxO.Ledger.html#521" class="Record">Denotable</a> <a id="1095" href="UTxO.UTxO.html#1818" class="Function">L</a>
  <a id="1099" href="UTxO.Ledger.html#1079" class="Function">⟦L⟧</a> <a id="1103" class="Symbol">.</a><a id="1104" href="UTxO.Ledger.html#563" class="Field Operator">⟦_⟧</a> <a id="1108" class="Symbol">=</a> <a id="1110" class="Symbol">λ</a> <a id="1112" class="Keyword">where</a>
    <a id="1122" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>      <a id="1130" class="Symbol">→</a> <a id="1132" href="Function.Base.html#615" class="Function">id</a>
    <a id="1139" class="Symbol">(</a><a id="1140" href="UTxO.Ledger.html#1140" class="Bound">t</a> <a id="1142" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1144" href="UTxO.Ledger.html#1144" class="Bound">l</a><a id="1145" class="Symbol">)</a> <a id="1147" class="Symbol">→</a> <a id="1149" href="UTxO.Ledger.html#563" class="Field Operator">⟦</a> <a id="1151" href="UTxO.Ledger.html#1144" class="Bound">l</a> <a id="1153" href="UTxO.Ledger.html#563" class="Field Operator">⟧</a> <a id="1155" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="1157" href="UTxO.Ledger.html#563" class="Field Operator">⟦</a> <a id="1159" href="UTxO.Ledger.html#1140" class="Bound">t</a> <a id="1161" href="UTxO.Ledger.html#563" class="Field Operator">⟧</a>

<a id="1164" class="Keyword">variable</a>
  <a id="1175" href="UTxO.Ledger.html#1175" class="Generalizable">s</a> <a id="1177" href="UTxO.Ledger.html#1177" class="Generalizable">s′</a> <a id="1180" href="UTxO.Ledger.html#1180" class="Generalizable">s″</a> <a id="1183" href="UTxO.Ledger.html#1183" class="Generalizable">s₁</a> <a id="1186" href="UTxO.Ledger.html#1186" class="Generalizable">s₂</a> <a id="1189" class="Symbol">:</a> <a id="1191" href="UTxO.UTxO.html#2051" class="Function">S</a>
  <a id="1195" href="UTxO.Ledger.html#1195" class="Generalizable">t</a> <a id="1197" href="UTxO.Ledger.html#1197" class="Generalizable">t′</a> <a id="1200" href="UTxO.Ledger.html#1200" class="Generalizable">t″</a> <a id="1203" class="Symbol">:</a> <a id="1205" href="UTxO.UTxO.html#1526" class="Record">Tx</a>
  <a id="1210" href="UTxO.Ledger.html#1210" class="Generalizable">l</a> <a id="1212" href="UTxO.Ledger.html#1212" class="Generalizable">l′</a> <a id="1215" href="UTxO.Ledger.html#1215" class="Generalizable">l″</a> <a id="1218" href="UTxO.Ledger.html#1218" class="Generalizable">l₁</a> <a id="1221" href="UTxO.Ledger.html#1221" class="Generalizable">l₂</a> <a id="1224" class="Symbol">:</a> <a id="1226" href="UTxO.UTxO.html#1818" class="Function">L</a>
  <a id="1230" href="UTxO.Ledger.html#1230" class="Generalizable">ls</a> <a id="1233" href="UTxO.Ledger.html#1233" class="Generalizable">ls′</a> <a id="1237" href="UTxO.Ledger.html#1237" class="Generalizable">ls″</a> <a id="1241" class="Symbol">:</a> <a id="1243" href="UTxO.UTxO.html#1818" class="Function">L</a> <a id="1245" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="1247" href="UTxO.UTxO.html#2051" class="Function">S</a>

<a id="comp"></a><a id="1250" href="UTxO.Ledger.html#1250" class="Function">comp</a> <a id="1255" class="Symbol">:</a> <a id="1257" class="Symbol">∀</a> <a id="1259" href="UTxO.Ledger.html#1259" class="Bound">x</a> <a id="1261" class="Symbol">→</a> <a id="1263" href="UTxO.Ledger.html#563" class="Field Operator">⟦</a> <a id="1265" href="UTxO.Ledger.html#1210" class="Generalizable">l</a> <a id="1267" href="Data.List.Base.html#1810" class="Function Operator">++</a> <a id="1270" href="UTxO.Ledger.html#1212" class="Generalizable">l′</a> <a id="1273" href="UTxO.Ledger.html#563" class="Field Operator">⟧</a> <a id="1275" href="UTxO.Ledger.html#1259" class="Bound">x</a> <a id="1277" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1279" class="Symbol">(</a><a id="1280" href="UTxO.Ledger.html#563" class="Field Operator">⟦</a> <a id="1282" href="UTxO.Ledger.html#1212" class="Generalizable">l′</a> <a id="1285" href="UTxO.Ledger.html#563" class="Field Operator">⟧</a> <a id="1287" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="1289" href="UTxO.Ledger.html#563" class="Field Operator">⟦</a> <a id="1291" href="UTxO.Ledger.html#1210" class="Generalizable">l</a> <a id="1293" href="UTxO.Ledger.html#563" class="Field Operator">⟧</a><a id="1294" class="Symbol">)</a> <a id="1296" href="UTxO.Ledger.html#1259" class="Bound">x</a>
<a id="1298" href="UTxO.Ledger.html#1250" class="Function">comp</a> <a id="1303" class="Symbol">{</a><a id="1304" class="Argument">l</a> <a id="1306" class="Symbol">=</a> <a id="1308" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="1310" class="Symbol">}</a>    <a id="1315" class="Symbol">{</a><a id="1316" href="UTxO.Ledger.html#1316" class="Bound">l′</a><a id="1318" class="Symbol">}</a> <a id="1320" href="UTxO.Ledger.html#1320" class="Bound">x</a> <a id="1322" class="Symbol">=</a> <a id="1324" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="1329" href="UTxO.Ledger.html#1250" class="Function">comp</a> <a id="1334" class="Symbol">{</a><a id="1335" class="Argument">l</a> <a id="1337" class="Symbol">=</a> <a id="1339" href="UTxO.Ledger.html#1339" class="Bound">t</a> <a id="1341" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1343" href="UTxO.Ledger.html#1343" class="Bound">l</a><a id="1344" class="Symbol">}</a> <a id="1346" class="Symbol">{</a><a id="1347" href="UTxO.Ledger.html#1347" class="Bound">l′</a><a id="1349" class="Symbol">}</a> <a id="1351" href="UTxO.Ledger.html#1351" class="Bound">x</a> <a id="1353" class="Keyword">rewrite</a> <a id="1361" href="UTxO.Ledger.html#1250" class="Function">comp</a> <a id="1366" class="Symbol">{</a><a id="1367" href="UTxO.Ledger.html#1343" class="Bound">l</a><a id="1368" class="Symbol">}{</a><a id="1370" href="UTxO.Ledger.html#1347" class="Bound">l′</a><a id="1372" class="Symbol">}</a> <a id="1374" class="Symbol">(</a><a id="1375" href="UTxO.Ledger.html#563" class="Field Operator">⟦</a> <a id="1377" href="UTxO.Ledger.html#1339" class="Bound">t</a> <a id="1379" href="UTxO.Ledger.html#563" class="Field Operator">⟧</a> <a id="1381" href="UTxO.Ledger.html#1351" class="Bound">x</a><a id="1382" class="Symbol">)</a> <a id="1384" class="Symbol">=</a> <a id="1386" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre></body></html>