<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>UTxO.Ledger</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------</a>
<a id="44" class="Comment">-- ** Denotational &amp; operational semantics</a>

<a id="88" class="Keyword">module</a> <a id="95" href="UTxO.Ledger.html" class="Module">UTxO.Ledger</a> <a id="107" class="Keyword">where</a>

<a id="114" class="Keyword">open</a> <a id="119" class="Keyword">import</a> <a id="126" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="139" class="Keyword">open</a> <a id="144" class="Keyword">import</a> <a id="151" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="167" class="Keyword">open</a> <a id="172" class="Keyword">import</a> <a id="179" href="Prelude.Sets.html" class="Module">Prelude.Sets</a>
<a id="192" class="Keyword">open</a> <a id="197" class="Keyword">import</a> <a id="204" href="Prelude.Membership.html" class="Module">Prelude.Membership</a>

<a id="224" class="Keyword">open</a> <a id="229" class="Keyword">import</a> <a id="236" href="UTxO.UTxO.html" class="Module">UTxO.UTxO</a>

<a id="247" class="Comment">-- ** Denotational semantics</a>

<a id="277" class="Comment">-- The meaning of a transaction or a whole ledger will be denoted by state transformers,</a>
<a id="366" class="Comment">-- i.e. function from the current state to the updated one.</a>
<a id="Domain"></a><a id="426" href="UTxO.Ledger.html#426" class="Function">Domain</a> <a id="433" class="Symbol">=</a> <a id="435" href="UTxO.UTxO.html#1999" class="Function">S</a> <a id="437" class="Symbol">→</a> <a id="439" href="UTxO.UTxO.html#1999" class="Function">S</a>

<a id="442" class="Keyword">record</a> <a id="Denotable"></a><a id="449" href="UTxO.Ledger.html#449" class="Record">Denotable</a> <a id="459" class="Symbol">(</a><a id="460" href="UTxO.Ledger.html#460" class="Bound">A</a> <a id="462" class="Symbol">:</a> <a id="464" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="467" class="Symbol">)</a> <a id="469" class="Symbol">:</a> <a id="471" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="475" class="Keyword">where</a>
  <a id="483" class="Keyword">field</a> <a id="Denotable.⟦_⟧"></a><a id="489" href="UTxO.Ledger.html#489" class="Field Operator">⟦_⟧</a> <a id="493" class="Symbol">:</a> <a id="495" href="UTxO.Ledger.html#460" class="Bound">A</a> <a id="497" class="Symbol">→</a> <a id="499" href="UTxO.Ledger.html#426" class="Function">Domain</a>
<a id="506" class="Keyword">open</a> <a id="511" href="UTxO.Ledger.html#449" class="Module">Denotable</a> <a id="521" class="Symbol">⦃...⦄</a> <a id="527" class="Keyword">public</a>

<a id="535" class="Keyword">instance</a>
  <a id="546" class="Comment">-- we denote a transaction as simply running the transaction based on the transfer operation above</a>
  <a id="⟦Tx⟧"></a><a id="647" href="UTxO.Ledger.html#647" class="Function">⟦Tx⟧</a> <a id="652" class="Symbol">:</a> <a id="654" href="UTxO.Ledger.html#449" class="Record">Denotable</a> <a id="664" href="UTxO.UTxO.html#1476" class="Record">Tx</a>
  <a id="669" href="UTxO.Ledger.html#647" class="Function">⟦Tx⟧</a> <a id="674" class="Symbol">.</a><a id="675" href="UTxO.Ledger.html#489" class="Field Operator">⟦_⟧</a> <a id="679" href="UTxO.Ledger.html#679" class="Bound">tx</a> <a id="682" href="UTxO.Ledger.html#682" class="Bound">utxos</a> <a id="688" class="Symbol">=</a>
    <a id="694" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="697" href="UTxO.UTxO.html#4472" class="Function">isValidTx</a> <a id="707" href="UTxO.Ledger.html#679" class="Bound">tx</a> <a id="710" href="UTxO.Ledger.html#682" class="Bound">utxos</a> <a id="716" href="Data.Bool.Base.html#1283" class="Function Operator">then</a>
        <a id="729" href="Prelude.Sets.Interface.html#4018" class="Function">fromList</a> <a id="738" class="Symbol">(</a><a id="739" href="Data.List.Base.html#8092" class="Function">filter</a> <a id="746" class="Symbol">((</a><a id="748" href="Prelude.Membership.html#562" class="Function Operator">_∉?</a> <a id="752" href="UTxO.UTxO.html#2187" class="Function">outputRefs</a> <a id="763" href="UTxO.Ledger.html#679" class="Bound">tx</a><a id="765" class="Symbol">)</a> <a id="767" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="769" href="UTxO.UTxO.html#1812" class="Field">UTXO.outRef</a><a id="780" class="Symbol">)</a> <a id="782" class="Symbol">(</a><a id="783" href="Prelude.Sets.Interface.html#3991" class="Function">toList</a> <a id="790" href="UTxO.Ledger.html#682" class="Bound">utxos</a><a id="795" class="Symbol">))</a>
      <a id="804" href="Prelude.Sets.Interface.html#529" class="Function Operator">∪</a> <a id="806" href="Prelude.Sets.Interface.html#4018" class="Function">fromList</a> <a id="815" class="Symbol">(</a><a id="816" href="Prelude.Membership.html#1311" class="Field">mapWith∈</a> <a id="825" class="Symbol">(</a><a id="826" href="UTxO.Ledger.html#679" class="Bound">tx</a> <a id="829" class="Symbol">.</a><a id="830" href="UTxO.UTxO.html#1530" class="Field">outputs</a><a id="837" class="Symbol">)</a> <a id="839" class="Symbol">(</a><a id="840" href="UTxO.UTxO.html#2024" class="Function">mkUtxo</a> <a id="847" href="UTxO.Ledger.html#679" class="Bound">tx</a><a id="849" class="Symbol">))</a>
    <a id="856" href="Data.Bool.Base.html#1283" class="Function Operator">else</a>
      <a id="867" href="UTxO.Ledger.html#682" class="Bound">utxos</a>

  <a id="876" class="Comment">-- we denote a ledger as the composition of the denotations of its transactions,</a>
  <a id="959" class="Comment">-- i.e. we run all transactions in sequence</a>
  <a id="⟦L⟧"></a><a id="1005" href="UTxO.Ledger.html#1005" class="Function">⟦L⟧</a> <a id="1009" class="Symbol">:</a> <a id="1011" href="UTxO.Ledger.html#449" class="Record">Denotable</a> <a id="1021" href="UTxO.UTxO.html#1767" class="Function">L</a>
  <a id="1025" href="UTxO.Ledger.html#1005" class="Function">⟦L⟧</a> <a id="1029" class="Symbol">.</a><a id="1030" href="UTxO.Ledger.html#489" class="Field Operator">⟦_⟧</a> <a id="1034" class="Symbol">=</a> <a id="1036" class="Symbol">λ</a> <a id="1038" class="Keyword">where</a>
    <a id="1048" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>      <a id="1056" class="Symbol">→</a> <a id="1058" href="Function.Base.html#615" class="Function">id</a>
    <a id="1065" class="Symbol">(</a><a id="1066" href="UTxO.Ledger.html#1066" class="Bound">t</a> <a id="1068" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1070" href="UTxO.Ledger.html#1070" class="Bound">l</a><a id="1071" class="Symbol">)</a> <a id="1073" class="Symbol">→</a> <a id="1075" href="UTxO.Ledger.html#489" class="Field Operator">⟦</a> <a id="1077" href="UTxO.Ledger.html#1070" class="Bound">l</a> <a id="1079" href="UTxO.Ledger.html#489" class="Field Operator">⟧</a> <a id="1081" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="1083" href="UTxO.Ledger.html#489" class="Field Operator">⟦</a> <a id="1085" href="UTxO.Ledger.html#1066" class="Bound">t</a> <a id="1087" href="UTxO.Ledger.html#489" class="Field Operator">⟧</a>

<a id="1090" class="Keyword">variable</a>
  <a id="1101" href="UTxO.Ledger.html#1101" class="Generalizable">s</a> <a id="1103" href="UTxO.Ledger.html#1103" class="Generalizable">s′</a> <a id="1106" href="UTxO.Ledger.html#1106" class="Generalizable">s″</a> <a id="1109" href="UTxO.Ledger.html#1109" class="Generalizable">s₁</a> <a id="1112" href="UTxO.Ledger.html#1112" class="Generalizable">s₂</a> <a id="1115" class="Symbol">:</a> <a id="1117" href="UTxO.UTxO.html#1999" class="Function">S</a>
  <a id="1121" href="UTxO.Ledger.html#1121" class="Generalizable">t</a> <a id="1123" href="UTxO.Ledger.html#1123" class="Generalizable">t′</a> <a id="1126" href="UTxO.Ledger.html#1126" class="Generalizable">t″</a> <a id="1129" class="Symbol">:</a> <a id="1131" href="UTxO.UTxO.html#1476" class="Record">Tx</a>
  <a id="1136" href="UTxO.Ledger.html#1136" class="Generalizable">l</a> <a id="1138" href="UTxO.Ledger.html#1138" class="Generalizable">l′</a> <a id="1141" href="UTxO.Ledger.html#1141" class="Generalizable">l″</a> <a id="1144" href="UTxO.Ledger.html#1144" class="Generalizable">l₁</a> <a id="1147" href="UTxO.Ledger.html#1147" class="Generalizable">l₂</a> <a id="1150" class="Symbol">:</a> <a id="1152" href="UTxO.UTxO.html#1767" class="Function">L</a>
  <a id="1156" href="UTxO.Ledger.html#1156" class="Generalizable">ls</a> <a id="1159" href="UTxO.Ledger.html#1159" class="Generalizable">ls′</a> <a id="1163" href="UTxO.Ledger.html#1163" class="Generalizable">ls″</a> <a id="1167" class="Symbol">:</a> <a id="1169" href="UTxO.UTxO.html#1767" class="Function">L</a> <a id="1171" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="1173" href="UTxO.UTxO.html#1999" class="Function">S</a>

<a id="comp"></a><a id="1176" href="UTxO.Ledger.html#1176" class="Function">comp</a> <a id="1181" class="Symbol">:</a> <a id="1183" class="Symbol">∀</a> <a id="1185" href="UTxO.Ledger.html#1185" class="Bound">x</a> <a id="1187" class="Symbol">→</a> <a id="1189" href="UTxO.Ledger.html#489" class="Field Operator">⟦</a> <a id="1191" href="UTxO.Ledger.html#1136" class="Generalizable">l</a> <a id="1193" href="Data.List.Base.html#1810" class="Function Operator">++</a> <a id="1196" href="UTxO.Ledger.html#1138" class="Generalizable">l′</a> <a id="1199" href="UTxO.Ledger.html#489" class="Field Operator">⟧</a> <a id="1201" href="UTxO.Ledger.html#1185" class="Bound">x</a> <a id="1203" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1205" class="Symbol">(</a><a id="1206" href="UTxO.Ledger.html#489" class="Field Operator">⟦</a> <a id="1208" href="UTxO.Ledger.html#1138" class="Generalizable">l′</a> <a id="1211" href="UTxO.Ledger.html#489" class="Field Operator">⟧</a> <a id="1213" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="1215" href="UTxO.Ledger.html#489" class="Field Operator">⟦</a> <a id="1217" href="UTxO.Ledger.html#1136" class="Generalizable">l</a> <a id="1219" href="UTxO.Ledger.html#489" class="Field Operator">⟧</a><a id="1220" class="Symbol">)</a> <a id="1222" href="UTxO.Ledger.html#1185" class="Bound">x</a>
<a id="1224" href="UTxO.Ledger.html#1176" class="Function">comp</a> <a id="1229" class="Symbol">{</a><a id="1230" class="Argument">l</a> <a id="1232" class="Symbol">=</a> <a id="1234" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="1236" class="Symbol">}</a>    <a id="1241" class="Symbol">{</a><a id="1242" href="UTxO.Ledger.html#1242" class="Bound">l′</a><a id="1244" class="Symbol">}</a> <a id="1246" href="UTxO.Ledger.html#1246" class="Bound">x</a> <a id="1248" class="Symbol">=</a> <a id="1250" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="1255" href="UTxO.Ledger.html#1176" class="Function">comp</a> <a id="1260" class="Symbol">{</a><a id="1261" class="Argument">l</a> <a id="1263" class="Symbol">=</a> <a id="1265" href="UTxO.Ledger.html#1265" class="Bound">t</a> <a id="1267" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1269" href="UTxO.Ledger.html#1269" class="Bound">l</a><a id="1270" class="Symbol">}</a> <a id="1272" class="Symbol">{</a><a id="1273" href="UTxO.Ledger.html#1273" class="Bound">l′</a><a id="1275" class="Symbol">}</a> <a id="1277" href="UTxO.Ledger.html#1277" class="Bound">x</a> <a id="1279" class="Keyword">rewrite</a> <a id="1287" href="UTxO.Ledger.html#1176" class="Function">comp</a> <a id="1292" class="Symbol">{</a><a id="1293" href="UTxO.Ledger.html#1269" class="Bound">l</a><a id="1294" class="Symbol">}{</a><a id="1296" href="UTxO.Ledger.html#1273" class="Bound">l′</a><a id="1298" class="Symbol">}</a> <a id="1300" class="Symbol">(</a><a id="1301" href="UTxO.Ledger.html#489" class="Field Operator">⟦</a> <a id="1303" href="UTxO.Ledger.html#1265" class="Bound">t</a> <a id="1305" href="UTxO.Ledger.html#489" class="Field Operator">⟧</a> <a id="1307" href="UTxO.Ledger.html#1277" class="Bound">x</a><a id="1308" class="Symbol">)</a> <a id="1310" class="Symbol">=</a> <a id="1312" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="1318" class="Comment">-- ** Lemmas about the transfer operation on maps.</a>
<a id="1369" class="Comment">-- transfer-helper : s₁ ♯ s₂ → B ∉ˢ s₂ → ⟦ tx ⟧ s₁ ♯ s₂</a>
<a id="1425" class="Comment">-- transfer-helper {s₁ = s₁}{s₂}{B}{A}{v} s₁♯s₂ B∉ = ♯-cong-pre [∣↦]-pre s₁♯s₂</a>
</pre></body></html>