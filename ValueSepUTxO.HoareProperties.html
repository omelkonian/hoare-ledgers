<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ValueSepUTxO.HoareProperties</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--allow-unsolved-metas</a> <a id="36" class="Symbol">#-}</a>
<a id="40" class="Comment">-------------------------------------</a>
<a id="78" class="Comment">-- ** Properties for Hoare triples.</a>

<a id="115" class="Keyword">module</a> <a id="122" href="ValueSepUTxO.HoareProperties.html" class="Module">ValueSepUTxO.HoareProperties</a> <a id="151" class="Keyword">where</a>

<a id="158" class="Keyword">open</a> <a id="163" class="Keyword">import</a> <a id="170" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="183" class="Keyword">open</a> <a id="188" class="Keyword">import</a> <a id="195" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="211" class="Keyword">open</a> <a id="216" class="Keyword">import</a> <a id="223" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="237" class="Keyword">open</a> <a id="242" class="Keyword">import</a> <a id="249" href="Prelude.Decidable.html" class="Module">Prelude.Decidable</a>
<a id="267" class="Keyword">open</a> <a id="272" class="Keyword">import</a> <a id="279" href="Prelude.InferenceRules.html" class="Module">Prelude.InferenceRules</a>

<a id="303" class="Keyword">open</a> <a id="308" class="Keyword">import</a> <a id="315" href="ValueSepUTxO.Maps.html" class="Module">ValueSepUTxO.Maps</a>
<a id="333" class="Keyword">open</a> <a id="338" class="Keyword">import</a> <a id="345" href="ValueSepUTxO.UTxO.html" class="Module">ValueSepUTxO.UTxO</a>
<a id="363" class="Keyword">open</a> <a id="368" class="Keyword">import</a> <a id="375" href="ValueSepUTxO.Ledger.html" class="Module">ValueSepUTxO.Ledger</a>
<a id="395" class="Keyword">open</a> <a id="400" class="Keyword">import</a> <a id="407" href="ValueSepUTxO.HoareLogic.html" class="Module">ValueSepUTxO.HoareLogic</a>

<a id="432" class="Comment">-- ** Lemmas about separating conjunction.</a>

<a id="476" class="Comment">-- commutativity</a>
<a id="∗↔"></a><a id="493" href="ValueSepUTxO.HoareProperties.html#493" class="Function">∗↔</a> <a id="496" class="Symbol">:</a> <a id="498" href="ValueSepUTxO.HoareLogic.html#611" class="Generalizable">P</a> <a id="500" href="ValueSepUTxO.HoareLogic.html#718" class="Function Operator">∗</a> <a id="502" href="ValueSepUTxO.HoareLogic.html#622" class="Generalizable">Q</a> <a id="504" href="Prelude.General.html#1680" class="Function Operator">⊢</a> <a id="506" href="ValueSepUTxO.HoareLogic.html#622" class="Generalizable">Q</a> <a id="508" href="ValueSepUTxO.HoareLogic.html#718" class="Function Operator">∗</a> <a id="510" href="ValueSepUTxO.HoareLogic.html#611" class="Generalizable">P</a>
<a id="512" href="ValueSepUTxO.HoareProperties.html#493" class="Function">∗↔</a> <a id="515" class="Symbol">(</a><a id="516" href="ValueSepUTxO.HoareProperties.html#516" class="Bound">s₁</a> <a id="519" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="521" href="ValueSepUTxO.HoareProperties.html#521" class="Bound">s₂</a> <a id="524" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="526" href="ValueSepUTxO.HoareProperties.html#526" class="Bound">≡s</a> <a id="529" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="531" href="ValueSepUTxO.HoareProperties.html#531" class="Bound">Ps₁</a> <a id="535" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="537" href="ValueSepUTxO.HoareProperties.html#537" class="Bound">Qs₂</a><a id="540" class="Symbol">)</a> <a id="542" class="Symbol">=</a> <a id="544" href="ValueSepUTxO.HoareProperties.html#521" class="Bound">s₂</a> <a id="547" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="549" href="ValueSepUTxO.HoareProperties.html#516" class="Bound">s₁</a> <a id="552" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="554" href="ValueSepUTxO.Maps.html#5635" class="Function">⊎≡-comm</a> <a id="562" class="Symbol">{</a><a id="563" class="Argument">x</a> <a id="565" class="Symbol">=</a> <a id="567" href="ValueSepUTxO.HoareProperties.html#516" class="Bound">s₁</a><a id="569" class="Symbol">}{</a><a id="571" href="ValueSepUTxO.HoareProperties.html#521" class="Bound">s₂</a><a id="573" class="Symbol">}</a> <a id="575" href="ValueSepUTxO.HoareProperties.html#526" class="Bound">≡s</a> <a id="578" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="580" href="ValueSepUTxO.HoareProperties.html#537" class="Bound">Qs₂</a> <a id="584" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="586" href="ValueSepUTxO.HoareProperties.html#531" class="Bound">Ps₁</a>

<a id="591" class="Comment">-- associativity</a>
<a id="∗↝"></a><a id="608" href="ValueSepUTxO.HoareProperties.html#608" class="Function">∗↝</a> <a id="611" class="Symbol">:</a> <a id="613" href="ValueSepUTxO.HoareLogic.html#611" class="Generalizable">P</a> <a id="615" href="ValueSepUTxO.HoareLogic.html#718" class="Function Operator">∗</a> <a id="617" href="ValueSepUTxO.HoareLogic.html#622" class="Generalizable">Q</a> <a id="619" href="ValueSepUTxO.HoareLogic.html#718" class="Function Operator">∗</a> <a id="621" href="ValueSepUTxO.HoareLogic.html#633" class="Generalizable">R</a> <a id="623" href="Prelude.General.html#1680" class="Function Operator">⊢</a> <a id="625" class="Symbol">(</a><a id="626" href="ValueSepUTxO.HoareLogic.html#611" class="Generalizable">P</a> <a id="628" href="ValueSepUTxO.HoareLogic.html#718" class="Function Operator">∗</a> <a id="630" href="ValueSepUTxO.HoareLogic.html#622" class="Generalizable">Q</a><a id="631" class="Symbol">)</a> <a id="633" href="ValueSepUTxO.HoareLogic.html#718" class="Function Operator">∗</a> <a id="635" href="ValueSepUTxO.HoareLogic.html#633" class="Generalizable">R</a>
<a id="637" href="ValueSepUTxO.HoareProperties.html#608" class="Function">∗↝</a> <a id="640" class="Symbol">{</a><a id="641" class="Argument">x</a> <a id="643" class="Symbol">=</a> <a id="645" href="ValueSepUTxO.HoareProperties.html#645" class="Bound">s</a><a id="646" class="Symbol">}</a> <a id="648" class="Symbol">(</a><a id="649" href="ValueSepUTxO.HoareProperties.html#649" class="Bound">s₁</a> <a id="652" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="654" href="ValueSepUTxO.HoareProperties.html#654" class="Bound">s₂₃</a> <a id="658" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="660" href="ValueSepUTxO.HoareProperties.html#660" class="Bound">≡s</a> <a id="663" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="665" href="ValueSepUTxO.HoareProperties.html#665" class="Bound">Ps₁</a> <a id="669" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="671" class="Symbol">(</a><a id="672" href="ValueSepUTxO.HoareProperties.html#672" class="Bound">s₂</a> <a id="675" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="677" href="ValueSepUTxO.HoareProperties.html#677" class="Bound">s₃</a> <a id="680" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="682" href="ValueSepUTxO.HoareProperties.html#682" class="Bound">≡s₂₃</a> <a id="687" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="689" href="ValueSepUTxO.HoareProperties.html#689" class="Bound">Qs₂</a> <a id="693" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="695" href="ValueSepUTxO.HoareProperties.html#695" class="Bound">Rs₃</a><a id="698" class="Symbol">))</a> <a id="701" class="Symbol">=</a>
  <a id="705" class="Keyword">let</a> <a id="709" href="ValueSepUTxO.HoareProperties.html#709" class="Bound">≡s₁₂</a> <a id="714" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="716" href="ValueSepUTxO.HoareProperties.html#716" class="Bound">s₁♯s₂</a> <a id="722" class="Symbol">=</a> <a id="724" href="ValueSepUTxO.Maps.html#5965" class="Function">⊎≈-assocʳ</a> <a id="734" href="ValueSepUTxO.HoareProperties.html#660" class="Bound">≡s</a> <a id="737" href="ValueSepUTxO.HoareProperties.html#682" class="Bound">≡s₂₃</a> <a id="742" class="Keyword">in</a>
  <a id="747" class="Symbol">(</a><a id="748" href="ValueSepUTxO.HoareProperties.html#649" class="Bound">s₁</a> <a id="751" href="ValueSepUTxO.Maps.html#1005" class="Function Operator">∪</a> <a id="753" href="ValueSepUTxO.HoareProperties.html#672" class="Bound">s₂</a><a id="755" class="Symbol">)</a> <a id="757" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="759" href="ValueSepUTxO.HoareProperties.html#677" class="Bound">s₃</a> <a id="762" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="764" href="ValueSepUTxO.HoareProperties.html#709" class="Bound">≡s₁₂</a> <a id="769" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="771" class="Symbol">(</a><a id="772" href="ValueSepUTxO.HoareProperties.html#649" class="Bound">s₁</a> <a id="775" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="777" href="ValueSepUTxO.HoareProperties.html#672" class="Bound">s₂</a> <a id="780" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="782" class="Symbol">(</a><a id="783" href="ValueSepUTxO.HoareProperties.html#716" class="Bound">s₁♯s₂</a> <a id="789" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="791" href="ValueSepUTxO.Maps.html#1512" class="Function">≈-refl</a><a id="797" class="Symbol">)</a> <a id="799" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="801" href="ValueSepUTxO.HoareProperties.html#665" class="Bound">Ps₁</a> <a id="805" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="807" href="ValueSepUTxO.HoareProperties.html#689" class="Bound">Qs₂</a><a id="810" class="Symbol">)</a> <a id="812" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="814" href="ValueSepUTxO.HoareProperties.html#695" class="Bound">Rs₃</a>

<a id="↜∗"></a><a id="819" href="ValueSepUTxO.HoareProperties.html#819" class="Function">↜∗</a> <a id="822" class="Symbol">:</a> <a id="824" class="Symbol">(</a><a id="825" href="ValueSepUTxO.HoareLogic.html#611" class="Generalizable">P</a> <a id="827" href="ValueSepUTxO.HoareLogic.html#718" class="Function Operator">∗</a> <a id="829" href="ValueSepUTxO.HoareLogic.html#622" class="Generalizable">Q</a><a id="830" class="Symbol">)</a> <a id="832" href="ValueSepUTxO.HoareLogic.html#718" class="Function Operator">∗</a> <a id="834" href="ValueSepUTxO.HoareLogic.html#633" class="Generalizable">R</a> <a id="836" href="Prelude.General.html#1680" class="Function Operator">⊢</a> <a id="838" href="ValueSepUTxO.HoareLogic.html#611" class="Generalizable">P</a> <a id="840" href="ValueSepUTxO.HoareLogic.html#718" class="Function Operator">∗</a> <a id="842" href="ValueSepUTxO.HoareLogic.html#622" class="Generalizable">Q</a> <a id="844" href="ValueSepUTxO.HoareLogic.html#718" class="Function Operator">∗</a> <a id="846" href="ValueSepUTxO.HoareLogic.html#633" class="Generalizable">R</a>
<a id="848" href="ValueSepUTxO.HoareProperties.html#819" class="Function">↜∗</a> <a id="851" class="Symbol">{</a><a id="852" class="Argument">x</a> <a id="854" class="Symbol">=</a> <a id="856" href="ValueSepUTxO.HoareProperties.html#856" class="Bound">s</a><a id="857" class="Symbol">}</a> <a id="859" class="Symbol">(</a><a id="860" href="ValueSepUTxO.HoareProperties.html#860" class="Bound">s₁₂</a> <a id="864" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="866" href="ValueSepUTxO.HoareProperties.html#866" class="Bound">s₃</a> <a id="869" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="871" href="ValueSepUTxO.HoareProperties.html#871" class="Bound">≡s</a> <a id="874" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="876" class="Symbol">(</a><a id="877" href="ValueSepUTxO.HoareProperties.html#877" class="Bound">s₁</a> <a id="880" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="882" href="ValueSepUTxO.HoareProperties.html#882" class="Bound">s₂</a> <a id="885" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="887" href="ValueSepUTxO.HoareProperties.html#887" class="Bound">≡s₁₂</a> <a id="892" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="894" href="ValueSepUTxO.HoareProperties.html#894" class="Bound">Ps₁</a> <a id="898" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="900" href="ValueSepUTxO.HoareProperties.html#900" class="Bound">Qs₂</a><a id="903" class="Symbol">)</a> <a id="905" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="907" href="ValueSepUTxO.HoareProperties.html#907" class="Bound">Rs₃</a><a id="910" class="Symbol">)</a> <a id="912" class="Symbol">=</a>
  <a id="916" class="Keyword">let</a> <a id="920" href="ValueSepUTxO.HoareProperties.html#920" class="Bound">≡s₂₃</a> <a id="925" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="927" href="ValueSepUTxO.HoareProperties.html#927" class="Bound">s₂♯s₃</a> <a id="933" class="Symbol">=</a> <a id="935" href="ValueSepUTxO.Maps.html#6663" class="Function">⊎≈-assocˡ</a> <a id="945" href="ValueSepUTxO.HoareProperties.html#871" class="Bound">≡s</a> <a id="948" href="ValueSepUTxO.HoareProperties.html#887" class="Bound">≡s₁₂</a> <a id="953" class="Keyword">in</a>
  <a id="958" href="ValueSepUTxO.HoareProperties.html#877" class="Bound">s₁</a> <a id="961" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="963" href="ValueSepUTxO.HoareProperties.html#882" class="Bound">s₂</a> <a id="966" href="ValueSepUTxO.Maps.html#1005" class="Function Operator">∪</a> <a id="968" href="ValueSepUTxO.HoareProperties.html#866" class="Bound">s₃</a> <a id="971" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="973" href="ValueSepUTxO.HoareProperties.html#920" class="Bound">≡s₂₃</a> <a id="978" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="980" href="ValueSepUTxO.HoareProperties.html#894" class="Bound">Ps₁</a> <a id="984" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="986" class="Symbol">(</a><a id="987" href="ValueSepUTxO.HoareProperties.html#882" class="Bound">s₂</a> <a id="990" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="992" href="ValueSepUTxO.HoareProperties.html#866" class="Bound">s₃</a> <a id="995" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="997" class="Symbol">(</a><a id="998" href="ValueSepUTxO.HoareProperties.html#927" class="Bound">s₂♯s₃</a> <a id="1004" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1006" href="ValueSepUTxO.Maps.html#1512" class="Function">≈-refl</a><a id="1012" class="Symbol">)</a> <a id="1014" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1016" href="ValueSepUTxO.HoareProperties.html#900" class="Bound">Qs₂</a> <a id="1020" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1022" href="ValueSepUTxO.HoareProperties.html#907" class="Bound">Rs₃</a><a id="1025" class="Symbol">)</a>

<a id="1028" class="Comment">-- ** Useful lemmas when transferring a value between participants in the minimal context.</a>
<a id="transfer"></a><a id="1119" href="ValueSepUTxO.HoareProperties.html#1119" class="Function">transfer</a> <a id="1128" class="Symbol">:</a> <a id="1130" class="Symbol">∀</a> <a id="1132" class="Symbol">{</a><a id="1133" href="ValueSepUTxO.HoareProperties.html#1133" class="Bound">tx</a> <a id="1136" class="Symbol">:</a> <a id="1138" href="ValueSepUTxO.UTxO.html#1490" class="Record">Tx</a><a id="1140" class="Symbol">}</a> <a id="1142" class="Symbol">{</a><a id="1143" href="ValueSepUTxO.HoareProperties.html#1143" class="Bound">v</a> <a id="1145" class="Symbol">:</a> <a id="1147" href="ValueSepUTxO.UTxO.html#408" class="Function">Value</a><a id="1152" class="Symbol">}</a> <a id="1154" class="Symbol">{</a><a id="1155" href="ValueSepUTxO.HoareProperties.html#1155" class="Bound">B</a> <a id="1157" class="Symbol">:</a> <a id="1159" href="ValueSepUTxO.UTxO.html#432" class="Function">Address</a><a id="1166" class="Symbol">}</a> <a id="1168" class="Symbol">{</a><a id="1169" href="ValueSepUTxO.HoareProperties.html#1169" class="Bound">or</a> <a id="1172" class="Symbol">:</a> <a id="1174" href="ValueSepUTxO.UTxO.html#552" class="Record">TxOutputRef</a><a id="1185" class="Symbol">}</a> <a id="1187" class="Symbol">{</a><a id="1188" href="ValueSepUTxO.HoareProperties.html#1188" class="Bound">rdm</a> <a id="1192" class="Symbol">:</a> <a id="1194" href="ValueSepUTxO.UTxO.html#492" class="Function">DATA</a><a id="1198" class="Symbol">}</a> <a id="1200" class="Symbol">{</a><a id="1201" href="ValueSepUTxO.HoareProperties.html#1201" class="Bound">val</a> <a id="1205" class="Symbol">:</a> <a id="1207" href="ValueSepUTxO.UTxO.html#1066" class="Record">TxInfo</a> <a id="1214" class="Symbol">→</a> <a id="1216" href="ValueSepUTxO.UTxO.html#492" class="Function">DATA</a> <a id="1221" class="Symbol">→</a> <a id="1223" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a><a id="1227" class="Symbol">}</a> <a id="1229" class="Symbol">→</a>
  <a id="1233" href="Prelude.InferenceRules.html#56118" class="Function Operator">∙</a> <a id="1235" href="Data.Bool.Base.html#1451" class="Function">T</a> <a id="1237" class="Symbol">(</a><a id="1238" href="ValueSepUTxO.HoareProperties.html#1201" class="Bound">val</a> <a id="1242" class="Symbol">(</a><a id="1243" href="ValueSepUTxO.UTxO.html#1604" class="Function">mkTxInfo</a> <a id="1252" href="ValueSepUTxO.HoareProperties.html#1133" class="Bound">tx</a><a id="1254" class="Symbol">)</a> <a id="1256" href="ValueSepUTxO.HoareProperties.html#1188" class="Bound">rdm</a><a id="1259" class="Symbol">)</a>
  <a id="1263" href="Prelude.InferenceRules.html#56049" class="Function Operator">∙</a> <a id="1265" href="ValueSepUTxO.HoareProperties.html#1133" class="Bound">tx</a> <a id="1268" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1270" class="Keyword">record</a> <a id="1277" class="Symbol">{</a> <a id="1279" class="Field">inputs</a>  <a id="1287" class="Symbol">=</a> <a id="1289" href="Data.List.Base.html#5025" class="Function Operator">[</a> <a id="1291" class="Keyword">record</a> <a id="1298" class="Symbol">{</a><a id="1299" class="Field">outputRef</a> <a id="1309" class="Symbol">=</a> <a id="1311" href="ValueSepUTxO.HoareProperties.html#1169" class="Bound">or</a><a id="1313" class="Symbol">;</a> <a id="1315" class="Field">validator</a> <a id="1325" class="Symbol">=</a> <a id="1327" href="ValueSepUTxO.HoareProperties.html#1201" class="Bound">val</a><a id="1330" class="Symbol">;</a> <a id="1332" class="Field">redeemer</a> <a id="1341" class="Symbol">=</a> <a id="1343" href="ValueSepUTxO.HoareProperties.html#1188" class="Bound">rdm</a><a id="1346" class="Symbol">}</a> <a id="1348" href="Data.List.Base.html#5025" class="Function Operator">]</a>
                <a id="1366" class="Symbol">;</a> <a id="1368" class="Field">outputs</a> <a id="1376" class="Symbol">=</a> <a id="1378" href="Data.List.Base.html#5025" class="Function Operator">[</a> <a id="1380" href="ValueSepUTxO.HoareProperties.html#1143" class="Bound">v</a> <a id="1382" href="ValueSepUTxO.UTxO.html#784" class="InductiveConstructor Operator">at</a> <a id="1385" href="ValueSepUTxO.HoareProperties.html#1155" class="Bound">B</a> <a id="1387" href="Data.List.Base.html#5025" class="Function Operator">]</a>
                <a id="1405" class="Symbol">;</a> <a id="1407" class="Field">forge</a>   <a id="1415" class="Symbol">=</a> <a id="1417" class="Number">0</a> <a id="1419" class="Symbol">}</a>
    <a id="1425" href="Prelude.InferenceRules.html#13579" class="Function Operator">────────────────────────────────────</a>
    <a id="1466" href="ValueSepUTxO.HoareLogic.html#1173" class="Function Operator">⟨</a> <a id="1468" href="ValueSepUTxO.HoareProperties.html#1169" class="Bound">or</a> <a id="1471" href="ValueSepUTxO.HoareLogic.html#798" class="Function Operator">↦</a> <a id="1473" href="ValueSepUTxO.HoareProperties.html#1143" class="Bound">v</a> <a id="1475" href="ValueSepUTxO.UTxO.html#784" class="InductiveConstructor Operator">at</a> <a id="1478" class="Symbol">(</a><a id="1479" href="ValueSepUTxO.HoareProperties.html#1201" class="Bound">val</a> <a id="1483" href="ValueSepUTxO.UTxO.html#459" class="Postulate Operator">♯</a><a id="1484" class="Symbol">)</a> <a id="1486" href="ValueSepUTxO.HoareLogic.html#1173" class="Function Operator">⟩</a>
    <a id="1492" href="Data.List.Base.html#5025" class="Function Operator">[</a> <a id="1494" href="ValueSepUTxO.HoareProperties.html#1133" class="Bound">tx</a> <a id="1497" href="Data.List.Base.html#5025" class="Function Operator">]</a>
    <a id="1503" href="ValueSepUTxO.HoareLogic.html#1173" class="Function Operator">⟨</a> <a id="1505" class="Symbol">(</a><a id="1506" href="ValueSepUTxO.HoareProperties.html#1133" class="Bound">tx</a> <a id="1509" href="ValueSepUTxO.UTxO.html#459" class="Postulate Operator">♯</a><a id="1510" class="Symbol">)</a> <a id="1512" href="ValueSepUTxO.UTxO.html#590" class="InductiveConstructor Operator">indexed-at</a> <a id="1523" class="Number">0</a> <a id="1525" href="ValueSepUTxO.HoareLogic.html#798" class="Function Operator">↦</a> <a id="1527" href="ValueSepUTxO.HoareProperties.html#1143" class="Bound">v</a> <a id="1529" href="ValueSepUTxO.UTxO.html#784" class="InductiveConstructor Operator">at</a> <a id="1532" href="ValueSepUTxO.HoareProperties.html#1155" class="Bound">B</a> <a id="1534" href="ValueSepUTxO.HoareLogic.html#1173" class="Function Operator">⟩</a>
<a id="1536" href="ValueSepUTxO.HoareProperties.html#1119" class="Function">transfer</a> <a id="1545" class="Symbol">=</a> <a id="1547" class="Hole">{!!}</a>

<a id="1553" class="Keyword">open</a> <a id="1558" href="ValueSepUTxO.HoareLogic.html#3167" class="Module">HoareReasoning</a>
<a id="transferℝ"></a><a id="1573" href="ValueSepUTxO.HoareProperties.html#1573" class="Function">transferℝ</a> <a id="1583" class="Symbol">:</a> <a id="1585" class="Symbol">∀</a> <a id="1587" class="Symbol">{</a><a id="1588" href="ValueSepUTxO.HoareProperties.html#1588" class="Bound">tx</a> <a id="1591" class="Symbol">:</a> <a id="1593" href="ValueSepUTxO.UTxO.html#1490" class="Record">Tx</a><a id="1595" class="Symbol">}</a> <a id="1597" class="Symbol">{</a><a id="1598" href="ValueSepUTxO.HoareProperties.html#1598" class="Bound">v</a> <a id="1600" class="Symbol">:</a> <a id="1602" href="ValueSepUTxO.UTxO.html#408" class="Function">Value</a><a id="1607" class="Symbol">}</a> <a id="1609" class="Symbol">{</a><a id="1610" href="ValueSepUTxO.HoareProperties.html#1610" class="Bound">B</a> <a id="1612" class="Symbol">:</a> <a id="1614" href="ValueSepUTxO.UTxO.html#432" class="Function">Address</a><a id="1621" class="Symbol">}</a> <a id="1623" class="Symbol">{</a><a id="1624" href="ValueSepUTxO.HoareProperties.html#1624" class="Bound">or</a> <a id="1627" class="Symbol">:</a> <a id="1629" href="ValueSepUTxO.UTxO.html#552" class="Record">TxOutputRef</a><a id="1640" class="Symbol">}</a> <a id="1642" class="Symbol">{</a><a id="1643" href="ValueSepUTxO.HoareProperties.html#1643" class="Bound">rdm</a> <a id="1647" class="Symbol">:</a> <a id="1649" href="ValueSepUTxO.UTxO.html#492" class="Function">DATA</a><a id="1653" class="Symbol">}</a> <a id="1655" class="Symbol">{</a><a id="1656" href="ValueSepUTxO.HoareProperties.html#1656" class="Bound">val</a> <a id="1660" class="Symbol">:</a> <a id="1662" href="ValueSepUTxO.UTxO.html#1066" class="Record">TxInfo</a> <a id="1669" class="Symbol">→</a> <a id="1671" href="ValueSepUTxO.UTxO.html#492" class="Function">DATA</a> <a id="1676" class="Symbol">→</a> <a id="1678" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a><a id="1682" class="Symbol">}</a> <a id="1684" class="Symbol">→</a>
  <a id="1688" href="Prelude.InferenceRules.html#56118" class="Function Operator">∙</a> <a id="1690" href="Data.Bool.Base.html#1451" class="Function">T</a> <a id="1692" class="Symbol">(</a><a id="1693" href="ValueSepUTxO.HoareProperties.html#1656" class="Bound">val</a> <a id="1697" class="Symbol">(</a><a id="1698" href="ValueSepUTxO.UTxO.html#1604" class="Function">mkTxInfo</a> <a id="1707" href="ValueSepUTxO.HoareProperties.html#1588" class="Bound">tx</a><a id="1709" class="Symbol">)</a> <a id="1711" href="ValueSepUTxO.HoareProperties.html#1643" class="Bound">rdm</a><a id="1714" class="Symbol">)</a>
  <a id="1718" href="Prelude.InferenceRules.html#56049" class="Function Operator">∙</a> <a id="1720" href="ValueSepUTxO.HoareProperties.html#1588" class="Bound">tx</a> <a id="1723" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1725" class="Keyword">record</a> <a id="1732" class="Symbol">{</a> <a id="1734" class="Field">inputs</a>  <a id="1742" class="Symbol">=</a> <a id="1744" href="Data.List.Base.html#5025" class="Function Operator">[</a> <a id="1746" class="Keyword">record</a> <a id="1753" class="Symbol">{</a><a id="1754" class="Field">outputRef</a> <a id="1764" class="Symbol">=</a> <a id="1766" href="ValueSepUTxO.HoareProperties.html#1624" class="Bound">or</a><a id="1768" class="Symbol">;</a> <a id="1770" class="Field">validator</a> <a id="1780" class="Symbol">=</a> <a id="1782" href="ValueSepUTxO.HoareProperties.html#1656" class="Bound">val</a><a id="1785" class="Symbol">;</a> <a id="1787" class="Field">redeemer</a> <a id="1796" class="Symbol">=</a> <a id="1798" href="ValueSepUTxO.HoareProperties.html#1643" class="Bound">rdm</a><a id="1801" class="Symbol">}</a> <a id="1803" href="Data.List.Base.html#5025" class="Function Operator">]</a>
                <a id="1821" class="Symbol">;</a> <a id="1823" class="Field">outputs</a> <a id="1831" class="Symbol">=</a> <a id="1833" href="Data.List.Base.html#5025" class="Function Operator">[</a> <a id="1835" href="ValueSepUTxO.HoareProperties.html#1598" class="Bound">v</a> <a id="1837" href="ValueSepUTxO.UTxO.html#784" class="InductiveConstructor Operator">at</a> <a id="1840" href="ValueSepUTxO.HoareProperties.html#1610" class="Bound">B</a> <a id="1842" href="Data.List.Base.html#5025" class="Function Operator">]</a>
                <a id="1860" class="Symbol">;</a> <a id="1862" class="Field">forge</a>   <a id="1870" class="Symbol">=</a> <a id="1872" class="Number">0</a> <a id="1874" class="Symbol">}</a>
    <a id="1880" href="Prelude.InferenceRules.html#13579" class="Function Operator">────────────────────────────────────</a>
    <a id="1921" href="ValueSepUTxO.HoareLogic.html#3249" class="Record Operator">ℝ⟨</a> <a id="1924" href="ValueSepUTxO.HoareProperties.html#1624" class="Bound">or</a> <a id="1927" href="ValueSepUTxO.HoareLogic.html#798" class="Function Operator">↦</a> <a id="1929" href="ValueSepUTxO.HoareProperties.html#1598" class="Bound">v</a> <a id="1931" href="ValueSepUTxO.UTxO.html#784" class="InductiveConstructor Operator">at</a> <a id="1934" class="Symbol">(</a><a id="1935" href="ValueSepUTxO.HoareProperties.html#1656" class="Bound">val</a> <a id="1939" href="ValueSepUTxO.UTxO.html#459" class="Postulate Operator">♯</a><a id="1940" class="Symbol">)</a> <a id="1942" href="ValueSepUTxO.HoareLogic.html#3249" class="Record Operator">⟩</a>
    <a id="1948" href="Data.List.Base.html#5025" class="Function Operator">[</a> <a id="1950" href="ValueSepUTxO.HoareProperties.html#1588" class="Bound">tx</a> <a id="1953" href="Data.List.Base.html#5025" class="Function Operator">]</a>
    <a id="1959" href="ValueSepUTxO.HoareLogic.html#3249" class="Record Operator">⟨</a> <a id="1961" class="Symbol">(</a><a id="1962" href="ValueSepUTxO.HoareProperties.html#1588" class="Bound">tx</a> <a id="1965" href="ValueSepUTxO.UTxO.html#459" class="Postulate Operator">♯</a><a id="1966" class="Symbol">)</a> <a id="1968" href="ValueSepUTxO.UTxO.html#590" class="InductiveConstructor Operator">indexed-at</a> <a id="1979" class="Number">0</a> <a id="1981" href="ValueSepUTxO.HoareLogic.html#798" class="Function Operator">↦</a> <a id="1983" href="ValueSepUTxO.HoareProperties.html#1598" class="Bound">v</a> <a id="1985" href="ValueSepUTxO.UTxO.html#784" class="InductiveConstructor Operator">at</a> <a id="1988" href="ValueSepUTxO.HoareProperties.html#1610" class="Bound">B</a> <a id="1990" href="ValueSepUTxO.HoareLogic.html#3249" class="Record Operator">⟩</a>
<a id="1992" href="ValueSepUTxO.HoareProperties.html#1573" class="Function">transferℝ</a> <a id="2002" href="ValueSepUTxO.HoareProperties.html#2002" class="Bound">val</a> <a id="2006" href="ValueSepUTxO.HoareProperties.html#2006" class="Bound">tx≡</a> <a id="2010" class="Symbol">=</a> <a id="2012" href="ValueSepUTxO.HoareLogic.html#3326" class="InductiveConstructor Operator">mkℝ</a> <a id="2016" href="ValueSepUTxO.HoareProperties.html#1119" class="Function">transfer</a> <a id="2025" href="ValueSepUTxO.HoareProperties.html#2002" class="Bound">val</a> <a id="2029" href="ValueSepUTxO.HoareProperties.html#2006" class="Bound">tx≡</a>

<a id="2034" class="Comment">-- _↝⟨_⟩_ : ∀ A v B {vᵃ}{vᵇ}{v≤ : v ≤ vᵃ} → ⟨ A ↦ vᵃ ∗ B ↦ vᵇ ⟩ [ A —→⟨ v ⟩ B ] ⟨ A ↦ (vᵃ ∸ v) ∗ B ↦ (vᵇ + v) ⟩</a>
<a id="2146" class="Comment">-- (A ↝⟨ v ⟩ B) {vᵃ}{vᵇ}{vᵃ≤v} {s} (s₁ , s₂ , ≡s , As₁ , Bs₂)</a>
<a id="2208" class="Comment">--   with s₁ A | As₁ | ↦-⊎ˡ {s₁ = s₁}{A}{vᵃ}{s₂} As₁ | ≡s A</a>
<a id="2268" class="Comment">-- ... | .(just vᵃ) | refl | .(s₂ ⁉⁰ A) , refl , p | sA≡</a>
<a id="2325" class="Comment">--   with s₂ B | Bs₂ | ↦-⊎ʳ {s₂ = s₂}{B}{vᵇ}{s₁} Bs₂ | ≡s B</a>
<a id="2385" class="Comment">-- ... | .(just vᵇ) | refl | .(s₁ ⁉⁰ B) , refl , q | sB≡</a>
<a id="2442" class="Comment">--   with s A | trans (sym sA≡) p</a>
<a id="2476" class="Comment">-- ... | .(just (vᵃ ⊎ (s₂ ⁉⁰ A))) | refl</a>
<a id="2517" class="Comment">--   with s B | trans (sym sB≡) q</a>
<a id="2551" class="Comment">-- ... | .(just ((s₁ ⁉⁰ B) ⊎ vᵇ)) | refl</a>
<a id="2592" class="Comment">--   with v ≤? vᵃ ⊎ (s₂ ⁉⁰ A)</a>
<a id="2622" class="Comment">-- ... | no  v≰ = ⊥-elim $ v≰ $ Nat.≤-stepsʳ (s₂ ⁉⁰ A) $ vᵃ≤v</a>
<a id="2684" class="Comment">-- ... | yes v≤</a>
<a id="2700" class="Comment">--   = ret↑ (_s₁′ , _s₂′ , ≡s′ , As₁′ , Bs₂′)</a>
<a id="2746" class="Comment">--   where</a>
<a id="2757" class="Comment">--     sA≡′ : s A ≡ just (vᵃ ⊎ (s₂ ⁉⁰ A))</a>
<a id="2799" class="Comment">--     sA≡′ = trans (sym sA≡) p</a>

<a id="2832" class="Comment">--     sB≡′ : s B ≡ just ((s₁ ⁉⁰ B) ⊎ vᵇ)</a>
<a id="2874" class="Comment">--     sB≡′ = trans (sym sB≡) q</a>

<a id="2907" class="Comment">--     _s₁′ = s₁ [ A ↝ (_∸ v) ]</a>
<a id="2939" class="Comment">--     _s₂′ = s₂ [ B ↝ (_+ v) ]</a>

<a id="2972" class="Comment">--     _s′ = s [ A ↝ (_∸ v) ]</a>
<a id="3002" class="Comment">--             [ B ↝ (_+ v) ]</a>

<a id="3033" class="Comment">--     As₁′ : _s₁′ A ≡ just (vᵃ ∸ v)</a>
<a id="3070" class="Comment">--     As₁′ rewrite As₁ | ≟-refl A = refl</a>

<a id="3113" class="Comment">--     Bs₂′ : _s₂′ B ≡ just (vᵇ + v)</a>
<a id="3150" class="Comment">--     Bs₂′ rewrite Bs₂ | ≟-refl B = refl</a>

<a id="3193" class="Comment">--     ≡s′ : ⟨ _s₁′ ⊎ _s₂′ ⟩≡ _s′</a>
<a id="3227" class="Comment">--     ≡s′ k</a>
<a id="3240" class="Comment">--       rewrite sym $ ≡s k</a>
<a id="3268" class="Comment">--       with k ≟ A | k ≟ B</a>
<a id="3296" class="Comment">--     ≡s′ k | yes refl | yes refl -- ∙ k ≡ A ≡ B</a>
<a id="3346" class="Comment">--       rewrite ≟-refl A | ≟-refl B | As₁ | Bs₂</a>
<a id="3395" class="Comment">--       = cong just</a>
<a id="3416" class="Comment">--       $ begin (vᵃ ∸ v) + (vᵇ + v) ≡⟨ sym $ Nat.+-∸-comm _ vᵃ≤v ⟩</a>
<a id="3484" class="Comment">--               vᵃ + (vᵇ + v) ∸ v   ≡⟨ cong (_∸ v) $ sym $ Nat.+-assoc _ vᵇ v ⟩</a>
<a id="3565" class="Comment">--               (vᵃ + vᵇ) + v ∸ v   ≡⟨ Nat.m+n∸n≡m _ v ⟩</a>
<a id="3623" class="Comment">--               (vᵃ + vᵇ)           ≡⟨ sym $ Nat.m∸n+n≡m v≤ ⟩</a>
<a id="3686" class="Comment">--               (vᵃ + vᵇ) ∸ v + v   ∎ where open ≡-Reasoning</a>
<a id="3748" class="Comment">--     ≡s′ k | yes refl | no k≢B -- ∙ k ≡ A</a>
<a id="3792" class="Comment">--       rewrite ≟-refl A | As₁</a>
<a id="3824" class="Comment">--       with s₂ A</a>
<a id="3843" class="Comment">--     ... | nothing = refl</a>
<a id="3871" class="Comment">--     ... | just _  = cong just $ sym $ Nat.+-∸-comm _ vᵃ≤v</a>
<a id="3932" class="Comment">--     ≡s′ k | no k≢A   | yes refl -- ∙ k ≡ B</a>
<a id="3978" class="Comment">--       rewrite ≟-refl B | Bs₂</a>
<a id="4010" class="Comment">--       with s₁ B</a>
<a id="4029" class="Comment">--     ... | nothing  = refl</a>
<a id="4058" class="Comment">--     ... | just _   = cong just $ sym $ Nat.+-assoc _ vᵇ v</a>
<a id="4119" class="Comment">--     ≡s′ k | no k≢A   | no k≢B -- ∙ k ∉ {A, B}</a>
<a id="4168" class="Comment">--       rewrite M.map-id (s₁ k) | M.map-id (s₂ k) | M.map-id (s₁ k ⊎ s₂ k) | M.map-id (s₁ k ⊎ s₂ k)</a>
<a id="4269" class="Comment">--       = refl</a>

<a id="4286" class="Comment">-- _↝⁰_ : ∀ A B → ⟨ A ↦ v ∗ B ↦ v′ ⟩ [ A —→⟨ v ⟩ B ] ⟨ A ↦ 0 ∗ B ↦ (v′ + v) ⟩</a>
<a id="4364" class="Comment">-- _↝⁰_ {v = v} {v′ = v′} A B with p ← (A ↝⟨ v ⟩ B) {vᵇ = v′} {v≤ = ≤-refl {x = v}} rewrite Nat.n∸n≡0 v = p</a>

<a id="4473" class="Comment">-- _↜⟨_⟩_ : ∀ A v B {vᵃ}{vᵇ}{v≤ : v ≤ vᵇ} → ⟨ A ↦ vᵃ ∗ B ↦ vᵇ ⟩ [ B —→⟨ v ⟩ A ] ⟨ A ↦ (vᵃ + v) ∗ B ↦ (vᵇ ∸ v) ⟩</a>
<a id="4585" class="Comment">-- (A ↜⟨ v ⟩ B) {vᵃ}{vᵇ}{v≤} (s₁ , s₂ , ≡s , As₁ , Bs₂)</a>
<a id="4641" class="Comment">--   = map↑ (λ where (s₁′ , s₂′ , ≡s′ , As₁′ , Bs₂′) → s₂′ , s₁′ , ⊎≡-comm {x = s₁′} ≡s′ , Bs₂′ , As₁′)</a>
<a id="4745" class="Comment">--          ((B ↝⟨ v ⟩ A) {v≤ = v≤} (s₂ , s₁ , ⊎≡-comm {x = s₁} ≡s , Bs₂ , As₁))</a>

<a id="4827" class="Comment">-- _↜⁰_ : ∀ A B → ⟨ A ↦ v′ ∗ B ↦ v ⟩ [ B —→⟨ v ⟩ A ] ⟨ A ↦ (v′ + v) ∗ B ↦ 0 ⟩</a>
<a id="4905" class="Comment">-- _↜⁰_ {v′ = v′} {v = v} A B with p ← (A ↜⟨ v ⟩ B) {vᵃ = v′} {v≤ = ≤-refl {x = v}} rewrite Nat.n∸n≡0 v = p</a>
</pre></body></html>