<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ValueSep.Ledger</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------</a>
<a id="44" class="Comment">-- ** Denotational &amp; operational semantics</a>

<a id="88" class="Keyword">open</a> <a id="93" class="Keyword">import</a> <a id="100" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="113" class="Keyword">open</a> <a id="118" class="Keyword">import</a> <a id="125" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="141" class="Keyword">open</a> <a id="146" class="Keyword">import</a> <a id="153" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="167" class="Keyword">open</a> <a id="172" class="Keyword">import</a> <a id="179" href="Prelude.Decidable.html" class="Module">Prelude.Decidable</a>
<a id="197" class="Comment">-- open import Prelude.Maps</a>
<a id="225" class="Keyword">open</a> <a id="230" class="Keyword">import</a> <a id="237" href="ValueSep.Maps.html" class="Module">ValueSep.Maps</a>
<a id="251" class="Keyword">open</a> <a id="256" class="Keyword">import</a> <a id="263" href="Prelude.Ord.html" class="Module">Prelude.Ord</a>
<a id="275" class="Keyword">open</a> <a id="280" class="Keyword">import</a> <a id="287" href="Prelude.Semigroup.html" class="Module">Prelude.Semigroup</a>
<a id="305" class="Keyword">open</a> <a id="310" class="Keyword">import</a> <a id="317" href="Prelude.Monoid.html" class="Module">Prelude.Monoid</a>
<a id="332" class="Keyword">open</a> <a id="337" class="Keyword">import</a> <a id="344" href="Prelude.Functor.html" class="Module">Prelude.Functor</a>
<a id="360" class="Keyword">open</a> <a id="365" class="Keyword">import</a> <a id="372" href="Prelude.InferenceRules.html" class="Module">Prelude.InferenceRules</a>
<a id="395" class="Keyword">open</a> <a id="400" class="Keyword">import</a> <a id="407" href="Prelude.Apartness.html" class="Module">Prelude.Apartness</a>
<a id="425" class="Keyword">open</a> <a id="430" class="Keyword">import</a> <a id="437" href="Prelude.Monad.html" class="Module">Prelude.Monad</a>

<a id="452" class="Keyword">module</a> <a id="459" href="ValueSep.Ledger.html" class="Module">ValueSep.Ledger</a>
  <a id="477" class="Symbol">(</a><a id="478" href="ValueSep.Ledger.html#478" class="Bound">Part</a> <a id="483" class="Symbol">:</a> <a id="485" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="488" class="Symbol">)</a> <a id="490" class="Comment">-- a fixed set of participants</a>
  <a id="523" class="Symbol">⦃</a> <a id="525" href="ValueSep.Ledger.html#525" class="Bound">_</a> <a id="527" class="Symbol">:</a> <a id="529" href="Prelude.DecEq.Core.html#97" class="Record">DecEq</a> <a id="535" href="ValueSep.Ledger.html#478" class="Bound">Part</a> <a id="540" class="Symbol">⦄</a>
  <a id="544" class="Keyword">where</a>

<a id="551" class="Keyword">variable</a>
  <a id="562" href="ValueSep.Ledger.html#562" class="Generalizable">A</a> <a id="564" href="ValueSep.Ledger.html#564" class="Generalizable">B</a> <a id="566" href="ValueSep.Ledger.html#566" class="Generalizable">C</a> <a id="568" href="ValueSep.Ledger.html#568" class="Generalizable">D</a> <a id="570" class="Symbol">:</a> <a id="572" href="ValueSep.Ledger.html#478" class="Bound">Part</a>
  <a id="579" href="ValueSep.Ledger.html#579" class="Generalizable">v</a> <a id="581" href="ValueSep.Ledger.html#581" class="Generalizable">v′</a> <a id="584" href="ValueSep.Ledger.html#584" class="Generalizable">v″</a> <a id="587" class="Symbol">:</a> <a id="589" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>

<a id="592" class="Comment">-- The state of a ledger is a collection of participants, along with their balance.</a>
<a id="S"></a><a id="676" href="ValueSep.Ledger.html#676" class="Function">S</a> <a id="678" class="Symbol">:</a> <a id="680" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="684" href="ValueSep.Ledger.html#676" class="Function">S</a> <a id="686" class="Symbol">=</a> <a id="688" href="ValueSep.Maps.html#424" class="Function">Map⟨</a> <a id="693" href="ValueSep.Ledger.html#478" class="Bound">Part</a> <a id="698" href="ValueSep.Maps.html#424" class="Function">↦</a> <a id="700" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="702" href="ValueSep.Maps.html#424" class="Function">⟩</a>

<a id="705" class="Keyword">instance</a>
  <a id="Sℕ"></a><a id="716" href="ValueSep.Ledger.html#716" class="Function">Sℕ</a>  <a id="720" class="Symbol">=</a> <a id="722" href="Prelude.Semigroup.html#2075" class="Function">Semigroup-ℕ-+</a>
  <a id="Sℕ⁺"></a><a id="738" href="ValueSep.Ledger.html#738" class="Function">Sℕ⁺</a> <a id="742" class="Symbol">=</a> <a id="744" href="Prelude.Semigroup.html#2366" class="Function">SemigroupLaws-ℕ-+</a>
  <a id="Mℕ"></a><a id="764" href="ValueSep.Ledger.html#764" class="Function">Mℕ</a>  <a id="768" class="Symbol">=</a> <a id="770" href="Prelude.Monoid.html#1313" class="Function">Monoid-ℕ-+</a>
  <a id="Mℕ⁺"></a><a id="783" href="ValueSep.Ledger.html#783" class="Function">Mℕ⁺</a> <a id="787" class="Symbol">=</a> <a id="789" href="Prelude.Monoid.html#1387" class="Function">MonoidLaws-ℕ-+</a>

<a id="805" class="Comment">-- A transaction is transferring money from one participant to another.</a>
<a id="877" class="Keyword">record</a> <a id="Tx"></a><a id="884" href="ValueSep.Ledger.html#884" class="Record">Tx</a> <a id="887" class="Symbol">:</a> <a id="889" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="893" class="Keyword">where</a>
  <a id="901" class="Keyword">constructor</a> <a id="_—→⟨_⟩_"></a><a id="913" href="ValueSep.Ledger.html#913" class="InductiveConstructor Operator">_—→⟨_⟩_</a>
  <a id="923" class="Keyword">field</a>
    <a id="Tx.sender"></a><a id="933" href="ValueSep.Ledger.html#933" class="Field">sender</a>   <a id="942" class="Symbol">:</a> <a id="944" href="ValueSep.Ledger.html#478" class="Bound">Part</a>
    <a id="Tx.value"></a><a id="953" href="ValueSep.Ledger.html#953" class="Field">value</a>    <a id="962" class="Symbol">:</a> <a id="964" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
    <a id="Tx.receiver"></a><a id="970" href="ValueSep.Ledger.html#970" class="Field">receiver</a> <a id="979" class="Symbol">:</a> <a id="981" href="ValueSep.Ledger.html#478" class="Bound">Part</a>
<a id="986" class="Keyword">open</a> <a id="991" href="ValueSep.Ledger.html#884" class="Module">Tx</a> <a id="994" class="Keyword">public</a>
<a id="1001" class="Keyword">unquoteDecl</a> <a id="DecEq-Tx"></a><a id="1013" href="ValueSep.Ledger.html#1013" class="Function">DecEq-Tx</a> <a id="1022" class="Symbol">=</a> <a id="1024" href="Prelude.Generics.html#9474" class="Function">DERIVE</a> <a id="1031" href="Prelude.DecEq.Core.html#97" class="Record">DecEq</a> <a id="1037" href="Data.List.Base.html#5025" class="Function Operator">[</a> <a id="1039" class="Keyword">quote</a> <a id="1045" href="ValueSep.Ledger.html#884" class="Record">Tx</a> <a id="1048" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1050" href="ValueSep.Ledger.html#1013" class="Function">DecEq-Tx</a> <a id="1059" href="Data.List.Base.html#5025" class="Function Operator">]</a>

<a id="1062" class="Comment">-- A ledger is a list of transactions.</a>
<a id="L"></a><a id="1101" href="ValueSep.Ledger.html#1101" class="Function">L</a> <a id="1103" class="Symbol">=</a> <a id="1105" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1110" href="ValueSep.Ledger.html#884" class="Record">Tx</a>

<a id="1114" class="Keyword">variable</a>
  <a id="1125" href="ValueSep.Ledger.html#1125" class="Generalizable">s</a> <a id="1127" href="ValueSep.Ledger.html#1127" class="Generalizable">s′</a> <a id="1130" href="ValueSep.Ledger.html#1130" class="Generalizable">s″</a> <a id="1133" href="ValueSep.Ledger.html#1133" class="Generalizable">s₁</a> <a id="1136" href="ValueSep.Ledger.html#1136" class="Generalizable">s₁′</a> <a id="1140" href="ValueSep.Ledger.html#1140" class="Generalizable">s₁″</a> <a id="1144" href="ValueSep.Ledger.html#1144" class="Generalizable">s₂</a> <a id="1147" href="ValueSep.Ledger.html#1147" class="Generalizable">s₂′</a> <a id="1151" href="ValueSep.Ledger.html#1151" class="Generalizable">s₂″</a> <a id="1155" href="ValueSep.Ledger.html#1155" class="Generalizable">s₃</a> <a id="1158" href="ValueSep.Ledger.html#1158" class="Generalizable">s₃′</a> <a id="1162" href="ValueSep.Ledger.html#1162" class="Generalizable">s₃″</a> <a id="1166" href="ValueSep.Ledger.html#1166" class="Generalizable">s₂₃</a> <a id="1170" href="ValueSep.Ledger.html#1170" class="Generalizable">s₂₃′</a> <a id="1175" href="ValueSep.Ledger.html#1175" class="Generalizable">s₂₃″</a> <a id="1180" class="Symbol">:</a> <a id="1182" href="ValueSep.Ledger.html#676" class="Function">S</a>
  <a id="1186" href="ValueSep.Ledger.html#1186" class="Generalizable">t</a> <a id="1188" href="ValueSep.Ledger.html#1188" class="Generalizable">t′</a> <a id="1191" href="ValueSep.Ledger.html#1191" class="Generalizable">t″</a> <a id="1194" class="Symbol">:</a> <a id="1196" href="ValueSep.Ledger.html#884" class="Record">Tx</a>
  <a id="1201" href="ValueSep.Ledger.html#1201" class="Generalizable">l</a> <a id="1203" href="ValueSep.Ledger.html#1203" class="Generalizable">l′</a> <a id="1206" href="ValueSep.Ledger.html#1206" class="Generalizable">l″</a> <a id="1209" href="ValueSep.Ledger.html#1209" class="Generalizable">l₁</a> <a id="1212" href="ValueSep.Ledger.html#1212" class="Generalizable">l₂</a> <a id="1215" class="Symbol">:</a> <a id="1217" href="ValueSep.Ledger.html#1101" class="Function">L</a>
  <a id="1221" href="ValueSep.Ledger.html#1221" class="Generalizable">ls</a> <a id="1224" href="ValueSep.Ledger.html#1224" class="Generalizable">ls′</a> <a id="1228" href="ValueSep.Ledger.html#1228" class="Generalizable">ls″</a> <a id="1232" class="Symbol">:</a> <a id="1234" href="ValueSep.Ledger.html#1101" class="Function">L</a> <a id="1236" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="1238" href="ValueSep.Ledger.html#676" class="Function">S</a>

  <a id="1243" href="ValueSep.Ledger.html#1243" class="Generalizable">ms</a> <a id="1246" href="ValueSep.Ledger.html#1246" class="Generalizable">ms′</a> <a id="1250" href="ValueSep.Ledger.html#1250" class="Generalizable">ms″</a> <a id="1254" class="Symbol">:</a> <a id="1256" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="1262" href="ValueSep.Ledger.html#676" class="Function">S</a>
  <a id="1266" href="ValueSep.Ledger.html#1266" class="Generalizable">mls</a> <a id="1270" href="ValueSep.Ledger.html#1270" class="Generalizable">mls′</a> <a id="1275" href="ValueSep.Ledger.html#1275" class="Generalizable">mls″</a> <a id="1280" class="Symbol">:</a> <a id="1282" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="1288" class="Symbol">(</a><a id="1289" href="ValueSep.Ledger.html#1101" class="Function">L</a> <a id="1291" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="1293" href="ValueSep.Ledger.html#676" class="Function">S</a><a id="1294" class="Symbol">)</a>

<a id="1297" class="Comment">-- ** Denotational semantics</a>

<a id="1327" class="Comment">-- The meaning of a transaction or a whole ledger will be denoted by state transformers,</a>
<a id="1416" class="Comment">-- i.e. a function from the current state to the updated one that may produce an error.</a>
<a id="Domain"></a><a id="1504" href="ValueSep.Ledger.html#1504" class="Function">Domain</a> <a id="1511" class="Symbol">=</a> <a id="1513" href="ValueSep.Ledger.html#676" class="Function">S</a> <a id="1515" class="Symbol">→</a> <a id="1517" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="1523" href="ValueSep.Ledger.html#676" class="Function">S</a>

<a id="1526" class="Keyword">record</a> <a id="Denotable"></a><a id="1533" href="ValueSep.Ledger.html#1533" class="Record">Denotable</a> <a id="1543" class="Symbol">(</a><a id="1544" href="ValueSep.Ledger.html#1544" class="Bound">A</a> <a id="1546" class="Symbol">:</a> <a id="1548" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="1551" class="Symbol">)</a> <a id="1553" class="Symbol">:</a> <a id="1555" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1559" class="Keyword">where</a>
  <a id="1567" class="Keyword">field</a> <a id="Denotable.⟦_⟧"></a><a id="1573" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦_⟧</a> <a id="1577" class="Symbol">:</a> <a id="1579" href="ValueSep.Ledger.html#1544" class="Bound">A</a> <a id="1581" class="Symbol">→</a> <a id="1583" href="ValueSep.Ledger.html#1504" class="Function">Domain</a>
<a id="1590" class="Keyword">open</a> <a id="1595" href="ValueSep.Ledger.html#1533" class="Module">Denotable</a> <a id="1605" class="Symbol">⦃...⦄</a> <a id="1611" class="Keyword">public</a>

<a id="1619" class="Comment">-- Express the action of tranferring values between keys in a map.</a>
<a id="1686" class="Comment">-- NB: a transaction goes through only when:</a>
<a id="1731" class="Comment">--   1. both participants are present in the domain</a>
<a id="1783" class="Comment">--   2. the sender holds sufficient funds</a>
<a id="1825" class="Keyword">instance</a>
  <a id="1836" class="Comment">-- we denote a transaction as the map transformation that implements the transfer</a>
  <a id="⟦Tx⟧"></a><a id="1920" href="ValueSep.Ledger.html#1920" class="Function">⟦Tx⟧</a> <a id="1925" class="Symbol">:</a> <a id="1927" href="ValueSep.Ledger.html#1533" class="Record">Denotable</a> <a id="1937" href="ValueSep.Ledger.html#884" class="Record">Tx</a>
  <a id="1942" href="ValueSep.Ledger.html#1920" class="Function">⟦Tx⟧</a> <a id="1947" class="Symbol">.</a><a id="1948" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦_⟧</a> <a id="1952" class="Symbol">(</a><a id="1953" href="ValueSep.Ledger.html#1953" class="Bound">A</a> <a id="1955" href="ValueSep.Ledger.html#913" class="InductiveConstructor Operator">—→⟨</a> <a id="1959" href="ValueSep.Ledger.html#1959" class="Bound">v</a> <a id="1961" href="ValueSep.Ledger.html#913" class="InductiveConstructor Operator">⟩</a> <a id="1963" href="ValueSep.Ledger.html#1963" class="Bound">B</a><a id="1964" class="Symbol">)</a> <a id="1966" href="ValueSep.Ledger.html#1966" class="Bound">m</a> <a id="1968" class="Symbol">=</a>
    <a id="1974" href="Function.Base.html#4121" class="Function Operator">case</a> <a id="1979" class="Symbol">(</a><a id="1980" href="ValueSep.Ledger.html#1966" class="Bound">m</a> <a id="1982" href="ValueSep.Ledger.html#1953" class="Bound">A</a> <a id="1984" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1986" href="ValueSep.Ledger.html#1966" class="Bound">m</a> <a id="1988" href="ValueSep.Ledger.html#1963" class="Bound">B</a><a id="1989" class="Symbol">)</a> <a id="1991" href="Function.Base.html#4121" class="Function Operator">of</a> <a id="1994" class="Symbol">λ</a> <a id="1996" class="Keyword">where</a>
      <a id="2008" class="Symbol">(</a><a id="2009" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2014" href="ValueSep.Ledger.html#2014" class="Bound">vᵃ</a> <a id="2017" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2019" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2024" href="ValueSep.Ledger.html#2024" class="Bound">vᵇ</a><a id="2026" class="Symbol">)</a> <a id="2028" class="Symbol">→</a>
        <a id="2038" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="2041" href="ValueSep.Ledger.html#1959" class="Bound">v</a> <a id="2043" href="Prelude.Ord.html#529" class="Function Operator">≤ᵇ</a> <a id="2046" href="ValueSep.Ledger.html#2014" class="Bound">vᵃ</a> <a id="2049" href="Data.Bool.Base.html#1283" class="Function Operator">then</a>
          <a id="2064" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2069" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="2071" href="ValueSep.Ledger.html#1966" class="Bound">m</a> <a id="2073" href="ValueSep.Maps.html#2966" class="Function Operator">[</a> <a id="2075" href="ValueSep.Ledger.html#1953" class="Bound">A</a> <a id="2077" href="ValueSep.Maps.html#2966" class="Function Operator">↝</a> <a id="2079" class="Symbol">(</a><a id="2080" href="Data.Nat.Base.html#2874" class="Primitive Operator">_∸</a> <a id="2083" href="ValueSep.Ledger.html#1959" class="Bound">v</a><a id="2084" class="Symbol">)</a> <a id="2086" href="ValueSep.Maps.html#2966" class="Function Operator">]</a> <a id="2088" href="ValueSep.Maps.html#2966" class="Function Operator">[</a> <a id="2090" href="ValueSep.Ledger.html#1963" class="Bound">B</a> <a id="2092" href="ValueSep.Maps.html#2966" class="Function Operator">↝</a> <a id="2094" class="Symbol">(</a><a id="2095" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">_+</a> <a id="2098" href="ValueSep.Ledger.html#1959" class="Bound">v</a><a id="2099" class="Symbol">)</a> <a id="2101" href="ValueSep.Maps.html#2966" class="Function Operator">]</a>
        <a id="2111" href="Data.Bool.Base.html#1283" class="Function Operator">else</a>
          <a id="2126" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
      <a id="2140" class="CatchallClause Symbol">(_</a><a id="2142" class="CatchallClause"> </a><a id="2143" href="Agda.Builtin.Sigma.html#236" class="CatchallClause InductiveConstructor Operator">,</a><a id="2144" class="CatchallClause"> </a><a id="2145" class="CatchallClause Symbol">_)</a> <a id="2148" class="Symbol">→</a> <a id="2150" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>

  <a id="2161" class="Comment">-- we denote a ledger as the composition of the denotations of its transactions,</a>
  <a id="2244" class="Comment">-- i.e. we run all transactions in sequence</a>
  <a id="⟦L⟧"></a><a id="2290" href="ValueSep.Ledger.html#2290" class="Function">⟦L⟧</a> <a id="2294" class="Symbol">:</a> <a id="2296" href="ValueSep.Ledger.html#1533" class="Record">Denotable</a> <a id="2306" href="ValueSep.Ledger.html#1101" class="Function">L</a>
  <a id="2310" href="ValueSep.Ledger.html#2290" class="Function">⟦L⟧</a> <a id="2314" class="Symbol">.</a><a id="2315" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦_⟧</a> <a id="2319" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>      <a id="2327" href="ValueSep.Ledger.html#2327" class="Bound">s</a> <a id="2329" class="Symbol">=</a> <a id="2331" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2336" href="ValueSep.Ledger.html#2327" class="Bound">s</a>
  <a id="2340" href="ValueSep.Ledger.html#2290" class="Function">⟦L⟧</a> <a id="2344" class="Symbol">.</a><a id="2345" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦_⟧</a> <a id="2349" class="Symbol">(</a><a id="2350" href="ValueSep.Ledger.html#2350" class="Bound">t</a> <a id="2352" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2354" href="ValueSep.Ledger.html#2354" class="Bound">l</a><a id="2355" class="Symbol">)</a> <a id="2357" class="Symbol">=</a> <a id="2359" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="2361" href="ValueSep.Ledger.html#2350" class="Bound">t</a> <a id="2363" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="2365" href="Prelude.Monad.html#681" class="Function Operator">&gt;=&gt;</a> <a id="2369" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="2371" href="ValueSep.Ledger.html#2354" class="Bound">l</a> <a id="2373" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a>

<a id="comp"></a><a id="2376" href="ValueSep.Ledger.html#2376" class="Function">comp</a> <a id="2381" class="Symbol">:</a> <a id="2383" class="Symbol">∀</a> <a id="2385" href="ValueSep.Ledger.html#2385" class="Bound">x</a> <a id="2387" class="Symbol">→</a> <a id="2389" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="2391" href="ValueSep.Ledger.html#1201" class="Generalizable">l</a> <a id="2393" href="Data.List.Base.html#1810" class="Function Operator">++</a> <a id="2396" href="ValueSep.Ledger.html#1203" class="Generalizable">l′</a> <a id="2399" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="2401" href="ValueSep.Ledger.html#2385" class="Bound">x</a> <a id="2403" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="2405" class="Symbol">(</a><a id="2406" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="2408" href="ValueSep.Ledger.html#1201" class="Generalizable">l</a> <a id="2410" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="2412" href="Prelude.Monad.html#681" class="Function Operator">&gt;=&gt;</a> <a id="2416" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="2418" href="ValueSep.Ledger.html#1203" class="Generalizable">l′</a> <a id="2421" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a><a id="2422" class="Symbol">)</a> <a id="2424" href="ValueSep.Ledger.html#2385" class="Bound">x</a>
<a id="2426" href="ValueSep.Ledger.html#2376" class="Function">comp</a> <a id="2431" class="Symbol">{</a><a id="2432" class="Argument">l</a> <a id="2434" class="Symbol">=</a> <a id="2436" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="2438" class="Symbol">}</a>    <a id="2443" class="Symbol">{</a><a id="2444" href="ValueSep.Ledger.html#2444" class="Bound">l′</a><a id="2446" class="Symbol">}</a> <a id="2448" href="ValueSep.Ledger.html#2448" class="Bound">x</a> <a id="2450" class="Symbol">=</a> <a id="2452" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="2457" href="ValueSep.Ledger.html#2376" class="Function">comp</a> <a id="2462" class="Symbol">{</a><a id="2463" class="Argument">l</a> <a id="2465" class="Symbol">=</a> <a id="2467" href="ValueSep.Ledger.html#2467" class="Bound">t</a> <a id="2469" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2471" href="ValueSep.Ledger.html#2471" class="Bound">l</a><a id="2472" class="Symbol">}</a> <a id="2474" class="Symbol">{</a><a id="2475" href="ValueSep.Ledger.html#2475" class="Bound">l′</a><a id="2477" class="Symbol">}</a> <a id="2479" href="ValueSep.Ledger.html#2479" class="Bound">x</a> <a id="2481" class="Keyword">with</a> <a id="2486" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="2488" href="ValueSep.Ledger.html#2467" class="Bound">t</a> <a id="2490" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="2492" href="ValueSep.Ledger.html#2479" class="Bound">x</a>
<a id="2494" class="Symbol">...</a> <a id="2498" class="Symbol">|</a> <a id="2500" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="2508" class="Symbol">=</a> <a id="2510" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="2515" class="Symbol">...</a> <a id="2519" class="Symbol">|</a> <a id="2521" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2526" href="ValueSep.Ledger.html#2526" class="Bound">s</a>  <a id="2529" class="Symbol">=</a> <a id="2531" href="ValueSep.Ledger.html#2376" class="Function">comp</a> <a id="2536" class="Symbol">{</a><a id="2537" class="Bound">l</a><a id="2538" class="Symbol">}</a> <a id="2540" class="Symbol">{</a><a id="2541" class="Bound">l′</a><a id="2543" class="Symbol">}</a> <a id="2545" href="ValueSep.Ledger.html#2526" class="Bound">s</a>

<a id="2548" class="Comment">-- Executing transactions never introduces new keys in the resulting map out-of-thin-air.</a>
<a id="⟦⟧ₜ-mono"></a><a id="2638" href="ValueSep.Ledger.html#2638" class="Function">⟦⟧ₜ-mono</a> <a id="2647" class="Symbol">:</a> <a id="2649" href="ValueSep.Maps.html#1728" class="Function">KeyMonotonicᵐ</a> <a id="2663" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="2665" href="ValueSep.Ledger.html#1186" class="Generalizable">t</a> <a id="2667" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a>
<a id="2669" href="ValueSep.Ledger.html#2638" class="Function">⟦⟧ₜ-mono</a> <a id="2678" class="Symbol">{</a><a id="2679" class="Argument">t</a> <a id="2681" class="Symbol">=</a> <a id="2683" href="ValueSep.Ledger.html#2683" class="Bound">A</a> <a id="2685" href="ValueSep.Ledger.html#913" class="InductiveConstructor Operator">—→⟨</a> <a id="2689" href="ValueSep.Ledger.html#2689" class="Bound">v</a> <a id="2691" href="ValueSep.Ledger.html#913" class="InductiveConstructor Operator">⟩</a> <a id="2693" href="ValueSep.Ledger.html#2693" class="Bound">B</a><a id="2694" class="Symbol">}</a> <a id="2696" href="ValueSep.Ledger.html#2696" class="Bound">m</a>
  <a id="2700" class="Keyword">with</a> <a id="2705" href="ValueSep.Ledger.html#2696" class="Bound">m</a> <a id="2707" href="ValueSep.Ledger.html#2683" class="Bound">A</a> <a id="2709" class="Symbol">|</a> <a id="2711" href="ValueSep.Ledger.html#2696" class="Bound">m</a> <a id="2713" href="ValueSep.Ledger.html#2693" class="Bound">B</a>
<a id="2715" class="Symbol">...</a> <a id="2719" class="Symbol">|</a> <a id="2721" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2726" class="Symbol">_</a>  <a id="2729" class="Symbol">|</a> <a id="2731" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="2739" class="Symbol">=</a> <a id="2741" href="Data.Maybe.Relation.Unary.All.html#1054" class="InductiveConstructor">M.All.nothing</a>
<a id="2755" class="Symbol">...</a> <a id="2759" class="Symbol">|</a> <a id="2761" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="2769" class="Symbol">|</a> <a id="2771" class="Symbol">_</a>       <a id="2779" class="Symbol">=</a> <a id="2781" href="Data.Maybe.Relation.Unary.All.html#1054" class="InductiveConstructor">M.All.nothing</a>
<a id="2795" class="Symbol">...</a> <a id="2799" class="Symbol">|</a> <a id="2801" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2806" href="ValueSep.Ledger.html#2806" class="Bound">vᵃ</a> <a id="2809" class="Symbol">|</a> <a id="2811" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2816" href="ValueSep.Ledger.html#2816" class="Bound">vᵇ</a>
  <a id="2821" class="Keyword">with</a> <a id="2826" class="Bound">v</a> <a id="2828" href="Prelude.Ord.html#529" class="Function Operator">≤ᵇ</a> <a id="2831" href="ValueSep.Ledger.html#2806" class="Bound">vᵃ</a>
<a id="2834" class="Symbol">...</a> <a id="2838" class="Symbol">|</a> <a id="2840" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="2846" class="Symbol">=</a> <a id="2848" href="Data.Maybe.Relation.Unary.All.html#1054" class="InductiveConstructor">M.All.nothing</a>
<a id="2862" class="Symbol">...</a> <a id="2866" class="Symbol">|</a> <a id="2868" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a>  <a id="2874" class="Symbol">=</a> <a id="2876" href="Data.Maybe.Relation.Unary.All.html#1013" class="InductiveConstructor">M.All.just</a> <a id="2887" class="Symbol">λ</a> <a id="2889" href="ValueSep.Ledger.html#2889" class="Bound">k</a> <a id="2891" class="Symbol">→</a> <a id="2893" href="ValueSep.Maps.html#3278" class="Function">[↝]-mono</a> <a id="2902" class="Bound">B</a> <a id="2904" class="Symbol">(</a><a id="2905" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">_+</a> <a id="2908" class="Bound">v</a><a id="2909" class="Symbol">)</a> <a id="2911" class="Symbol">(</a><a id="2912" class="Bound">m</a> <a id="2914" href="ValueSep.Maps.html#2966" class="Function Operator">[</a> <a id="2916" class="Bound">A</a> <a id="2918" href="ValueSep.Maps.html#2966" class="Function Operator">↝</a> <a id="2920" class="Symbol">(</a><a id="2921" href="Data.Nat.Base.html#2874" class="Primitive Operator">_∸</a> <a id="2924" class="Bound">v</a><a id="2925" class="Symbol">)</a> <a id="2927" href="ValueSep.Maps.html#2966" class="Function Operator">]</a><a id="2928" class="Symbol">)</a> <a id="2930" href="ValueSep.Ledger.html#2889" class="Bound">k</a> <a id="2932" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="2934" href="ValueSep.Maps.html#3278" class="Function">[↝]-mono</a> <a id="2943" class="Bound">A</a> <a id="2945" class="Symbol">(</a><a id="2946" href="Data.Nat.Base.html#2874" class="Primitive Operator">_∸</a> <a id="2949" class="Bound">v</a><a id="2950" class="Symbol">)</a> <a id="2952" class="Bound">m</a> <a id="2954" href="ValueSep.Ledger.html#2889" class="Bound">k</a>

<a id="⟦⟧ₗ-mono"></a><a id="2957" href="ValueSep.Ledger.html#2957" class="Function">⟦⟧ₗ-mono</a> <a id="2966" class="Symbol">:</a> <a id="2968" href="ValueSep.Maps.html#1728" class="Function">KeyMonotonicᵐ</a> <a id="2982" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="2984" href="ValueSep.Ledger.html#1201" class="Generalizable">l</a> <a id="2986" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a>
<a id="2988" href="ValueSep.Ledger.html#2957" class="Function">⟦⟧ₗ-mono</a> <a id="2997" class="Symbol">{</a><a id="2998" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="3000" class="Symbol">}</a>    <a id="3005" class="Symbol">_</a> <a id="3007" class="Symbol">=</a> <a id="3009" href="Data.Maybe.Relation.Unary.All.html#1013" class="InductiveConstructor">M.All.just</a> <a id="3020" class="Symbol">λ</a> <a id="3022" href="ValueSep.Ledger.html#3022" class="Bound">_</a> <a id="3024" class="Symbol">→</a> <a id="3026" href="Function.Base.html#615" class="Function">id</a>
<a id="3029" href="ValueSep.Ledger.html#2957" class="Function">⟦⟧ₗ-mono</a> <a id="3038" class="Symbol">{</a><a id="3039" href="ValueSep.Ledger.html#3039" class="Bound">t</a> <a id="3041" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3043" href="ValueSep.Ledger.html#3043" class="Bound">l</a><a id="3044" class="Symbol">}</a> <a id="3046" href="ValueSep.Ledger.html#3046" class="Bound">s</a>
  <a id="3050" class="Keyword">with</a> <a id="3055" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="3057" href="ValueSep.Ledger.html#3039" class="Bound">t</a> <a id="3059" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="3061" href="ValueSep.Ledger.html#3046" class="Bound">s</a> <a id="3063" class="Symbol">|</a> <a id="3065" href="ValueSep.Ledger.html#2638" class="Function">⟦⟧ₜ-mono</a> <a id="3074" class="Symbol">{</a><a id="3075" class="Argument">t</a> <a id="3077" class="Symbol">=</a> <a id="3079" href="ValueSep.Ledger.html#3039" class="Bound">t</a><a id="3080" class="Symbol">}</a> <a id="3082" href="ValueSep.Ledger.html#3046" class="Bound">s</a>
<a id="3084" class="Symbol">...</a> <a id="3088" class="Symbol">|</a> <a id="3090" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="3098" class="Symbol">|</a> <a id="3100" class="Symbol">_</a> <a id="3102" class="Symbol">=</a> <a id="3104" href="Data.Maybe.Relation.Unary.All.html#1054" class="InductiveConstructor">M.All.nothing</a>
<a id="3118" class="Symbol">...</a> <a id="3122" class="Symbol">|</a> <a id="3124" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3129" href="ValueSep.Ledger.html#3129" class="Bound">s′</a> <a id="3132" class="Symbol">|</a> <a id="3134" href="Data.Maybe.Relation.Unary.All.html#1013" class="InductiveConstructor">M.All.just</a> <a id="3145" href="ValueSep.Ledger.html#3145" class="Bound">IHₜ</a>
  <a id="3151" class="Keyword">with</a> <a id="3156" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="3158" class="Bound">l</a> <a id="3160" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="3162" href="ValueSep.Ledger.html#3129" class="Bound">s′</a> <a id="3165" class="Symbol">|</a> <a id="3167" href="ValueSep.Ledger.html#2957" class="Function">⟦⟧ₗ-mono</a> <a id="3176" class="Symbol">{</a><a id="3177" class="Argument">l</a> <a id="3179" class="Symbol">=</a> <a id="3181" class="Bound">l</a><a id="3182" class="Symbol">}</a> <a id="3184" href="ValueSep.Ledger.html#3129" class="Bound">s′</a>
<a id="3187" class="Symbol">...</a> <a id="3191" class="Symbol">|</a> <a id="3193" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="3201" class="Symbol">|</a> <a id="3203" class="Symbol">_</a> <a id="3205" class="Symbol">=</a> <a id="3207" href="Data.Maybe.Relation.Unary.All.html#1054" class="InductiveConstructor">M.All.nothing</a>
<a id="3221" class="Symbol">...</a> <a id="3225" class="Symbol">|</a> <a id="3227" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3232" href="ValueSep.Ledger.html#3232" class="Bound">s′</a> <a id="3235" class="Symbol">|</a> <a id="3237" href="Data.Maybe.Relation.Unary.All.html#1013" class="InductiveConstructor">M.All.just</a> <a id="3248" href="ValueSep.Ledger.html#3248" class="Bound">IHₗ</a> <a id="3252" class="Symbol">=</a> <a id="3254" href="Data.Maybe.Relation.Unary.All.html#1013" class="InductiveConstructor">M.All.just</a> <a id="3265" class="Symbol">(</a><a id="3266" href="ValueSep.Ledger.html#3248" class="Bound">IHₗ</a> <a id="3270" class="Symbol">_</a> <a id="3272" href="Function.Base.html#1219" class="Function Operator">∘₂</a> <a id="3275" class="Bound">IHₜ</a><a id="3278" class="Symbol">)</a>

<a id="3281" class="Comment">-- -- Executing a transaction never removes existing keys.</a>
<a id="⟦⟧ₜ-pre"></a><a id="3340" href="ValueSep.Ledger.html#3340" class="Function">⟦⟧ₜ-pre</a> <a id="3348" class="Symbol">:</a> <a id="3350" href="ValueSep.Maps.html#1742" class="Function">KeyPreservingᵐ</a> <a id="3365" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="3367" href="ValueSep.Ledger.html#1186" class="Generalizable">t</a> <a id="3369" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a>
<a id="3371" href="ValueSep.Ledger.html#3340" class="Function">⟦⟧ₜ-pre</a> <a id="3379" class="Symbol">{</a><a id="3380" class="Argument">t</a> <a id="3382" class="Symbol">=</a> <a id="3384" href="ValueSep.Ledger.html#3384" class="Bound">A</a> <a id="3386" href="ValueSep.Ledger.html#913" class="InductiveConstructor Operator">—→⟨</a> <a id="3390" href="ValueSep.Ledger.html#3390" class="Bound">v</a> <a id="3392" href="ValueSep.Ledger.html#913" class="InductiveConstructor Operator">⟩</a> <a id="3394" href="ValueSep.Ledger.html#3394" class="Bound">B</a><a id="3395" class="Symbol">}</a> <a id="3397" href="ValueSep.Ledger.html#3397" class="Bound">m</a>
  <a id="3401" class="Keyword">with</a> <a id="3406" href="ValueSep.Ledger.html#3397" class="Bound">m</a> <a id="3408" href="ValueSep.Ledger.html#3384" class="Bound">A</a> <a id="3410" class="Keyword">in</a> <a id="3413" class="Argument">A≡</a> <a id="3416" class="Symbol">|</a> <a id="3418" href="ValueSep.Ledger.html#3397" class="Bound">m</a> <a id="3420" href="ValueSep.Ledger.html#3394" class="Bound">B</a> <a id="3422" class="Keyword">in</a> <a id="3425" class="Argument">B≡</a>
<a id="3428" class="Symbol">...</a> <a id="3432" class="Symbol">|</a> <a id="3434" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3439" class="Symbol">_</a>  <a id="3442" class="Symbol">|</a> <a id="3444" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="3452" class="Symbol">=</a> <a id="3454" href="Data.Maybe.Relation.Unary.All.html#1054" class="InductiveConstructor">M.All.nothing</a>
<a id="3468" class="Symbol">...</a> <a id="3472" class="Symbol">|</a> <a id="3474" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="3482" class="Symbol">|</a> <a id="3484" class="Symbol">_</a>       <a id="3492" class="Symbol">=</a> <a id="3494" href="Data.Maybe.Relation.Unary.All.html#1054" class="InductiveConstructor">M.All.nothing</a>
<a id="3508" class="Symbol">...</a> <a id="3512" class="Symbol">|</a> <a id="3514" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3519" href="ValueSep.Ledger.html#3519" class="Bound">vᵃ</a> <a id="3522" class="Symbol">|</a> <a id="3524" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3529" href="ValueSep.Ledger.html#3529" class="Bound">vᵇ</a>
  <a id="3534" class="Keyword">with</a> <a id="3539" class="Bound">v</a> <a id="3541" href="Prelude.Ord.html#529" class="Function Operator">≤ᵇ</a> <a id="3544" href="ValueSep.Ledger.html#3519" class="Bound">vᵃ</a>
<a id="3547" class="Symbol">...</a> <a id="3551" class="Symbol">|</a> <a id="3553" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="3559" class="Symbol">=</a> <a id="3561" href="Data.Maybe.Relation.Unary.All.html#1054" class="InductiveConstructor">M.All.nothing</a>
<a id="3575" class="Symbol">...</a> <a id="3579" class="Symbol">|</a> <a id="3581" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a>  <a id="3587" class="Symbol">=</a> <a id="3589" href="Data.Maybe.Relation.Unary.All.html#1013" class="InductiveConstructor">M.All.just</a> <a id="3600" class="Symbol">λ</a> <a id="3602" href="ValueSep.Ledger.html#3602" class="Bound">k</a> <a id="3604" href="ValueSep.Ledger.html#3604" class="Bound">k∈</a> <a id="3607" class="Symbol">→</a> <a id="3609" href="ValueSep.Maps.html#3497" class="Function">[↝]-pre</a> <a id="3617" class="Bound">A</a> <a id="3619" class="Symbol">(</a><a id="3620" href="Data.Nat.Base.html#2874" class="Primitive Operator">_∸</a> <a id="3623" class="Bound">v</a><a id="3624" class="Symbol">)</a> <a id="3626" class="Bound">m</a> <a id="3628" class="Symbol">_</a> <a id="3630" class="Symbol">(</a><a id="3631" href="ValueSep.Maps.html#3497" class="Function">[↝]-pre</a> <a id="3639" class="Bound">B</a> <a id="3641" class="Symbol">(</a><a id="3642" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">_+</a> <a id="3645" class="Bound">v</a><a id="3646" class="Symbol">)</a> <a id="3648" class="Symbol">(</a><a id="3649" class="Bound">m</a> <a id="3651" href="ValueSep.Maps.html#2966" class="Function Operator">[</a> <a id="3653" class="Bound">A</a> <a id="3655" href="ValueSep.Maps.html#2966" class="Function Operator">↝</a> <a id="3657" class="Symbol">(</a><a id="3658" href="Data.Nat.Base.html#2874" class="Primitive Operator">_∸</a> <a id="3661" class="Bound">v</a><a id="3662" class="Symbol">)</a> <a id="3664" href="ValueSep.Maps.html#2966" class="Function Operator">]</a><a id="3665" class="Symbol">)</a> <a id="3667" href="ValueSep.Ledger.html#3602" class="Bound">k</a> <a id="3669" href="ValueSep.Ledger.html#3604" class="Bound">k∈</a><a id="3671" class="Symbol">)</a>

<a id="⟦⟧ₗ-pre"></a><a id="3674" href="ValueSep.Ledger.html#3674" class="Function">⟦⟧ₗ-pre</a> <a id="3682" class="Symbol">:</a> <a id="3684" href="ValueSep.Maps.html#1742" class="Function">KeyPreservingᵐ</a> <a id="3699" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="3701" href="ValueSep.Ledger.html#1201" class="Generalizable">l</a> <a id="3703" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a>
<a id="3705" href="ValueSep.Ledger.html#3674" class="Function">⟦⟧ₗ-pre</a> <a id="3713" class="Symbol">{</a><a id="3714" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="3716" class="Symbol">}</a> <a id="3718" class="Symbol">_</a> <a id="3720" class="Symbol">=</a> <a id="3722" href="Data.Maybe.Relation.Unary.All.html#1013" class="InductiveConstructor">M.All.just</a> <a id="3733" class="Symbol">λ</a> <a id="3735" href="ValueSep.Ledger.html#3735" class="Bound">_</a> <a id="3737" class="Symbol">→</a> <a id="3739" href="Function.Base.html#615" class="Function">id</a>
<a id="3742" href="ValueSep.Ledger.html#3674" class="Function">⟦⟧ₗ-pre</a> <a id="3750" class="Symbol">{</a><a id="3751" href="ValueSep.Ledger.html#3751" class="Bound">t</a> <a id="3753" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3755" href="ValueSep.Ledger.html#3755" class="Bound">l</a><a id="3756" class="Symbol">}</a> <a id="3758" href="ValueSep.Ledger.html#3758" class="Bound">s</a>
  <a id="3762" class="Keyword">with</a> <a id="3767" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="3769" href="ValueSep.Ledger.html#3751" class="Bound">t</a> <a id="3771" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="3773" href="ValueSep.Ledger.html#3758" class="Bound">s</a> <a id="3775" class="Symbol">|</a> <a id="3777" href="ValueSep.Ledger.html#3340" class="Function">⟦⟧ₜ-pre</a> <a id="3785" class="Symbol">{</a><a id="3786" class="Argument">t</a> <a id="3788" class="Symbol">=</a> <a id="3790" href="ValueSep.Ledger.html#3751" class="Bound">t</a><a id="3791" class="Symbol">}</a> <a id="3793" href="ValueSep.Ledger.html#3758" class="Bound">s</a>
<a id="3795" class="Symbol">...</a> <a id="3799" class="Symbol">|</a> <a id="3801" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="3809" class="Symbol">|</a> <a id="3811" class="Symbol">_</a> <a id="3813" class="Symbol">=</a> <a id="3815" href="Data.Maybe.Relation.Unary.All.html#1054" class="InductiveConstructor">M.All.nothing</a>
<a id="3829" class="Symbol">...</a> <a id="3833" class="Symbol">|</a> <a id="3835" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3840" href="ValueSep.Ledger.html#3840" class="Bound">s′</a> <a id="3843" class="Symbol">|</a> <a id="3845" href="Data.Maybe.Relation.Unary.All.html#1013" class="InductiveConstructor">M.All.just</a> <a id="3856" href="ValueSep.Ledger.html#3856" class="Bound">IHₜ</a>
  <a id="3862" class="Keyword">with</a> <a id="3867" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="3869" class="Bound">l</a> <a id="3871" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="3873" href="ValueSep.Ledger.html#3840" class="Bound">s′</a> <a id="3876" class="Symbol">|</a> <a id="3878" href="ValueSep.Ledger.html#3674" class="Function">⟦⟧ₗ-pre</a> <a id="3886" class="Symbol">{</a><a id="3887" class="Argument">l</a> <a id="3889" class="Symbol">=</a> <a id="3891" class="Bound">l</a><a id="3892" class="Symbol">}</a> <a id="3894" href="ValueSep.Ledger.html#3840" class="Bound">s′</a>
<a id="3897" class="Symbol">...</a> <a id="3901" class="Symbol">|</a> <a id="3903" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="3911" class="Symbol">|</a> <a id="3913" class="Symbol">_</a> <a id="3915" class="Symbol">=</a> <a id="3917" href="Data.Maybe.Relation.Unary.All.html#1054" class="InductiveConstructor">M.All.nothing</a>
<a id="3931" class="Symbol">...</a> <a id="3935" class="Symbol">|</a> <a id="3937" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3942" href="ValueSep.Ledger.html#3942" class="Bound">s′</a> <a id="3945" class="Symbol">|</a> <a id="3947" href="Data.Maybe.Relation.Unary.All.html#1013" class="InductiveConstructor">M.All.just</a> <a id="3958" href="ValueSep.Ledger.html#3958" class="Bound">IHₗ</a> <a id="3962" class="Symbol">=</a> <a id="3964" href="Data.Maybe.Relation.Unary.All.html#1013" class="InductiveConstructor">M.All.just</a> <a id="3975" class="Symbol">(</a><a id="3976" class="Bound">IHₜ</a> <a id="3980" class="Symbol">_</a> <a id="3982" href="Function.Base.html#1219" class="Function Operator">∘₂</a> <a id="3985" href="ValueSep.Ledger.html#3958" class="Bound">IHₗ</a><a id="3988" class="Symbol">)</a>

<a id="3991" class="Comment">-- ** Utility lemmas about membership/transfer/maps.</a>
<a id="∉-⟦⟧ₜ"></a><a id="4044" href="ValueSep.Ledger.html#4044" class="Function">∉-⟦⟧ₜ</a> <a id="4050" class="Symbol">:</a> <a id="4052" href="ValueSep.Ledger.html#562" class="Generalizable">A</a> <a id="4054" href="ValueSep.Maps.html#665" class="Function Operator">∉ᵈ</a> <a id="4057" href="ValueSep.Ledger.html#1125" class="Generalizable">s</a> <a id="4059" class="Symbol">→</a> <a id="4061" href="Data.Maybe.Relation.Unary.All.html#943" class="Datatype">M.All.All</a> <a id="4071" class="Symbol">(</a><a id="4072" href="ValueSep.Ledger.html#562" class="Generalizable">A</a> <a id="4074" href="ValueSep.Maps.html#665" class="Function Operator">∉ᵈ_</a><a id="4077" class="Symbol">)</a> <a id="4079" class="Symbol">(</a><a id="4080" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="4082" href="ValueSep.Ledger.html#1186" class="Generalizable">t</a> <a id="4084" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="4086" href="ValueSep.Ledger.html#1125" class="Generalizable">s</a><a id="4087" class="Symbol">)</a>
<a id="4089" href="ValueSep.Ledger.html#4044" class="Function">∉-⟦⟧ₜ</a> <a id="4095" class="Symbol">{</a><a id="4096" href="ValueSep.Ledger.html#4096" class="Bound">A</a><a id="4097" class="Symbol">}{</a><a id="4099" href="ValueSep.Ledger.html#4099" class="Bound">s</a><a id="4100" class="Symbol">}{</a><a id="4102" href="ValueSep.Ledger.html#4102" class="Bound">t</a><a id="4103" class="Symbol">}</a> <a id="4105" href="ValueSep.Ledger.html#4105" class="Bound">A∉</a> <a id="4108" class="Keyword">with</a> <a id="4113" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="4115" href="ValueSep.Ledger.html#4102" class="Bound">t</a> <a id="4117" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="4119" href="ValueSep.Ledger.html#4099" class="Bound">s</a> <a id="4121" class="Symbol">|</a> <a id="4123" href="ValueSep.Ledger.html#3340" class="Function">⟦⟧ₜ-pre</a> <a id="4131" class="Symbol">{</a><a id="4132" class="Argument">t</a> <a id="4134" class="Symbol">=</a> <a id="4136" href="ValueSep.Ledger.html#4102" class="Bound">t</a><a id="4137" class="Symbol">}</a> <a id="4139" href="ValueSep.Ledger.html#4099" class="Bound">s</a>
<a id="4141" class="Symbol">...</a> <a id="4145" class="Symbol">|</a> <a id="4147" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="4155" class="Symbol">|</a> <a id="4157" class="Symbol">_</a> <a id="4159" class="Symbol">=</a> <a id="4161" href="Data.Maybe.Relation.Unary.All.html#1054" class="InductiveConstructor">M.All.nothing</a>
<a id="4175" class="Symbol">...</a> <a id="4179" class="Symbol">|</a> <a id="4181" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="4186" href="ValueSep.Ledger.html#4186" class="Bound">s′</a> <a id="4189" class="Symbol">|</a> <a id="4191" href="Data.Maybe.Relation.Unary.All.html#1013" class="InductiveConstructor">M.All.just</a> <a id="4202" href="ValueSep.Ledger.html#4202" class="Bound">IHₜ</a> <a id="4206" class="Symbol">=</a> <a id="4208" href="Data.Maybe.Relation.Unary.All.html#1013" class="InductiveConstructor">M.All.just</a> <a id="4219" class="Symbol">(</a><a id="4220" class="Bound">A∉</a> <a id="4223" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="4225" href="ValueSep.Ledger.html#4202" class="Bound">IHₜ</a> <a id="4229" class="Symbol">_)</a>

<a id="∉-⟦⟧ₗ"></a><a id="4233" href="ValueSep.Ledger.html#4233" class="Function">∉-⟦⟧ₗ</a> <a id="4239" class="Symbol">:</a> <a id="4241" href="ValueSep.Ledger.html#562" class="Generalizable">A</a> <a id="4243" href="ValueSep.Maps.html#665" class="Function Operator">∉ᵈ</a> <a id="4246" href="ValueSep.Ledger.html#1125" class="Generalizable">s</a> <a id="4248" class="Symbol">→</a> <a id="4250" href="Data.Maybe.Relation.Unary.All.html#943" class="Datatype">M.All.All</a> <a id="4260" class="Symbol">(</a><a id="4261" href="ValueSep.Ledger.html#562" class="Generalizable">A</a> <a id="4263" href="ValueSep.Maps.html#665" class="Function Operator">∉ᵈ_</a><a id="4266" class="Symbol">)</a> <a id="4268" class="Symbol">(</a><a id="4269" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="4271" href="ValueSep.Ledger.html#1201" class="Generalizable">l</a> <a id="4273" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="4275" href="ValueSep.Ledger.html#1125" class="Generalizable">s</a><a id="4276" class="Symbol">)</a>
<a id="4278" href="ValueSep.Ledger.html#4233" class="Function">∉-⟦⟧ₗ</a> <a id="4284" class="Symbol">{</a><a id="4285" href="ValueSep.Ledger.html#4285" class="Bound">A</a><a id="4286" class="Symbol">}{</a><a id="4288" href="ValueSep.Ledger.html#4288" class="Bound">s</a><a id="4289" class="Symbol">}{</a><a id="4291" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="4293" class="Symbol">}</a> <a id="4295" href="ValueSep.Ledger.html#4295" class="Bound">A∉</a> <a id="4298" class="Symbol">=</a> <a id="4300" href="Data.Maybe.Relation.Unary.All.html#1013" class="InductiveConstructor">M.All.just</a> <a id="4311" href="ValueSep.Ledger.html#4295" class="Bound">A∉</a>
<a id="4314" href="ValueSep.Ledger.html#4233" class="Function">∉-⟦⟧ₗ</a> <a id="4320" class="Symbol">{</a><a id="4321" href="ValueSep.Ledger.html#4321" class="Bound">A</a><a id="4322" class="Symbol">}{</a><a id="4324" href="ValueSep.Ledger.html#4324" class="Bound">s</a><a id="4325" class="Symbol">}{</a><a id="4327" href="ValueSep.Ledger.html#4327" class="Bound">t</a> <a id="4329" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="4331" href="ValueSep.Ledger.html#4331" class="Bound">l</a><a id="4332" class="Symbol">}</a> <a id="4334" href="ValueSep.Ledger.html#4334" class="Bound">A∉</a> <a id="4337" class="Keyword">with</a> <a id="4342" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="4344" href="ValueSep.Ledger.html#4327" class="Bound">t</a> <a id="4346" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="4348" href="ValueSep.Ledger.html#4324" class="Bound">s</a> <a id="4350" class="Symbol">|</a> <a id="4352" href="ValueSep.Ledger.html#4044" class="Function">∉-⟦⟧ₜ</a> <a id="4358" class="Symbol">{</a><a id="4359" href="ValueSep.Ledger.html#4321" class="Bound">A</a><a id="4360" class="Symbol">}{</a><a id="4362" href="ValueSep.Ledger.html#4324" class="Bound">s</a><a id="4363" class="Symbol">}{</a><a id="4365" href="ValueSep.Ledger.html#4327" class="Bound">t</a><a id="4366" class="Symbol">}</a> <a id="4368" href="ValueSep.Ledger.html#4334" class="Bound">A∉</a>
<a id="4371" class="Symbol">...</a> <a id="4375" class="Symbol">|</a> <a id="4377" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="4385" class="Symbol">|</a> <a id="4387" class="Symbol">_</a> <a id="4389" class="Symbol">=</a> <a id="4391" href="Data.Maybe.Relation.Unary.All.html#1054" class="InductiveConstructor">M.All.nothing</a>
<a id="4405" class="Symbol">...</a> <a id="4409" class="Symbol">|</a> <a id="4411" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="4416" href="ValueSep.Ledger.html#4416" class="Bound">s′</a> <a id="4419" class="Symbol">|</a> <a id="4421" href="Data.Maybe.Relation.Unary.All.html#1013" class="InductiveConstructor">M.All.just</a> <a id="4432" href="ValueSep.Ledger.html#4432" class="Bound">IHₜ</a> <a id="4436" class="Symbol">=</a> <a id="4438" href="ValueSep.Ledger.html#4233" class="Function">∉-⟦⟧ₗ</a> <a id="4444" class="Symbol">{</a><a id="4445" class="Bound">A</a><a id="4446" class="Symbol">}</a> <a id="4448" class="Symbol">{</a><a id="4449" href="ValueSep.Ledger.html#4416" class="Bound">s′</a><a id="4451" class="Symbol">}</a> <a id="4453" class="Symbol">{</a><a id="4454" class="Bound">l</a><a id="4455" class="Symbol">}</a> <a id="4457" href="ValueSep.Ledger.html#4432" class="Bound">IHₜ</a>

<a id="4462" class="Comment">-- ** Operational semantics</a>
<a id="4490" class="Comment">-- We model configurations of the transition system as pairs of a ledger and its current state.</a>

<a id="4587" class="Keyword">infix</a> <a id="4593" class="Number">0</a> <a id="4595" href="ValueSep.Ledger.html#4630" class="Datatype Operator">_—→_</a> <a id="4600" href="ValueSep.Ledger.html#5630" class="Function Operator">_—→∅</a> <a id="4605" href="ValueSep.Ledger.html#5370" class="Datatype Operator">_—→⋆_</a> <a id="4611" href="ValueSep.Ledger.html#5635" class="Function Operator">_—→⋆∅</a> <a id="4617" href="ValueSep.Ledger.html#5706" class="Function Operator">_—→⋆_✓</a>

<a id="4625" class="Keyword">data</a> <a id="_—→_"></a><a id="4630" href="ValueSep.Ledger.html#4630" class="Datatype Operator">_—→_</a> <a id="4635" class="Symbol">:</a> <a id="4637" href="ValueSep.Ledger.html#1101" class="Function">L</a> <a id="4639" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="4641" href="ValueSep.Ledger.html#676" class="Function">S</a> <a id="4643" class="Symbol">→</a> <a id="4645" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="4651" class="Symbol">(</a><a id="4652" href="ValueSep.Ledger.html#1101" class="Function">L</a> <a id="4654" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="4656" href="ValueSep.Ledger.html#676" class="Function">S</a><a id="4657" class="Symbol">)</a> <a id="4659" class="Symbol">→</a> <a id="4661" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="4665" class="Keyword">where</a>

  <a id="_—→_.singleStep"></a><a id="4674" href="ValueSep.Ledger.html#4674" class="InductiveConstructor">singleStep</a> <a id="4685" class="Symbol">:</a>

     <a id="4693" href="Prelude.InferenceRules.html#46050" class="Function Operator">─────────────────────────</a>
     <a id="4724" href="ValueSep.Ledger.html#1186" class="Generalizable">t</a> <a id="4726" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="4728" href="ValueSep.Ledger.html#1201" class="Generalizable">l</a> <a id="4730" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4732" href="ValueSep.Ledger.html#1125" class="Generalizable">s</a> <a id="4734" href="ValueSep.Ledger.html#4630" class="Datatype Operator">—→</a> <a id="4737" href="ValueSep.Ledger.html#1201" class="Generalizable">l</a> <a id="4739" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,_</a> <a id="4742" href="Prelude.Functor.html#301" class="Field Operator">&lt;$&gt;</a> <a id="4746" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="4748" href="ValueSep.Ledger.html#1186" class="Generalizable">t</a> <a id="4750" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="4752" href="ValueSep.Ledger.html#1125" class="Generalizable">s</a>

<a id="4755" class="Comment">-- data _—→⋆_ : Rel₀ (L × S) where</a>

<a id="4791" class="Comment">--    base :</a>

<a id="4805" class="Comment">--      ──────────────</a>
<a id="4828" class="Comment">--      ls —→⋆ ls</a>

<a id="4847" class="Comment">--    step :</a>

<a id="4861" class="Comment">--      ∙ ls  —→ just ls′</a>
<a id="4887" class="Comment">--      ∙ ls′ —→⋆ ls″</a>
<a id="4909" class="Comment">--        ───────────</a>
<a id="4931" class="Comment">--        ls —→⋆ ls″</a>

<a id="4953" class="Comment">-- comp′ :</a>
<a id="4964" class="Comment">--   ∙ l       , s  —→⋆′ s′</a>
<a id="4992" class="Comment">--   ∙ l′      , s′ —→⋆′ s″</a>
<a id="5020" class="Comment">--     ────────────────────</a>
<a id="5048" class="Comment">--     l ++ l′ , s  —→⋆′ s″</a>
<a id="5076" class="Comment">-- comp′ {l = []}    base                   s′→s″ = s′→s″</a>
<a id="5134" class="Comment">-- comp′ {l = t ∷ l}{s} (step x s→) s′→</a>
<a id="5174" class="Comment">--   with ⟦ t ⟧ s | singleStep {t}{l}{s}</a>
<a id="5215" class="Comment">-- ... | nothing | H = step {!singleStep!} s′→</a>
<a id="5262" class="Comment">-- ... | just s′ | H</a>
<a id="5283" class="Comment">--   = {!!}</a>
<a id="5295" class="Comment">-- (step singleStep s→s′) s′→s″ = step singleStep (comp′ s→s′ s′→s″)</a>

<a id="5365" class="Keyword">data</a> <a id="_—→⋆_"></a><a id="5370" href="ValueSep.Ledger.html#5370" class="Datatype Operator">_—→⋆_</a> <a id="5376" class="Symbol">:</a> <a id="5378" href="ValueSep.Ledger.html#1101" class="Function">L</a> <a id="5380" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="5382" href="ValueSep.Ledger.html#676" class="Function">S</a> <a id="5384" class="Symbol">→</a> <a id="5386" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="5392" class="Symbol">(</a><a id="5393" href="ValueSep.Ledger.html#1101" class="Function">L</a> <a id="5395" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="5397" href="ValueSep.Ledger.html#676" class="Function">S</a><a id="5398" class="Symbol">)</a> <a id="5400" class="Symbol">→</a> <a id="5402" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="5406" class="Keyword">where</a>

  <a id="_—→⋆_.base"></a><a id="5415" href="ValueSep.Ledger.html#5415" class="InductiveConstructor">base</a> <a id="5420" class="Symbol">:</a>
    <a id="5426" href="Prelude.InferenceRules.html#47337" class="Function Operator">──────────────</a>
    <a id="5445" href="ValueSep.Ledger.html#1221" class="Generalizable">ls</a> <a id="5448" href="ValueSep.Ledger.html#5370" class="Datatype Operator">—→⋆</a> <a id="5452" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5457" href="ValueSep.Ledger.html#1221" class="Generalizable">ls</a>

  <a id="_—→⋆_.step-✓"></a><a id="5463" href="ValueSep.Ledger.html#5463" class="InductiveConstructor">step-✓</a> <a id="5470" class="Symbol">:</a>
    <a id="5476" href="Prelude.InferenceRules.html#56066" class="Function Operator">∙</a> <a id="5478" href="ValueSep.Ledger.html#1221" class="Generalizable">ls</a>  <a id="5482" href="ValueSep.Ledger.html#4630" class="Datatype Operator">—→</a>  <a id="5486" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5491" href="ValueSep.Ledger.html#1224" class="Generalizable">ls′</a>
    <a id="5499" href="Prelude.InferenceRules.html#56000" class="Function Operator">∙</a> <a id="5501" href="ValueSep.Ledger.html#1224" class="Generalizable">ls′</a> <a id="5505" href="ValueSep.Ledger.html#5370" class="Datatype Operator">—→⋆</a> <a id="5509" href="ValueSep.Ledger.html#1275" class="Generalizable">mls″</a>
      <a id="5520" href="Prelude.InferenceRules.html#14260" class="Function Operator">───────────</a>
      <a id="5538" href="ValueSep.Ledger.html#1221" class="Generalizable">ls</a>  <a id="5542" href="ValueSep.Ledger.html#5370" class="Datatype Operator">—→⋆</a> <a id="5546" href="ValueSep.Ledger.html#1275" class="Generalizable">mls″</a>

  <a id="_—→⋆_.step-∅"></a><a id="5554" href="ValueSep.Ledger.html#5554" class="InductiveConstructor">step-∅</a> <a id="5561" class="Symbol">:</a>
    <a id="5567" href="Prelude.InferenceRules.html#56066" class="Function Operator">∙</a> <a id="5569" href="ValueSep.Ledger.html#1221" class="Generalizable">ls</a>  <a id="5573" href="ValueSep.Ledger.html#4630" class="Datatype Operator">—→</a>  <a id="5577" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
      <a id="5591" href="Prelude.InferenceRules.html#14186" class="Function Operator">───────────────</a>
      <a id="5613" href="ValueSep.Ledger.html#1221" class="Generalizable">ls</a>  <a id="5617" href="ValueSep.Ledger.html#5370" class="Datatype Operator">—→⋆</a> <a id="5621" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>

<a id="_—→∅"></a><a id="5630" href="ValueSep.Ledger.html#5630" class="Function Operator">_—→∅</a> <a id="_—→⋆∅"></a><a id="5635" href="ValueSep.Ledger.html#5635" class="Function Operator">_—→⋆∅</a> <a id="5641" class="Symbol">:</a> <a id="5643" href="ValueSep.Ledger.html#1101" class="Function">L</a> <a id="5645" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="5647" href="ValueSep.Ledger.html#676" class="Function">S</a> <a id="5649" class="Symbol">→</a> <a id="5651" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="5655" href="ValueSep.Ledger.html#5655" class="Bound">ls</a> <a id="5658" href="ValueSep.Ledger.html#5630" class="Function Operator">—→∅</a>  <a id="5663" class="Symbol">=</a> <a id="5665" href="ValueSep.Ledger.html#5655" class="Bound">ls</a> <a id="5668" href="ValueSep.Ledger.html#4630" class="Datatype Operator">—→</a>  <a id="5672" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
<a id="5680" href="ValueSep.Ledger.html#5680" class="Bound">ls</a> <a id="5683" href="ValueSep.Ledger.html#5635" class="Function Operator">—→⋆∅</a> <a id="5688" class="Symbol">=</a> <a id="5690" href="ValueSep.Ledger.html#5680" class="Bound">ls</a> <a id="5693" href="ValueSep.Ledger.html#5370" class="Datatype Operator">—→⋆</a> <a id="5697" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>

<a id="_—→⋆_✓"></a><a id="5706" href="ValueSep.Ledger.html#5706" class="Function Operator">_—→⋆_✓</a> <a id="5713" class="Symbol">:</a> <a id="5715" href="ValueSep.Ledger.html#1101" class="Function">L</a> <a id="5717" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="5719" href="ValueSep.Ledger.html#676" class="Function">S</a> <a id="5721" class="Symbol">→</a> <a id="5723" href="ValueSep.Ledger.html#676" class="Function">S</a> <a id="5725" class="Symbol">→</a> <a id="5727" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="5731" href="ValueSep.Ledger.html#5731" class="Bound">ls</a> <a id="5734" href="ValueSep.Ledger.html#5706" class="Function Operator">—→⋆</a> <a id="5738" href="ValueSep.Ledger.html#5738" class="Bound">s</a> <a id="5740" href="ValueSep.Ledger.html#5706" class="Function Operator">✓</a> <a id="5742" class="Symbol">=</a> <a id="5744" href="ValueSep.Ledger.html#5731" class="Bound">ls</a> <a id="5747" href="ValueSep.Ledger.html#5370" class="Datatype Operator">—→⋆</a> <a id="5751" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5756" class="Symbol">(</a><a id="5757" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="5760" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5762" href="ValueSep.Ledger.html#5738" class="Bound">s</a><a id="5763" class="Symbol">)</a>

<a id="5766" class="Comment">-- comp′ :</a>
<a id="5777" class="Comment">--   ∙ l       , s  —→⋆ s′ ✓</a>
<a id="5806" class="Comment">--   ∙ l′      , s′ —→⋆ s″ ✓</a>
<a id="5835" class="Comment">--     ─────────────────────</a>
<a id="5864" class="Comment">--     l ++ l′ , s  —→⋆ s″ ✓</a>
<a id="5893" class="Comment">-- comp′ {.[]}      base         p = p</a>
<a id="5932" class="Comment">-- comp′ {t ∷ l}{s} (step-✓ p q) r</a>
<a id="5967" class="Comment">--   with ⟦ t ⟧ s | p</a>
<a id="5989" class="Comment">-- ... | nothing | absurd = {!!}</a>
<a id="6022" class="Comment">-- ... | just s′ | _ = {!!}</a>
<a id="6050" class="Comment">-- step-✓ {!comp′ s→s′ s′→s″!} {!s′→✓!}</a>

<a id="6091" class="Comment">-- comp′ {l = []}    base                   s′→s″ = s′→s″</a>
<a id="6149" class="Comment">-- comp′ {l = _ ∷ _} (step (singleStep s≡) s→s′) s′→s″ = step (singleStep s≡) (comp′ s→s′ s′→s″)</a>

<a id="6247" class="Comment">-- data _—→_ : Rel₀ (L × S) where</a>

<a id="6282" class="Comment">--   singleStep :</a>

<a id="6301" class="Comment">--      ⟦ t ⟧ s ≡ just s′</a>
<a id="6327" class="Comment">--      ─────────────────────────</a>
<a id="6361" class="Comment">--      t ∷ l , s —→ l , s′</a>

<a id="6390" class="Comment">-- data _—→⋆_ : Rel₀ (L × S) where</a>

<a id="6426" class="Comment">--    base :</a>

<a id="6440" class="Comment">--      ─────────</a>
<a id="6458" class="Comment">--      ls —→⋆ ls</a>

<a id="6477" class="Comment">--    step :</a>

<a id="6491" class="Comment">--      ∙ ls —→ ls′</a>
<a id="6511" class="Comment">--      ∙ ls′ —→⋆ ls″</a>
<a id="6533" class="Comment">--        ───────────</a>
<a id="6555" class="Comment">--        ls —→⋆ ls″</a>

<a id="6577" class="Comment">-- _—→⋆_✓ : L × S → S → Set</a>
<a id="6605" class="Comment">-- ls —→⋆ s ✓ = ls —→⋆ ([] , s)</a>

<a id="6638" class="Comment">-- comp′ :</a>
<a id="6649" class="Comment">--   ∙ l       , s  —→⋆′ s′</a>
<a id="6677" class="Comment">--   ∙ l′      , s′ —→⋆′ s″</a>
<a id="6705" class="Comment">--     ────────────────────</a>
<a id="6733" class="Comment">--     l ++ l′ , s  —→⋆′ s″</a>
<a id="6761" class="Comment">-- comp′ {l = []}    base                   s′→s″ = s′→s″</a>
<a id="6819" class="Comment">-- comp′ {l = _ ∷ _} (step (singleStep s≡) s→s′) s′→s″ = step (singleStep s≡) (comp′ s→s′ s′→s″)</a>

<a id="oper-base⋆"></a><a id="6917" href="ValueSep.Ledger.html#6917" class="Function">oper-base⋆</a> <a id="6928" class="Symbol">:</a>
  <a id="6932" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="6934" href="ValueSep.Ledger.html#1201" class="Generalizable">l</a> <a id="6936" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="6938" href="ValueSep.Ledger.html#1125" class="Generalizable">s</a> <a id="6940" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="6942" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="6947" href="ValueSep.Ledger.html#1127" class="Generalizable">s′</a>
  <a id="6952" href="Prelude.InferenceRules.html#14071" class="Function Operator">────────────────────</a>
  <a id="6975" href="ValueSep.Ledger.html#1201" class="Generalizable">l</a> <a id="6977" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="6979" href="ValueSep.Ledger.html#1125" class="Generalizable">s</a> <a id="6981" href="ValueSep.Ledger.html#5706" class="Function Operator">—→⋆</a> <a id="6985" href="ValueSep.Ledger.html#1127" class="Generalizable">s′</a> <a id="6988" href="ValueSep.Ledger.html#5706" class="Function Operator">✓</a>
<a id="6990" href="ValueSep.Ledger.html#6917" class="Function">oper-base⋆</a> <a id="7001" class="Symbol">{</a><a id="7002" class="Argument">l</a> <a id="7004" class="Symbol">=</a> <a id="7006" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="7008" class="Symbol">}</a> <a id="7010" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="7015" class="Symbol">=</a> <a id="7017" href="ValueSep.Ledger.html#5415" class="InductiveConstructor">base</a>
<a id="7022" href="ValueSep.Ledger.html#6917" class="Function">oper-base⋆</a> <a id="7033" class="Symbol">{</a><a id="7034" class="Argument">l</a> <a id="7036" class="Symbol">=</a> <a id="7038" href="ValueSep.Ledger.html#7038" class="Bound">t</a> <a id="7040" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="7042" href="ValueSep.Ledger.html#7042" class="Bound">l</a><a id="7043" class="Symbol">}{</a><a id="7045" href="ValueSep.Ledger.html#7045" class="Bound">s</a><a id="7046" class="Symbol">}</a> <a id="7048" href="ValueSep.Ledger.html#7048" class="Bound">l≡</a> <a id="7051" class="Keyword">with</a> <a id="7056" href="ValueSep.Ledger.html#1573" class="Field Operator">⟦</a> <a id="7058" href="ValueSep.Ledger.html#7038" class="Bound">t</a> <a id="7060" href="ValueSep.Ledger.html#1573" class="Field Operator">⟧</a> <a id="7062" href="ValueSep.Ledger.html#7045" class="Bound">s</a> <a id="7064" class="Symbol">|</a> <a id="7066" href="ValueSep.Ledger.html#4674" class="InductiveConstructor">singleStep</a> <a id="7077" class="Symbol">{</a><a id="7078" href="ValueSep.Ledger.html#7038" class="Bound">t</a><a id="7079" class="Symbol">}{</a><a id="7081" href="ValueSep.Ledger.html#7042" class="Bound">l</a><a id="7082" class="Symbol">}{</a><a id="7084" href="ValueSep.Ledger.html#7045" class="Bound">s</a><a id="7085" class="Symbol">}</a>
<a id="7087" class="Symbol">...</a> <a id="7091" class="Symbol">|</a> <a id="7093" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="7098" href="ValueSep.Ledger.html#7098" class="Bound">s′</a> <a id="7101" class="Symbol">|</a> <a id="7103" href="ValueSep.Ledger.html#7103" class="Bound">H</a> <a id="7105" class="Symbol">=</a> <a id="7107" href="ValueSep.Ledger.html#5463" class="InductiveConstructor">step-✓</a> <a id="7114" href="ValueSep.Ledger.html#7103" class="Bound">H</a> <a id="7116" class="Symbol">(</a><a id="7117" href="ValueSep.Ledger.html#6917" class="Function">oper-base⋆</a> <a id="7128" class="Bound">l≡</a><a id="7130" class="Symbol">)</a>

<a id="7133" class="Comment">-- ** Relating denotational and operational semantics.</a>
<a id="7188" class="Comment">-- denot⇒oper : (⟦ l ⟧ s ≡ ms′) → (l , s —→⋆ ms′ ✓)</a>
<a id="7240" class="Comment">-- denot⇒oper = oper-base⋆</a>

<a id="7268" class="Comment">-- oper⇒denot : (l , s —→⋆′ s′) → (⟦ l ⟧ s ≡ just s′)</a>
<a id="7322" class="Comment">-- oper⇒denot {l = .[]} base  = refl</a>
<a id="7359" class="Comment">-- oper⇒denot {l = _ ∷ _} (step (singleStep s≡) p) rewrite s≡ | oper⇒denot p = refl</a>

<a id="7444" class="Comment">-- denot⇔oper : (⟦ l ⟧ s ≡ just s′) ⇔ (l , s —→⋆′ s′)</a>
<a id="7498" class="Comment">-- denot⇔oper = denot⇒oper , oper⇒denot</a>
</pre></body></html>