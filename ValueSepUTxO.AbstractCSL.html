<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ValueSepUTxO.AbstractCSL</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--allow-unsolved-metas</a> <a id="36" class="Symbol">#-}</a>
<a id="40" class="Comment">---------------------------------------</a>
<a id="80" class="Comment">-- ** Concurrent separation logic (CSL)</a>

<a id="121" class="Keyword">module</a> <a id="128" href="ValueSepUTxO.AbstractCSL.html" class="Module">ValueSepUTxO.AbstractCSL</a> <a id="153" class="Keyword">where</a>

<a id="160" class="Keyword">open</a> <a id="165" class="Keyword">import</a> <a id="172" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="185" class="Keyword">open</a> <a id="190" class="Keyword">import</a> <a id="197" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="211" class="Keyword">open</a> <a id="216" class="Keyword">import</a> <a id="223" href="Prelude.Decidable.html" class="Module">Prelude.Decidable</a>
<a id="241" class="Keyword">open</a> <a id="246" class="Keyword">import</a> <a id="253" href="Prelude.Lists.html" class="Module">Prelude.Lists</a>
<a id="267" class="Keyword">open</a> <a id="272" class="Keyword">import</a> <a id="279" href="Prelude.InferenceRules.html" class="Module">Prelude.InferenceRules</a>

<a id="303" class="Keyword">open</a> <a id="308" class="Keyword">import</a> <a id="315" href="Prelude.Bags.html" class="Module">Prelude.Bags</a>
<a id="328" class="Keyword">open</a> <a id="333" class="Keyword">import</a> <a id="340" href="ValueSepUTxO.AbstractUTxO.html" class="Module">ValueSepUTxO.AbstractUTxO</a>
<a id="366" class="Keyword">open</a> <a id="371" class="Keyword">import</a> <a id="378" href="ValueSepUTxO.AbstractLedger.html" class="Module">ValueSepUTxO.AbstractLedger</a>
<a id="406" class="Keyword">open</a> <a id="411" class="Keyword">import</a> <a id="418" href="ValueSepUTxO.AbstractHoareLogic.html" class="Module">ValueSepUTxO.AbstractHoareLogic</a>
<a id="450" class="Keyword">open</a> <a id="455" class="Keyword">import</a> <a id="462" href="ValueSepUTxO.AbstractSL.html" class="Module">ValueSepUTxO.AbstractSL</a>

<a id="◇-interleave"></a><a id="487" href="ValueSepUTxO.AbstractCSL.html#487" class="Function">◇-interleave</a> <a id="500" class="Symbol">:</a>
  <a id="504" href="Prelude.InferenceRules.html#56094" class="Function Operator">∙</a> <a id="506" class="Symbol">(</a><a id="507" href="ValueSepUTxO.AbstractLedger.html#630" class="Generalizable">l₁</a> <a id="510" href="Prelude.Lists.html#2154" class="Function Operator">∥</a> <a id="512" href="ValueSepUTxO.AbstractLedger.html#633" class="Generalizable">l₂</a> <a id="515" href="Prelude.Lists.html#2154" class="Function Operator">≡</a> <a id="517" href="ValueSepUTxO.AbstractLedger.html#622" class="Generalizable">l</a><a id="518" class="Symbol">)</a>
  <a id="522" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="524" href="Prelude.Bags.AsLists.html#5784" class="Function Operator">⟨</a> <a id="526" href="ValueSepUTxO.AbstractLedger.html#554" class="Generalizable">s₁</a> <a id="529" href="Prelude.Bags.AsLists.html#5784" class="Function Operator">◇</a> <a id="531" href="ValueSepUTxO.AbstractLedger.html#565" class="Generalizable">s₂</a> <a id="534" href="Prelude.Bags.AsLists.html#5784" class="Function Operator">⟩≡</a> <a id="537" href="ValueSepUTxO.AbstractLedger.html#546" class="Generalizable">s</a>
  <a id="541" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="543" href="ValueSepUTxO.AbstractLedger.html#994" class="Field Operator">⟦</a> <a id="545" href="ValueSepUTxO.AbstractLedger.html#630" class="Generalizable">l₁</a> <a id="548" href="ValueSepUTxO.AbstractLedger.html#994" class="Field Operator">⟧</a> <a id="550" href="ValueSepUTxO.AbstractLedger.html#554" class="Generalizable">s₁</a> <a id="553" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="555" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="560" href="ValueSepUTxO.AbstractLedger.html#557" class="Generalizable">s₁′</a>
  <a id="566" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="568" href="ValueSepUTxO.AbstractLedger.html#994" class="Field Operator">⟦</a> <a id="570" href="ValueSepUTxO.AbstractLedger.html#633" class="Generalizable">l₂</a> <a id="573" href="ValueSepUTxO.AbstractLedger.html#994" class="Field Operator">⟧</a> <a id="575" href="ValueSepUTxO.AbstractLedger.html#565" class="Generalizable">s₂</a> <a id="578" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="580" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="585" href="ValueSepUTxO.AbstractLedger.html#568" class="Generalizable">s₂′</a>
    <a id="593" href="Prelude.InferenceRules.html#13896" class="Function Operator">───────────────────────────</a>
    <a id="625" href="Data.Product.html#1369" class="Function">∃</a> <a id="627" class="Symbol">λ</a> <a id="629" href="ValueSepUTxO.AbstractCSL.html#629" class="Bound">s′</a> <a id="632" class="Symbol">→</a> <a id="634" class="Symbol">(</a><a id="635" href="ValueSepUTxO.AbstractLedger.html#994" class="Field Operator">⟦</a> <a id="637" href="ValueSepUTxO.AbstractLedger.html#622" class="Generalizable">l</a> <a id="639" href="ValueSepUTxO.AbstractLedger.html#994" class="Field Operator">⟧</a> <a id="641" href="ValueSepUTxO.AbstractLedger.html#546" class="Generalizable">s</a> <a id="643" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="645" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="650" href="ValueSepUTxO.AbstractCSL.html#629" class="Bound">s′</a><a id="652" class="Symbol">)</a>
           <a id="665" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="667" class="Symbol">(</a><a id="668" href="Prelude.Bags.AsLists.html#5784" class="Function Operator">⟨</a> <a id="670" href="ValueSepUTxO.AbstractLedger.html#557" class="Generalizable">s₁′</a> <a id="674" href="Prelude.Bags.AsLists.html#5784" class="Function Operator">◇</a> <a id="676" href="ValueSepUTxO.AbstractLedger.html#568" class="Generalizable">s₂′</a> <a id="680" href="Prelude.Bags.AsLists.html#5784" class="Function Operator">⟩≡</a> <a id="683" href="ValueSepUTxO.AbstractCSL.html#629" class="Bound">s′</a><a id="685" class="Symbol">)</a>
<a id="687" href="ValueSepUTxO.AbstractCSL.html#487" class="Function">◇-interleave</a> <a id="700" class="Symbol">{</a><a id="701" class="DottedPattern Symbol">.</a><a id="702" href="Agda.Builtin.List.html#185" class="DottedPattern InductiveConstructor">[]</a><a id="704" class="Symbol">}</a>    <a id="709" class="Symbol">{</a><a id="710" class="DottedPattern Symbol">.</a><a id="711" href="Agda.Builtin.List.html#185" class="DottedPattern InductiveConstructor">[]</a><a id="713" class="Symbol">}</a>    <a id="718" class="Symbol">{</a><a id="719" class="DottedPattern Symbol">.</a><a id="720" href="Agda.Builtin.List.html#185" class="DottedPattern InductiveConstructor">[]</a><a id="722" class="Symbol">}</a>    <a id="727" class="Symbol">{</a><a id="728" href="ValueSepUTxO.AbstractCSL.html#728" class="Bound">s₁</a><a id="730" class="Symbol">}</a> <a id="732" class="Symbol">{</a><a id="733" href="ValueSepUTxO.AbstractCSL.html#733" class="Bound">s₂</a><a id="735" class="Symbol">}</a> <a id="737" class="Symbol">{</a><a id="738" href="ValueSepUTxO.AbstractCSL.html#738" class="Bound">s</a><a id="739" class="Symbol">}</a> <a id="741" class="Symbol">{</a><a id="742" class="DottedPattern Symbol">.</a><a id="743" href="ValueSepUTxO.AbstractCSL.html#728" class="DottedPattern Bound">s₁</a><a id="745" class="Symbol">}</a> <a id="747" class="Symbol">{</a><a id="748" class="DottedPattern Symbol">.</a><a id="749" href="ValueSepUTxO.AbstractCSL.html#733" class="DottedPattern Bound">s₂</a><a id="751" class="Symbol">}</a> <a id="753" href="Data.List.Relation.Ternary.Interleaving.html#1059" class="InductiveConstructor">[]</a>         <a id="764" href="ValueSepUTxO.AbstractCSL.html#764" class="Bound">≡s</a> <a id="767" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="772" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
  <a id="779" class="Symbol">=</a> <a id="781" href="ValueSepUTxO.AbstractCSL.html#738" class="Bound">s</a> <a id="783" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="785" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="790" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="792" href="ValueSepUTxO.AbstractCSL.html#764" class="Bound">≡s</a>
<a id="795" href="ValueSepUTxO.AbstractCSL.html#487" class="Function">◇-interleave</a> <a id="808" class="Symbol">{</a><a id="809" href="ValueSepUTxO.AbstractCSL.html#809" class="Bound">t</a> <a id="811" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="813" href="ValueSepUTxO.AbstractCSL.html#813" class="Bound">l₁</a><a id="815" class="Symbol">}</a> <a id="817" class="Symbol">{</a><a id="818" href="ValueSepUTxO.AbstractCSL.html#818" class="Bound">l₂</a><a id="820" class="Symbol">}</a>     <a id="826" class="Symbol">{</a><a id="827" class="DottedPattern Symbol">.</a><a id="828" href="ValueSepUTxO.AbstractCSL.html#809" class="DottedPattern Bound">t</a> <a id="830" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="832" href="ValueSepUTxO.AbstractCSL.html#832" class="Bound">l</a><a id="833" class="Symbol">}</a> <a id="835" class="Symbol">{</a><a id="836" href="ValueSepUTxO.AbstractCSL.html#836" class="Bound">s₁</a><a id="838" class="Symbol">}</a> <a id="840" class="Symbol">{</a><a id="841" href="ValueSepUTxO.AbstractCSL.html#841" class="Bound">s₂</a><a id="843" class="Symbol">}</a> <a id="845" class="Symbol">{</a><a id="846" href="ValueSepUTxO.AbstractCSL.html#846" class="Bound">s</a><a id="847" class="Symbol">}</a> <a id="849" class="Symbol">{</a><a id="850" href="ValueSepUTxO.AbstractCSL.html#850" class="Bound">s₁′</a><a id="853" class="Symbol">}</a> <a id="855" class="Symbol">{</a><a id="856" href="ValueSepUTxO.AbstractCSL.html#856" class="Bound">s₂′</a><a id="859" class="Symbol">}</a> <a id="861" class="Symbol">(</a><a id="862" href="Prelude.Lists.html#2216" class="InductiveConstructor">keepˡ</a> <a id="868" href="ValueSepUTxO.AbstractCSL.html#868" class="Bound">≡l</a><a id="870" class="Symbol">)</a> <a id="872" href="ValueSepUTxO.AbstractCSL.html#872" class="Bound">≡s</a> <a id="875" href="ValueSepUTxO.AbstractCSL.html#875" class="Bound">ls₁</a>  <a id="880" href="ValueSepUTxO.AbstractCSL.html#880" class="Bound">ls₂</a>
  <a id="886" class="Keyword">with</a> <a id="891" href="ValueSepUTxO.AbstractLedger.html#994" class="Field Operator">⟦</a> <a id="893" href="ValueSepUTxO.AbstractCSL.html#809" class="Bound">t</a> <a id="895" href="ValueSepUTxO.AbstractLedger.html#994" class="Field Operator">⟧</a> <a id="897" href="ValueSepUTxO.AbstractCSL.html#836" class="Bound">s₁</a> <a id="900" class="Keyword">in</a> <a id="903" class="Argument">⟦t⟧s≡</a>
<a id="909" class="Symbol">...</a> <a id="913" class="Symbol">|</a> <a id="915" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="920" href="ValueSepUTxO.AbstractCSL.html#920" class="Bound">⟦t⟧s₁</a>
  <a id="928" class="Symbol">=</a> <a id="930" class="Hole">{!!}</a>
<a id="935" class="Comment">--   with ⟦ t ⟧ s | ◇-⟦⟧ᵗ {t = t} {s₁ = s₁} {s₂ = s₂} ⟦t⟧s₁ ⟦t⟧s≡ ≡s</a>
<a id="1004" class="Comment">-- ... | just ⟦t⟧s | ret↑ ≡s′</a>
<a id="1034" class="Comment">--   = ◇-interleave ≡l ≡s′ ls₁ ls₂</a>
<a id="1069" href="ValueSepUTxO.AbstractCSL.html#487" class="Function">◇-interleave</a> <a id="1082" class="Symbol">{</a><a id="1083" href="ValueSepUTxO.AbstractCSL.html#1083" class="Bound">l₁</a><a id="1085" class="Symbol">}</a>     <a id="1091" class="Symbol">{</a><a id="1092" href="ValueSepUTxO.AbstractCSL.html#1092" class="Bound">t</a> <a id="1094" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1096" href="ValueSepUTxO.AbstractCSL.html#1096" class="Bound">l₂</a><a id="1098" class="Symbol">}</a> <a id="1100" class="Symbol">{</a><a id="1101" class="DottedPattern Symbol">.</a><a id="1102" href="ValueSepUTxO.AbstractCSL.html#1092" class="DottedPattern Bound">t</a> <a id="1104" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1106" href="ValueSepUTxO.AbstractCSL.html#1106" class="Bound">l</a><a id="1107" class="Symbol">}</a> <a id="1109" class="Symbol">{</a><a id="1110" href="ValueSepUTxO.AbstractCSL.html#1110" class="Bound">s₁</a><a id="1112" class="Symbol">}</a> <a id="1114" class="Symbol">{</a><a id="1115" href="ValueSepUTxO.AbstractCSL.html#1115" class="Bound">s₂</a><a id="1117" class="Symbol">}</a> <a id="1119" class="Symbol">{</a><a id="1120" href="ValueSepUTxO.AbstractCSL.html#1120" class="Bound">s</a><a id="1121" class="Symbol">}</a> <a id="1123" class="Symbol">{</a><a id="1124" href="ValueSepUTxO.AbstractCSL.html#1124" class="Bound">s₁′</a><a id="1127" class="Symbol">}</a> <a id="1129" class="Symbol">{</a><a id="1130" href="ValueSepUTxO.AbstractCSL.html#1130" class="Bound">s₂′</a><a id="1133" class="Symbol">}</a> <a id="1135" class="Symbol">(</a><a id="1136" href="Prelude.Lists.html#2244" class="InductiveConstructor">keepʳ</a> <a id="1142" href="ValueSepUTxO.AbstractCSL.html#1142" class="Bound">≡l</a><a id="1144" class="Symbol">)</a> <a id="1146" href="ValueSepUTxO.AbstractCSL.html#1146" class="Bound">≡s</a> <a id="1149" href="ValueSepUTxO.AbstractCSL.html#1149" class="Bound">ls₁</a>  <a id="1154" href="ValueSepUTxO.AbstractCSL.html#1154" class="Bound">ls₂</a>
  <a id="1160" class="Keyword">with</a> <a id="1165" href="ValueSepUTxO.AbstractLedger.html#994" class="Field Operator">⟦</a> <a id="1167" href="ValueSepUTxO.AbstractCSL.html#1092" class="Bound">t</a> <a id="1169" href="ValueSepUTxO.AbstractLedger.html#994" class="Field Operator">⟧</a> <a id="1171" href="ValueSepUTxO.AbstractCSL.html#1115" class="Bound">s₂</a> <a id="1174" class="Keyword">in</a> <a id="1177" class="Argument">⟦t⟧s≡</a>
<a id="1183" class="Symbol">...</a> <a id="1187" class="Symbol">|</a> <a id="1189" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="1194" href="ValueSepUTxO.AbstractCSL.html#1194" class="Bound">⟦t⟧s₂</a>
  <a id="1202" class="Symbol">=</a> <a id="1204" class="Hole">{!!}</a>
<a id="1209" class="Comment">--   with ⟦ t ⟧ s | ◇-⟦⟧ᵗ˘ {t = t} {s₂ = s₂} {s₁ = s₁} ⟦t⟧s₂ ⟦t⟧s≡ ≡s</a>
<a id="1279" class="Comment">-- ... | just ⟦t⟧s | ret↑ ≡s′</a>
<a id="1309" class="Comment">--   = ◇-interleave ≡l ≡s′ ls₁ ls₂</a>

<a id="1345" class="Comment">-- ** Proof of CSL&#39;s [PAR] rule, which allows for modular reasoning.</a>
<a id="[PAR]"></a><a id="1414" href="ValueSepUTxO.AbstractCSL.html#1414" class="Function">[PAR]</a> <a id="1420" class="Symbol">:</a>
  <a id="1424" href="Prelude.InferenceRules.html#56094" class="Function Operator">∙</a> <a id="1426" href="ValueSepUTxO.AbstractLedger.html#630" class="Generalizable">l₁</a> <a id="1429" href="Prelude.Lists.html#2154" class="Function Operator">∥</a> <a id="1431" href="ValueSepUTxO.AbstractLedger.html#633" class="Generalizable">l₂</a> <a id="1434" href="Prelude.Lists.html#2154" class="Function Operator">≡</a> <a id="1436" href="ValueSepUTxO.AbstractLedger.html#622" class="Generalizable">l</a>
  <a id="1440" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="1442" href="ValueSepUTxO.AbstractHoareLogic.html#1139" class="Function Operator">⟨</a> <a id="1444" href="ValueSepUTxO.AbstractHoareLogic.html#590" class="Generalizable">P₁</a> <a id="1447" href="ValueSepUTxO.AbstractHoareLogic.html#1139" class="Function Operator">⟩</a> <a id="1449" href="ValueSepUTxO.AbstractLedger.html#630" class="Generalizable">l₁</a> <a id="1452" href="ValueSepUTxO.AbstractHoareLogic.html#1139" class="Function Operator">⟨</a> <a id="1454" href="ValueSepUTxO.AbstractHoareLogic.html#601" class="Generalizable">Q₁</a> <a id="1457" href="ValueSepUTxO.AbstractHoareLogic.html#1139" class="Function Operator">⟩</a>
  <a id="1461" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="1463" href="ValueSepUTxO.AbstractHoareLogic.html#1139" class="Function Operator">⟨</a> <a id="1465" href="ValueSepUTxO.AbstractHoareLogic.html#593" class="Generalizable">P₂</a> <a id="1468" href="ValueSepUTxO.AbstractHoareLogic.html#1139" class="Function Operator">⟩</a> <a id="1470" href="ValueSepUTxO.AbstractLedger.html#633" class="Generalizable">l₂</a> <a id="1473" href="ValueSepUTxO.AbstractHoareLogic.html#1139" class="Function Operator">⟨</a> <a id="1475" href="ValueSepUTxO.AbstractHoareLogic.html#604" class="Generalizable">Q₂</a> <a id="1478" href="ValueSepUTxO.AbstractHoareLogic.html#1139" class="Function Operator">⟩</a>
  <a id="1482" class="Comment">-- ∙ l₁ ♯♯ P₂</a>
  <a id="1498" class="Comment">-- ∙ l₂ ♯♯ P₁</a>
    <a id="1516" href="Prelude.InferenceRules.html#13959" class="Function Operator">─────────────────────────</a>
    <a id="1546" href="ValueSepUTxO.AbstractHoareLogic.html#1139" class="Function Operator">⟨</a> <a id="1548" href="ValueSepUTxO.AbstractHoareLogic.html#590" class="Generalizable">P₁</a> <a id="1551" href="ValueSepUTxO.AbstractHoareLogic.html#692" class="Function Operator">∗</a> <a id="1553" href="ValueSepUTxO.AbstractHoareLogic.html#593" class="Generalizable">P₂</a> <a id="1556" href="ValueSepUTxO.AbstractHoareLogic.html#1139" class="Function Operator">⟩</a> <a id="1558" href="ValueSepUTxO.AbstractLedger.html#622" class="Generalizable">l</a> <a id="1560" href="ValueSepUTxO.AbstractHoareLogic.html#1139" class="Function Operator">⟨</a> <a id="1562" href="ValueSepUTxO.AbstractHoareLogic.html#601" class="Generalizable">Q₁</a> <a id="1565" href="ValueSepUTxO.AbstractHoareLogic.html#692" class="Function Operator">∗</a> <a id="1567" href="ValueSepUTxO.AbstractHoareLogic.html#604" class="Generalizable">Q₂</a> <a id="1570" href="ValueSepUTxO.AbstractHoareLogic.html#1139" class="Function Operator">⟩</a>
<a id="1572" href="ValueSepUTxO.AbstractCSL.html#1414" class="Function">[PAR]</a> <a id="1578" class="Symbol">{</a><a id="1579" href="ValueSepUTxO.AbstractCSL.html#1579" class="Bound">l₁</a><a id="1581" class="Symbol">}</a> <a id="1583" class="Symbol">{</a><a id="1584" href="ValueSepUTxO.AbstractCSL.html#1584" class="Bound">l₂</a><a id="1586" class="Symbol">}</a> <a id="1588" class="Symbol">{</a><a id="1589" href="ValueSepUTxO.AbstractCSL.html#1589" class="Bound">l</a><a id="1590" class="Symbol">}</a> <a id="1592" href="ValueSepUTxO.AbstractCSL.html#1592" class="Bound">≡l</a> <a id="1595" href="ValueSepUTxO.AbstractCSL.html#1595" class="Bound">Pl₁Q</a> <a id="1600" href="ValueSepUTxO.AbstractCSL.html#1600" class="Bound">Pl₂Q</a> <a id="1605" class="Symbol">{</a><a id="1606" href="ValueSepUTxO.AbstractCSL.html#1606" class="Bound">s</a><a id="1607" class="Symbol">}</a> <a id="1609" class="Symbol">(</a><a id="1610" href="ValueSepUTxO.AbstractCSL.html#1610" class="Bound">s₁</a> <a id="1613" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1615" href="ValueSepUTxO.AbstractCSL.html#1615" class="Bound">s₂</a> <a id="1618" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1620" href="ValueSepUTxO.AbstractCSL.html#1620" class="Bound">≡s</a> <a id="1623" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1625" href="ValueSepUTxO.AbstractCSL.html#1625" class="Bound">Ps₁</a> <a id="1629" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1631" href="ValueSepUTxO.AbstractCSL.html#1631" class="Bound">Ps₂</a><a id="1634" class="Symbol">)</a>
  <a id="1638" class="Keyword">with</a> <a id="1643" href="ValueSepUTxO.AbstractLedger.html#994" class="Field Operator">⟦</a> <a id="1645" href="ValueSepUTxO.AbstractCSL.html#1579" class="Bound">l₁</a> <a id="1648" href="ValueSepUTxO.AbstractLedger.html#994" class="Field Operator">⟧</a> <a id="1650" href="ValueSepUTxO.AbstractCSL.html#1610" class="Bound">s₁</a> <a id="1653" class="Keyword">in</a> <a id="1656" class="Argument">ls₁</a> <a id="1660" class="Symbol">|</a> <a id="1662" href="ValueSepUTxO.AbstractCSL.html#1595" class="Bound">Pl₁Q</a> <a id="1667" href="ValueSepUTxO.AbstractCSL.html#1625" class="Bound">Ps₁</a>
<a id="1671" class="Symbol">...</a> <a id="1675" class="Symbol">|</a> <a id="1677" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="1682" href="ValueSepUTxO.AbstractCSL.html#1682" class="Bound">s₁′</a> <a id="1686" class="Symbol">|</a> <a id="1688" href="Data.Maybe.Relation.Unary.Any.html#900" class="InductiveConstructor">M.Any.just</a> <a id="1699" href="ValueSepUTxO.AbstractCSL.html#1699" class="Bound">Qs₁′</a>
  <a id="1706" class="Keyword">with</a> <a id="1711" href="ValueSepUTxO.AbstractLedger.html#994" class="Field Operator">⟦</a> <a id="1713" class="Bound">l₂</a> <a id="1716" href="ValueSepUTxO.AbstractLedger.html#994" class="Field Operator">⟧</a> <a id="1718" class="Bound">s₂</a> <a id="1721" class="Keyword">in</a> <a id="1724" class="Argument">ls₂</a> <a id="1728" class="Symbol">|</a> <a id="1730" class="Bound">Pl₂Q</a> <a id="1735" class="Bound">Ps₂</a>
<a id="1739" class="Symbol">...</a> <a id="1743" class="Symbol">|</a> <a id="1745" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="1750" href="ValueSepUTxO.AbstractCSL.html#1750" class="Bound">s₂′</a> <a id="1754" class="Symbol">|</a> <a id="1756" href="Data.Maybe.Relation.Unary.Any.html#900" class="InductiveConstructor">M.Any.just</a> <a id="1767" href="ValueSepUTxO.AbstractCSL.html#1767" class="Bound">Qs₂′</a>
  <a id="1774" class="Keyword">with</a> <a id="1779" href="ValueSepUTxO.AbstractCSL.html#1779" class="Bound">s′</a> <a id="1782" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1784" href="ValueSepUTxO.AbstractCSL.html#1784" class="Bound">ls</a> <a id="1787" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1789" href="ValueSepUTxO.AbstractCSL.html#1789" class="Bound">≡s′</a> ← <a id="1795" href="ValueSepUTxO.AbstractCSL.html#487" class="UnsolvedMeta Function">◇-interleave</a> <a id="1808" class="Bound">≡l</a> <a id="1811" class="UnsolvedMeta UnsolvedConstraint Bound">≡s</a> <a id="1814" href="ValueSepUTxO.AbstractCSL.html#1656" class="Bound">ls₁</a> <a id="1818" href="ValueSepUTxO.AbstractCSL.html#1724" class="Bound">ls₂</a>
  <a id="1824" class="Symbol">=</a> <a id="1826" class="Hole">{!!}</a>
  <a id="1833" class="Comment">-- rewrite ls</a>
  <a id="1849" class="Comment">-- = M.Any.just (s₁′ , s₂′ , ≡s′ , Qs₁′ , Qs₂′)</a>

<a id="1898" class="Keyword">open</a> <a id="1903" href="ValueSepUTxO.AbstractHoareLogic.html#3133" class="Module">HoareReasoning</a>
<a id="ℝ[PAR]"></a><a id="1918" href="ValueSepUTxO.AbstractCSL.html#1918" class="Function">ℝ[PAR]</a> <a id="1925" class="Symbol">:</a>
  <a id="1929" href="Prelude.InferenceRules.html#56094" class="Function Operator">∙</a> <a id="1931" href="ValueSepUTxO.AbstractLedger.html#630" class="Generalizable">l₁</a> <a id="1934" href="Prelude.Lists.html#2154" class="Function Operator">∥</a> <a id="1936" href="ValueSepUTxO.AbstractLedger.html#633" class="Generalizable">l₂</a> <a id="1939" href="Prelude.Lists.html#2154" class="Function Operator">≡</a> <a id="1941" href="ValueSepUTxO.AbstractLedger.html#622" class="Generalizable">l</a>
  <a id="1945" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="1947" href="ValueSepUTxO.AbstractHoareLogic.html#3215" class="Record Operator">ℝ⟨</a> <a id="1950" href="ValueSepUTxO.AbstractHoareLogic.html#590" class="Generalizable">P₁</a> <a id="1953" href="ValueSepUTxO.AbstractHoareLogic.html#3215" class="Record Operator">⟩</a> <a id="1955" href="ValueSepUTxO.AbstractLedger.html#630" class="Generalizable">l₁</a> <a id="1958" href="ValueSepUTxO.AbstractHoareLogic.html#3215" class="Record Operator">⟨</a> <a id="1960" href="ValueSepUTxO.AbstractHoareLogic.html#601" class="Generalizable">Q₁</a> <a id="1963" href="ValueSepUTxO.AbstractHoareLogic.html#3215" class="Record Operator">⟩</a>
  <a id="1967" href="Prelude.InferenceRules.html#56028" class="Function Operator">∙</a> <a id="1969" href="ValueSepUTxO.AbstractHoareLogic.html#3215" class="Record Operator">ℝ⟨</a> <a id="1972" href="ValueSepUTxO.AbstractHoareLogic.html#593" class="Generalizable">P₂</a> <a id="1975" href="ValueSepUTxO.AbstractHoareLogic.html#3215" class="Record Operator">⟩</a> <a id="1977" href="ValueSepUTxO.AbstractLedger.html#633" class="Generalizable">l₂</a> <a id="1980" href="ValueSepUTxO.AbstractHoareLogic.html#3215" class="Record Operator">⟨</a> <a id="1982" href="ValueSepUTxO.AbstractHoareLogic.html#604" class="Generalizable">Q₂</a> <a id="1985" href="ValueSepUTxO.AbstractHoareLogic.html#3215" class="Record Operator">⟩</a>
    <a id="1991" href="Prelude.InferenceRules.html#13959" class="Function Operator">─────────────────────────</a>
    <a id="2021" href="ValueSepUTxO.AbstractHoareLogic.html#3215" class="Record Operator">ℝ⟨</a> <a id="2024" href="ValueSepUTxO.AbstractHoareLogic.html#590" class="Generalizable">P₁</a> <a id="2027" href="ValueSepUTxO.AbstractHoareLogic.html#692" class="Function Operator">∗</a> <a id="2029" href="ValueSepUTxO.AbstractHoareLogic.html#593" class="Generalizable">P₂</a> <a id="2032" href="ValueSepUTxO.AbstractHoareLogic.html#3215" class="Record Operator">⟩</a> <a id="2034" href="ValueSepUTxO.AbstractLedger.html#622" class="Generalizable">l</a> <a id="2036" href="ValueSepUTxO.AbstractHoareLogic.html#3215" class="Record Operator">⟨</a> <a id="2038" href="ValueSepUTxO.AbstractHoareLogic.html#601" class="Generalizable">Q₁</a> <a id="2041" href="ValueSepUTxO.AbstractHoareLogic.html#692" class="Function Operator">∗</a> <a id="2043" href="ValueSepUTxO.AbstractHoareLogic.html#604" class="Generalizable">Q₂</a> <a id="2046" href="ValueSepUTxO.AbstractHoareLogic.html#3215" class="Record Operator">⟩</a>
<a id="2048" href="ValueSepUTxO.AbstractCSL.html#1918" class="Function">ℝ[PAR]</a> <a id="2055" href="ValueSepUTxO.AbstractCSL.html#2055" class="Bound">≡l</a> <a id="2058" href="ValueSepUTxO.AbstractCSL.html#2058" class="Bound">PlQ</a> <a id="2062" href="ValueSepUTxO.AbstractCSL.html#2062" class="Bound">PlQ′</a> <a id="2067" class="Symbol">=</a> <a id="2069" href="ValueSepUTxO.AbstractHoareLogic.html#3292" class="InductiveConstructor Operator">mkℝ</a> <a id="2073" href="ValueSepUTxO.AbstractCSL.html#1414" class="Function">[PAR]</a> <a id="2079" href="ValueSepUTxO.AbstractCSL.html#2055" class="Bound">≡l</a> <a id="2082" class="Symbol">(</a><a id="2083" href="ValueSepUTxO.AbstractHoareLogic.html#3307" class="Field Operator">begin</a> <a id="2089" href="ValueSepUTxO.AbstractCSL.html#2058" class="Bound">PlQ</a><a id="2092" class="Symbol">)</a> <a id="2094" class="Symbol">(</a><a id="2095" href="ValueSepUTxO.AbstractHoareLogic.html#3307" class="Field Operator">begin</a> <a id="2101" href="ValueSepUTxO.AbstractCSL.html#2062" class="Bound">PlQ′</a><a id="2105" class="Symbol">)</a>


<a id="2109" class="Comment">-- ◇-interleave :</a>
<a id="2127" class="Comment">--   ∙ (l₁ ∥ l₂ ≡ l)</a>
<a id="2148" class="Comment">--   ∙ ⟨ s₁ ◇ s₂ ⟩≡ s</a>
<a id="2170" class="Comment">--   ∙ ⟦ l₁ ⟧ s₁ ≡ just s₁′</a>
<a id="2198" class="Comment">--   ∙ ⟦ l₂ ⟧ s₂ ≡ just s₂′</a>
<a id="2226" class="Comment">--     ───────────────────────────</a>
<a id="2261" class="Comment">--     ∃ λ s′ → (⟦ l ⟧ s ≡ just s′)</a>
<a id="2297" class="Comment">--            × (⟨ s₁′ ◇ s₂′ ⟩≡ s′)</a>
<a id="2333" class="Comment">-- ◇-interleave {.[]}    {.[]}    {.[]}    {s₁} {s₂} {s} {.s₁} {.s₂} []         ≡s refl refl</a>
<a id="2426" class="Comment">--   = s , refl , ≡s</a>
<a id="2447" class="Comment">-- ◇-interleave {t ∷ l₁} {l₂}     {.t ∷ l} {s₁} {s₂} {s} {s₁′} {s₂′} (keepˡ ≡l) ≡s ls₁  ls₂</a>
<a id="2539" class="Comment">--   with ⟦ t ⟧ s₁ in ⟦t⟧s≡</a>
<a id="2567" class="Comment">-- ... | just ⟦t⟧s₁</a>
<a id="2587" class="Comment">--   with ⟦ t ⟧ s | ◇-⟦⟧ᵗ {t = t} {s₁ = s₁} {s₂ = s₂} ⟦t⟧s₁ ⟦t⟧s≡ ≡s</a>
<a id="2656" class="Comment">-- ... | just ⟦t⟧s | ret↑ ≡s′</a>
<a id="2686" class="Comment">--   = ◇-interleave ≡l ≡s′ ls₁ ls₂</a>
<a id="2721" class="Comment">-- ◇-interleave {l₁}     {t ∷ l₂} {.t ∷ l} {s₁} {s₂} {s} {s₁′} {s₂′} (keepʳ ≡l) ≡s ls₁  ls₂</a>
<a id="2813" class="Comment">--   with ⟦ t ⟧ s₂ in ⟦t⟧s≡</a>
<a id="2841" class="Comment">-- ... | just ⟦t⟧s₂</a>
<a id="2861" class="Comment">--   with ⟦ t ⟧ s | ◇-⟦⟧ᵗ˘ {t = t} {s₂ = s₂} {s₁ = s₁} ⟦t⟧s₂ ⟦t⟧s≡ ≡s</a>
<a id="2931" class="Comment">-- ... | just ⟦t⟧s | ret↑ ≡s′</a>
<a id="2961" class="Comment">--   = ◇-interleave ≡l ≡s′ ls₁ ls₂</a>

<a id="2997" class="Comment">-- -- ** Proof of CSL&#39;s [PAR] rule, which allows for modular reasoning.</a>
<a id="3069" class="Comment">-- [PAR] :</a>
<a id="3080" class="Comment">--   ∙ l₁ ∥ l₂ ≡ l</a>
<a id="3099" class="Comment">--   ∙ ⟨ P₁ ⟩ l₁ ⟨ Q₁ ⟩</a>
<a id="3123" class="Comment">--   ∙ ⟨ P₂ ⟩ l₂ ⟨ Q₂ ⟩</a>
<a id="3147" class="Comment">--     ─────────────────────────</a>
<a id="3180" class="Comment">--     ⟨ P₁ ∗ P₂ ⟩ l ⟨ Q₁ ∗ Q₂ ⟩</a>
<a id="3213" class="Comment">-- [PAR] {l₁} {l₂} {l} ≡l Pl₁Q Pl₂Q {s} (s₁ , s₂ , ≡s , Ps₁ , Ps₂)</a>
<a id="3280" class="Comment">--   with ⟦ l₁ ⟧ s₁ in ls₁ | Pl₁Q Ps₁</a>
<a id="3318" class="Comment">-- ... | just s₁′ | M.Any.just Qs₁′</a>
<a id="3354" class="Comment">--   with ⟦ l₂ ⟧ s₂ in ls₂ | Pl₂Q Ps₂</a>
<a id="3392" class="Comment">-- ... | just s₂′ | M.Any.just Qs₂′</a>
<a id="3428" class="Comment">--   with s′ , ls , ≡s′ ← ◇-interleave ≡l ≡s ls₁ ls₂</a>
<a id="3481" class="Comment">--   rewrite ls</a>
<a id="3497" class="Comment">--   = M.Any.just (s₁′ , s₂′ , ≡s′ , Qs₁′ , Qs₂′)</a>

<a id="3548" class="Comment">-- open HoareReasoning</a>
<a id="3571" class="Comment">-- ℝ[PAR] :</a>
<a id="3583" class="Comment">--   ∙ l₁ ∥ l₂ ≡ l</a>
<a id="3602" class="Comment">--   ∙ ℝ⟨ P₁ ⟩ l₁ ⟨ Q₁ ⟩</a>
<a id="3627" class="Comment">--   ∙ ℝ⟨ P₂ ⟩ l₂ ⟨ Q₂ ⟩</a>
<a id="3652" class="Comment">--     ─────────────────────────</a>
<a id="3685" class="Comment">--     ℝ⟨ P₁ ∗ P₂ ⟩ l ⟨ Q₁ ∗ Q₂ ⟩</a>
<a id="3719" class="Comment">-- ℝ[PAR] ≡l PlQ PlQ′ = mkℝ [PAR] ≡l (begin PlQ) (begin PlQ′)</a>
</pre></body></html>