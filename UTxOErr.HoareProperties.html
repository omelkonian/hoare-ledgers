<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>UTxOErr.HoareProperties</title><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css'/><style>.github-fork-ribbon:before { background-color: #333; }</style><link rel="stylesheet" href="css/Agda.css"></head><body><a class='github-fork-ribbon'href='https://github.com/omelkonian/hoare-ledgers/tree/master/UTxOErr/HoareProperties.agda'data-ribbon='Source code on Github' title='Source code on Github'>Source code on Github</a><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--allow-unsolved-metas</a> <a id="36" class="Symbol">#-}</a>
<a id="40" class="Comment">-------------------------------------</a>
<a id="78" class="Comment">-- ** Properties for Hoare triples.</a>

<a id="115" class="Keyword">module</a> <a id="122" href="UTxOErr.HoareProperties.html" class="Module">UTxOErr.HoareProperties</a> <a id="146" class="Keyword">where</a>

<a id="153" class="Keyword">open</a> <a id="158" class="Keyword">import</a> <a id="165" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="178" class="Keyword">open</a> <a id="183" class="Keyword">import</a> <a id="190" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="206" class="Keyword">open</a> <a id="211" class="Keyword">import</a> <a id="218" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="232" class="Keyword">open</a> <a id="237" class="Keyword">import</a> <a id="244" href="Prelude.Decidable.html" class="Module">Prelude.Decidable</a>
<a id="262" class="Keyword">open</a> <a id="267" class="Keyword">import</a> <a id="274" href="Prelude.InferenceRules.html" class="Module">Prelude.InferenceRules</a>

<a id="298" class="Keyword">open</a> <a id="303" class="Keyword">import</a> <a id="310" href="UTxOErr.Maps.html" class="Module">UTxOErr.Maps</a>
<a id="323" class="Keyword">open</a> <a id="328" class="Keyword">import</a> <a id="335" href="UTxOErr.UTxO.html" class="Module">UTxOErr.UTxO</a>
<a id="348" class="Keyword">open</a> <a id="353" class="Keyword">import</a> <a id="360" href="UTxOErr.Ledger.html" class="Module">UTxOErr.Ledger</a>
<a id="375" class="Keyword">open</a> <a id="380" class="Keyword">import</a> <a id="387" href="UTxOErr.HoareLogic.html" class="Module">UTxOErr.HoareLogic</a>

<a id="407" class="Comment">-- ** Lemmas about separating conjunction.</a>

<a id="451" class="Comment">-- commutativity</a>
<a id="∗↔"></a><a id="468" href="UTxOErr.HoareProperties.html#468" class="Function">∗↔</a> <a id="471" class="Symbol">:</a> <a id="473" href="UTxOErr.HoareLogic.html#607" class="Generalizable">P</a> <a id="475" href="UTxOErr.HoareLogic.html#715" class="Function Operator">∗</a> <a id="477" href="UTxOErr.HoareLogic.html#618" class="Generalizable">Q</a> <a id="479" href="Prelude.General.html#1709" class="Function Operator">⊢</a> <a id="481" href="UTxOErr.HoareLogic.html#618" class="Generalizable">Q</a> <a id="483" href="UTxOErr.HoareLogic.html#715" class="Function Operator">∗</a> <a id="485" href="UTxOErr.HoareLogic.html#607" class="Generalizable">P</a>
<a id="487" href="UTxOErr.HoareProperties.html#468" class="Function">∗↔</a> <a id="490" class="Symbol">(</a><a id="491" href="UTxOErr.HoareProperties.html#491" class="Bound">s₁</a> <a id="494" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="496" href="UTxOErr.HoareProperties.html#496" class="Bound">s₂</a> <a id="499" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="501" href="UTxOErr.HoareProperties.html#501" class="Bound">≡s</a> <a id="504" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="506" href="UTxOErr.HoareProperties.html#506" class="Bound">Ps₁</a> <a id="510" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="512" href="UTxOErr.HoareProperties.html#512" class="Bound">Qs₂</a><a id="515" class="Symbol">)</a> <a id="517" class="Symbol">=</a> <a id="519" href="UTxOErr.HoareProperties.html#496" class="Bound">s₂</a> <a id="522" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="524" href="UTxOErr.HoareProperties.html#491" class="Bound">s₁</a> <a id="527" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="529" href="UTxOErr.Maps.html#5651" class="Function">⊎≡-comm</a> <a id="537" class="Symbol">{</a><a id="538" class="Argument">x</a> <a id="540" class="Symbol">=</a> <a id="542" href="UTxOErr.HoareProperties.html#491" class="Bound">s₁</a><a id="544" class="Symbol">}{</a><a id="546" href="UTxOErr.HoareProperties.html#496" class="Bound">s₂</a><a id="548" class="Symbol">}</a> <a id="550" href="UTxOErr.HoareProperties.html#501" class="Bound">≡s</a> <a id="553" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="555" href="UTxOErr.HoareProperties.html#512" class="Bound">Qs₂</a> <a id="559" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="561" href="UTxOErr.HoareProperties.html#506" class="Bound">Ps₁</a>

<a id="566" class="Comment">-- associativity</a>
<a id="∗↝"></a><a id="583" href="UTxOErr.HoareProperties.html#583" class="Function">∗↝</a> <a id="586" class="Symbol">:</a> <a id="588" href="UTxOErr.HoareLogic.html#607" class="Generalizable">P</a> <a id="590" href="UTxOErr.HoareLogic.html#715" class="Function Operator">∗</a> <a id="592" href="UTxOErr.HoareLogic.html#618" class="Generalizable">Q</a> <a id="594" href="UTxOErr.HoareLogic.html#715" class="Function Operator">∗</a> <a id="596" href="UTxOErr.HoareLogic.html#629" class="Generalizable">R</a> <a id="598" href="Prelude.General.html#1709" class="Function Operator">⊢</a> <a id="600" class="Symbol">(</a><a id="601" href="UTxOErr.HoareLogic.html#607" class="Generalizable">P</a> <a id="603" href="UTxOErr.HoareLogic.html#715" class="Function Operator">∗</a> <a id="605" href="UTxOErr.HoareLogic.html#618" class="Generalizable">Q</a><a id="606" class="Symbol">)</a> <a id="608" href="UTxOErr.HoareLogic.html#715" class="Function Operator">∗</a> <a id="610" href="UTxOErr.HoareLogic.html#629" class="Generalizable">R</a>
<a id="612" href="UTxOErr.HoareProperties.html#583" class="Function">∗↝</a> <a id="615" class="Symbol">{</a><a id="616" class="Argument">x</a> <a id="618" class="Symbol">=</a> <a id="620" href="UTxOErr.HoareProperties.html#620" class="Bound">s</a><a id="621" class="Symbol">}</a> <a id="623" class="Symbol">(</a><a id="624" href="UTxOErr.HoareProperties.html#624" class="Bound">s₁</a> <a id="627" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="629" href="UTxOErr.HoareProperties.html#629" class="Bound">s₂₃</a> <a id="633" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="635" href="UTxOErr.HoareProperties.html#635" class="Bound">≡s</a> <a id="638" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="640" href="UTxOErr.HoareProperties.html#640" class="Bound">Ps₁</a> <a id="644" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="646" class="Symbol">(</a><a id="647" href="UTxOErr.HoareProperties.html#647" class="Bound">s₂</a> <a id="650" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="652" href="UTxOErr.HoareProperties.html#652" class="Bound">s₃</a> <a id="655" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="657" href="UTxOErr.HoareProperties.html#657" class="Bound">≡s₂₃</a> <a id="662" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="664" href="UTxOErr.HoareProperties.html#664" class="Bound">Qs₂</a> <a id="668" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="670" href="UTxOErr.HoareProperties.html#670" class="Bound">Rs₃</a><a id="673" class="Symbol">))</a> <a id="676" class="Symbol">=</a>
  <a id="680" class="Keyword">let</a> <a id="684" href="UTxOErr.HoareProperties.html#684" class="Bound">≡s₁₂</a> <a id="689" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="691" href="UTxOErr.HoareProperties.html#691" class="Bound">s₁♯s₂</a> <a id="697" class="Symbol">=</a> <a id="699" href="UTxOErr.Maps.html#5981" class="Function">⊎≈-assocʳ</a> <a id="709" href="UTxOErr.HoareProperties.html#635" class="Bound">≡s</a> <a id="712" href="UTxOErr.HoareProperties.html#657" class="Bound">≡s₂₃</a> <a id="717" class="Keyword">in</a>
  <a id="722" class="Symbol">(</a><a id="723" href="UTxOErr.HoareProperties.html#624" class="Bound">s₁</a> <a id="726" href="UTxOErr.Maps.html#1018" class="Function Operator">∪</a> <a id="728" href="UTxOErr.HoareProperties.html#647" class="Bound">s₂</a><a id="730" class="Symbol">)</a> <a id="732" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="734" href="UTxOErr.HoareProperties.html#652" class="Bound">s₃</a> <a id="737" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="739" href="UTxOErr.HoareProperties.html#684" class="Bound">≡s₁₂</a> <a id="744" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="746" class="Symbol">(</a><a id="747" href="UTxOErr.HoareProperties.html#624" class="Bound">s₁</a> <a id="750" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="752" href="UTxOErr.HoareProperties.html#647" class="Bound">s₂</a> <a id="755" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="757" class="Symbol">(</a><a id="758" href="UTxOErr.HoareProperties.html#691" class="Bound">s₁♯s₂</a> <a id="764" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="766" href="UTxOErr.Maps.html#1525" class="Function">≈-refl</a><a id="772" class="Symbol">)</a> <a id="774" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="776" href="UTxOErr.HoareProperties.html#640" class="Bound">Ps₁</a> <a id="780" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="782" href="UTxOErr.HoareProperties.html#664" class="Bound">Qs₂</a><a id="785" class="Symbol">)</a> <a id="787" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="789" href="UTxOErr.HoareProperties.html#670" class="Bound">Rs₃</a>

<a id="↜∗"></a><a id="794" href="UTxOErr.HoareProperties.html#794" class="Function">↜∗</a> <a id="797" class="Symbol">:</a> <a id="799" class="Symbol">(</a><a id="800" href="UTxOErr.HoareLogic.html#607" class="Generalizable">P</a> <a id="802" href="UTxOErr.HoareLogic.html#715" class="Function Operator">∗</a> <a id="804" href="UTxOErr.HoareLogic.html#618" class="Generalizable">Q</a><a id="805" class="Symbol">)</a> <a id="807" href="UTxOErr.HoareLogic.html#715" class="Function Operator">∗</a> <a id="809" href="UTxOErr.HoareLogic.html#629" class="Generalizable">R</a> <a id="811" href="Prelude.General.html#1709" class="Function Operator">⊢</a> <a id="813" href="UTxOErr.HoareLogic.html#607" class="Generalizable">P</a> <a id="815" href="UTxOErr.HoareLogic.html#715" class="Function Operator">∗</a> <a id="817" href="UTxOErr.HoareLogic.html#618" class="Generalizable">Q</a> <a id="819" href="UTxOErr.HoareLogic.html#715" class="Function Operator">∗</a> <a id="821" href="UTxOErr.HoareLogic.html#629" class="Generalizable">R</a>
<a id="823" href="UTxOErr.HoareProperties.html#794" class="Function">↜∗</a> <a id="826" class="Symbol">{</a><a id="827" class="Argument">x</a> <a id="829" class="Symbol">=</a> <a id="831" href="UTxOErr.HoareProperties.html#831" class="Bound">s</a><a id="832" class="Symbol">}</a> <a id="834" class="Symbol">(</a><a id="835" href="UTxOErr.HoareProperties.html#835" class="Bound">s₁₂</a> <a id="839" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="841" href="UTxOErr.HoareProperties.html#841" class="Bound">s₃</a> <a id="844" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="846" href="UTxOErr.HoareProperties.html#846" class="Bound">≡s</a> <a id="849" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="851" class="Symbol">(</a><a id="852" href="UTxOErr.HoareProperties.html#852" class="Bound">s₁</a> <a id="855" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="857" href="UTxOErr.HoareProperties.html#857" class="Bound">s₂</a> <a id="860" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="862" href="UTxOErr.HoareProperties.html#862" class="Bound">≡s₁₂</a> <a id="867" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="869" href="UTxOErr.HoareProperties.html#869" class="Bound">Ps₁</a> <a id="873" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="875" href="UTxOErr.HoareProperties.html#875" class="Bound">Qs₂</a><a id="878" class="Symbol">)</a> <a id="880" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="882" href="UTxOErr.HoareProperties.html#882" class="Bound">Rs₃</a><a id="885" class="Symbol">)</a> <a id="887" class="Symbol">=</a>
  <a id="891" class="Keyword">let</a> <a id="895" href="UTxOErr.HoareProperties.html#895" class="Bound">≡s₂₃</a> <a id="900" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="902" href="UTxOErr.HoareProperties.html#902" class="Bound">s₂♯s₃</a> <a id="908" class="Symbol">=</a> <a id="910" href="UTxOErr.Maps.html#6679" class="Function">⊎≈-assocˡ</a> <a id="920" href="UTxOErr.HoareProperties.html#846" class="Bound">≡s</a> <a id="923" href="UTxOErr.HoareProperties.html#862" class="Bound">≡s₁₂</a> <a id="928" class="Keyword">in</a>
  <a id="933" href="UTxOErr.HoareProperties.html#852" class="Bound">s₁</a> <a id="936" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="938" href="UTxOErr.HoareProperties.html#857" class="Bound">s₂</a> <a id="941" href="UTxOErr.Maps.html#1018" class="Function Operator">∪</a> <a id="943" href="UTxOErr.HoareProperties.html#841" class="Bound">s₃</a> <a id="946" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="948" href="UTxOErr.HoareProperties.html#895" class="Bound">≡s₂₃</a> <a id="953" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="955" href="UTxOErr.HoareProperties.html#869" class="Bound">Ps₁</a> <a id="959" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="961" class="Symbol">(</a><a id="962" href="UTxOErr.HoareProperties.html#857" class="Bound">s₂</a> <a id="965" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="967" href="UTxOErr.HoareProperties.html#841" class="Bound">s₃</a> <a id="970" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="972" class="Symbol">(</a><a id="973" href="UTxOErr.HoareProperties.html#902" class="Bound">s₂♯s₃</a> <a id="979" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="981" href="UTxOErr.Maps.html#1525" class="Function">≈-refl</a><a id="987" class="Symbol">)</a> <a id="989" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="991" href="UTxOErr.HoareProperties.html#875" class="Bound">Qs₂</a> <a id="995" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="997" href="UTxOErr.HoareProperties.html#882" class="Bound">Rs₃</a><a id="1000" class="Symbol">)</a>

<a id="1003" class="Comment">-- ** Useful lemmas when transferring a value between participants in the minimal context.</a>
<a id="transfer"></a><a id="1094" href="UTxOErr.HoareProperties.html#1094" class="Function">transfer</a> <a id="1103" class="Symbol">:</a> <a id="1105" class="Symbol">∀</a> <a id="1107" class="Symbol">{</a><a id="1108" href="UTxOErr.HoareProperties.html#1108" class="Bound">tx</a> <a id="1111" class="Symbol">:</a> <a id="1113" href="UTxOErr.UTxO.html#1503" class="Record">Tx</a><a id="1115" class="Symbol">}</a> <a id="1117" class="Symbol">{</a><a id="1118" href="UTxOErr.HoareProperties.html#1118" class="Bound">v</a> <a id="1120" class="Symbol">:</a> <a id="1122" href="UTxOErr.UTxO.html#415" class="Function">Value</a><a id="1127" class="Symbol">}</a> <a id="1129" class="Symbol">{</a><a id="1130" href="UTxOErr.HoareProperties.html#1130" class="Bound">B</a> <a id="1132" class="Symbol">:</a> <a id="1134" href="UTxOErr.UTxO.html#439" class="Function">Address</a><a id="1141" class="Symbol">}</a> <a id="1143" class="Symbol">{</a><a id="1144" href="UTxOErr.HoareProperties.html#1144" class="Bound">or</a> <a id="1147" class="Symbol">:</a> <a id="1149" href="UTxOErr.UTxO.html#560" class="Record">TxOutputRef</a><a id="1160" class="Symbol">}</a> <a id="1162" class="Symbol">{</a><a id="1163" href="UTxOErr.HoareProperties.html#1163" class="Bound">rdm</a> <a id="1167" class="Symbol">:</a> <a id="1169" href="UTxOErr.UTxO.html#500" class="Function">DATA</a><a id="1173" class="Symbol">}</a> <a id="1175" class="Symbol">{</a><a id="1176" href="UTxOErr.HoareProperties.html#1176" class="Bound">val</a> <a id="1180" class="Symbol">:</a> <a id="1182" href="UTxOErr.UTxO.html#1077" class="Record">TxInfo</a> <a id="1189" class="Symbol">→</a> <a id="1191" href="UTxOErr.UTxO.html#500" class="Function">DATA</a> <a id="1196" class="Symbol">→</a> <a id="1198" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a><a id="1202" class="Symbol">}</a> <a id="1204" class="Symbol">→</a>
  <a id="1208" href="Prelude.InferenceRules.html#56141" class="Function Operator">∙</a> <a id="1210" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="1212" class="Symbol">(</a><a id="1213" href="UTxOErr.HoareProperties.html#1176" class="Bound">val</a> <a id="1217" class="Symbol">(</a><a id="1218" href="UTxOErr.UTxO.html#1618" class="Function">mkTxInfo</a> <a id="1227" href="UTxOErr.HoareProperties.html#1108" class="Bound">tx</a><a id="1229" class="Symbol">)</a> <a id="1231" href="UTxOErr.HoareProperties.html#1163" class="Bound">rdm</a><a id="1234" class="Symbol">)</a>
  <a id="1238" href="Prelude.InferenceRules.html#56072" class="Function Operator">∙</a> <a id="1240" href="UTxOErr.HoareProperties.html#1108" class="Bound">tx</a> <a id="1243" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1245" class="Keyword">record</a> <a id="1252" class="Symbol">{</a> <a id="1254" class="Field">inputs</a>  <a id="1262" class="Symbol">=</a> <a id="1264" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="1266" class="Keyword">record</a> <a id="1273" class="Symbol">{</a><a id="1274" class="Field">outputRef</a> <a id="1284" class="Symbol">=</a> <a id="1286" href="UTxOErr.HoareProperties.html#1144" class="Bound">or</a><a id="1288" class="Symbol">;</a> <a id="1290" class="Field">validator</a> <a id="1300" class="Symbol">=</a> <a id="1302" href="UTxOErr.HoareProperties.html#1176" class="Bound">val</a><a id="1305" class="Symbol">;</a> <a id="1307" class="Field">redeemer</a> <a id="1316" class="Symbol">=</a> <a id="1318" href="UTxOErr.HoareProperties.html#1163" class="Bound">rdm</a><a id="1321" class="Symbol">}</a> <a id="1323" href="Data.List.Base.html#5034" class="Function Operator">]</a>
                <a id="1341" class="Symbol">;</a> <a id="1343" class="Field">outputs</a> <a id="1351" class="Symbol">=</a> <a id="1353" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="1355" href="UTxOErr.HoareProperties.html#1118" class="Bound">v</a> <a id="1357" href="UTxOErr.UTxO.html#794" class="InductiveConstructor Operator">at</a> <a id="1360" href="UTxOErr.HoareProperties.html#1130" class="Bound">B</a> <a id="1362" href="Data.List.Base.html#5034" class="Function Operator">]</a>
                <a id="1380" class="Symbol">;</a> <a id="1382" class="Field">forge</a>   <a id="1390" class="Symbol">=</a> <a id="1392" class="Number">0</a> <a id="1394" class="Symbol">}</a>
    <a id="1400" href="Prelude.InferenceRules.html#13602" class="Function Operator">────────────────────────────────────</a>
    <a id="1441" href="UTxOErr.HoareLogic.html#1171" class="Function Operator">⟨</a> <a id="1443" href="UTxOErr.HoareProperties.html#1144" class="Bound">or</a> <a id="1446" href="UTxOErr.HoareLogic.html#795" class="Function Operator">↦</a> <a id="1448" href="UTxOErr.HoareProperties.html#1118" class="Bound">v</a> <a id="1450" href="UTxOErr.UTxO.html#794" class="InductiveConstructor Operator">at</a> <a id="1453" class="Symbol">(</a><a id="1454" href="UTxOErr.HoareProperties.html#1176" class="Bound">val</a> <a id="1458" href="UTxOErr.UTxO.html#466" class="Postulate Operator">♯</a><a id="1459" class="Symbol">)</a> <a id="1461" href="UTxOErr.HoareLogic.html#1171" class="Function Operator">⟩</a>
    <a id="1467" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="1469" href="UTxOErr.HoareProperties.html#1108" class="Bound">tx</a> <a id="1472" href="Data.List.Base.html#5034" class="Function Operator">]</a>
    <a id="1478" href="UTxOErr.HoareLogic.html#1171" class="Function Operator">⟨</a> <a id="1480" class="Symbol">(</a><a id="1481" href="UTxOErr.HoareProperties.html#1108" class="Bound">tx</a> <a id="1484" href="UTxOErr.UTxO.html#466" class="Postulate Operator">♯</a><a id="1485" class="Symbol">)</a> <a id="1487" href="UTxOErr.UTxO.html#599" class="InductiveConstructor Operator">indexed-at</a> <a id="1498" class="Number">0</a> <a id="1500" href="UTxOErr.HoareLogic.html#795" class="Function Operator">↦</a> <a id="1502" href="UTxOErr.HoareProperties.html#1118" class="Bound">v</a> <a id="1504" href="UTxOErr.UTxO.html#794" class="InductiveConstructor Operator">at</a> <a id="1507" href="UTxOErr.HoareProperties.html#1130" class="Bound">B</a> <a id="1509" href="UTxOErr.HoareLogic.html#1171" class="Function Operator">⟩</a>
<a id="1511" href="UTxOErr.HoareProperties.html#1094" class="Function">transfer</a> <a id="1520" class="Symbol">=</a> <a id="1522" class="Hole">{!!}</a>

<a id="1528" class="Keyword">open</a> <a id="1533" href="UTxOErr.HoareLogic.html#3166" class="Module">HoareReasoning</a>
<a id="transferℝ"></a><a id="1548" href="UTxOErr.HoareProperties.html#1548" class="Function">transferℝ</a> <a id="1558" class="Symbol">:</a> <a id="1560" class="Symbol">∀</a> <a id="1562" class="Symbol">{</a><a id="1563" href="UTxOErr.HoareProperties.html#1563" class="Bound">tx</a> <a id="1566" class="Symbol">:</a> <a id="1568" href="UTxOErr.UTxO.html#1503" class="Record">Tx</a><a id="1570" class="Symbol">}</a> <a id="1572" class="Symbol">{</a><a id="1573" href="UTxOErr.HoareProperties.html#1573" class="Bound">v</a> <a id="1575" class="Symbol">:</a> <a id="1577" href="UTxOErr.UTxO.html#415" class="Function">Value</a><a id="1582" class="Symbol">}</a> <a id="1584" class="Symbol">{</a><a id="1585" href="UTxOErr.HoareProperties.html#1585" class="Bound">B</a> <a id="1587" class="Symbol">:</a> <a id="1589" href="UTxOErr.UTxO.html#439" class="Function">Address</a><a id="1596" class="Symbol">}</a> <a id="1598" class="Symbol">{</a><a id="1599" href="UTxOErr.HoareProperties.html#1599" class="Bound">or</a> <a id="1602" class="Symbol">:</a> <a id="1604" href="UTxOErr.UTxO.html#560" class="Record">TxOutputRef</a><a id="1615" class="Symbol">}</a> <a id="1617" class="Symbol">{</a><a id="1618" href="UTxOErr.HoareProperties.html#1618" class="Bound">rdm</a> <a id="1622" class="Symbol">:</a> <a id="1624" href="UTxOErr.UTxO.html#500" class="Function">DATA</a><a id="1628" class="Symbol">}</a> <a id="1630" class="Symbol">{</a><a id="1631" href="UTxOErr.HoareProperties.html#1631" class="Bound">val</a> <a id="1635" class="Symbol">:</a> <a id="1637" href="UTxOErr.UTxO.html#1077" class="Record">TxInfo</a> <a id="1644" class="Symbol">→</a> <a id="1646" href="UTxOErr.UTxO.html#500" class="Function">DATA</a> <a id="1651" class="Symbol">→</a> <a id="1653" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a><a id="1657" class="Symbol">}</a> <a id="1659" class="Symbol">→</a>
  <a id="1663" href="Prelude.InferenceRules.html#56141" class="Function Operator">∙</a> <a id="1665" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="1667" class="Symbol">(</a><a id="1668" href="UTxOErr.HoareProperties.html#1631" class="Bound">val</a> <a id="1672" class="Symbol">(</a><a id="1673" href="UTxOErr.UTxO.html#1618" class="Function">mkTxInfo</a> <a id="1682" href="UTxOErr.HoareProperties.html#1563" class="Bound">tx</a><a id="1684" class="Symbol">)</a> <a id="1686" href="UTxOErr.HoareProperties.html#1618" class="Bound">rdm</a><a id="1689" class="Symbol">)</a>
  <a id="1693" href="Prelude.InferenceRules.html#56072" class="Function Operator">∙</a> <a id="1695" href="UTxOErr.HoareProperties.html#1563" class="Bound">tx</a> <a id="1698" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1700" class="Keyword">record</a> <a id="1707" class="Symbol">{</a> <a id="1709" class="Field">inputs</a>  <a id="1717" class="Symbol">=</a> <a id="1719" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="1721" class="Keyword">record</a> <a id="1728" class="Symbol">{</a><a id="1729" class="Field">outputRef</a> <a id="1739" class="Symbol">=</a> <a id="1741" href="UTxOErr.HoareProperties.html#1599" class="Bound">or</a><a id="1743" class="Symbol">;</a> <a id="1745" class="Field">validator</a> <a id="1755" class="Symbol">=</a> <a id="1757" href="UTxOErr.HoareProperties.html#1631" class="Bound">val</a><a id="1760" class="Symbol">;</a> <a id="1762" class="Field">redeemer</a> <a id="1771" class="Symbol">=</a> <a id="1773" href="UTxOErr.HoareProperties.html#1618" class="Bound">rdm</a><a id="1776" class="Symbol">}</a> <a id="1778" href="Data.List.Base.html#5034" class="Function Operator">]</a>
                <a id="1796" class="Symbol">;</a> <a id="1798" class="Field">outputs</a> <a id="1806" class="Symbol">=</a> <a id="1808" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="1810" href="UTxOErr.HoareProperties.html#1573" class="Bound">v</a> <a id="1812" href="UTxOErr.UTxO.html#794" class="InductiveConstructor Operator">at</a> <a id="1815" href="UTxOErr.HoareProperties.html#1585" class="Bound">B</a> <a id="1817" href="Data.List.Base.html#5034" class="Function Operator">]</a>
                <a id="1835" class="Symbol">;</a> <a id="1837" class="Field">forge</a>   <a id="1845" class="Symbol">=</a> <a id="1847" class="Number">0</a> <a id="1849" class="Symbol">}</a>
    <a id="1855" href="Prelude.InferenceRules.html#13602" class="Function Operator">────────────────────────────────────</a>
    <a id="1896" href="UTxOErr.HoareLogic.html#3248" class="Record Operator">ℝ⟨</a> <a id="1899" href="UTxOErr.HoareProperties.html#1599" class="Bound">or</a> <a id="1902" href="UTxOErr.HoareLogic.html#795" class="Function Operator">↦</a> <a id="1904" href="UTxOErr.HoareProperties.html#1573" class="Bound">v</a> <a id="1906" href="UTxOErr.UTxO.html#794" class="InductiveConstructor Operator">at</a> <a id="1909" class="Symbol">(</a><a id="1910" href="UTxOErr.HoareProperties.html#1631" class="Bound">val</a> <a id="1914" href="UTxOErr.UTxO.html#466" class="Postulate Operator">♯</a><a id="1915" class="Symbol">)</a> <a id="1917" href="UTxOErr.HoareLogic.html#3248" class="Record Operator">⟩</a>
    <a id="1923" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="1925" href="UTxOErr.HoareProperties.html#1563" class="Bound">tx</a> <a id="1928" href="Data.List.Base.html#5034" class="Function Operator">]</a>
    <a id="1934" href="UTxOErr.HoareLogic.html#3248" class="Record Operator">⟨</a> <a id="1936" class="Symbol">(</a><a id="1937" href="UTxOErr.HoareProperties.html#1563" class="Bound">tx</a> <a id="1940" href="UTxOErr.UTxO.html#466" class="Postulate Operator">♯</a><a id="1941" class="Symbol">)</a> <a id="1943" href="UTxOErr.UTxO.html#599" class="InductiveConstructor Operator">indexed-at</a> <a id="1954" class="Number">0</a> <a id="1956" href="UTxOErr.HoareLogic.html#795" class="Function Operator">↦</a> <a id="1958" href="UTxOErr.HoareProperties.html#1573" class="Bound">v</a> <a id="1960" href="UTxOErr.UTxO.html#794" class="InductiveConstructor Operator">at</a> <a id="1963" href="UTxOErr.HoareProperties.html#1585" class="Bound">B</a> <a id="1965" href="UTxOErr.HoareLogic.html#3248" class="Record Operator">⟩</a>
<a id="1967" href="UTxOErr.HoareProperties.html#1548" class="Function">transferℝ</a> <a id="1977" href="UTxOErr.HoareProperties.html#1977" class="Bound">val</a> <a id="1981" href="UTxOErr.HoareProperties.html#1981" class="Bound">tx≡</a> <a id="1985" class="Symbol">=</a> <a id="1987" href="UTxOErr.HoareLogic.html#3326" class="InductiveConstructor Operator">mkℝ</a> <a id="1991" href="UTxOErr.HoareProperties.html#1094" class="Function">transfer</a> <a id="2000" href="UTxOErr.HoareProperties.html#1977" class="Bound">val</a> <a id="2004" href="UTxOErr.HoareProperties.html#1981" class="Bound">tx≡</a>

<a id="2009" class="Comment">-- _↝⟨_⟩_ : ∀ A v B {vᵃ}{vᵇ}{v≤ : v ≤ vᵃ} → ⟨ A ↦ vᵃ ∗ B ↦ vᵇ ⟩ [ A —→⟨ v ⟩ B ] ⟨ A ↦ (vᵃ ∸ v) ∗ B ↦ (vᵇ + v) ⟩</a>
<a id="2121" class="Comment">-- (A ↝⟨ v ⟩ B) {vᵃ}{vᵇ}{vᵃ≤v} {s} (s₁ , s₂ , ≡s , As₁ , Bs₂)</a>
<a id="2183" class="Comment">--   with s₁ A | As₁ | ↦-⊎ˡ {s₁ = s₁}{A}{vᵃ}{s₂} As₁ | ≡s A</a>
<a id="2243" class="Comment">-- ... | .(just vᵃ) | refl | .(s₂ ⁉⁰ A) , refl , p | sA≡</a>
<a id="2300" class="Comment">--   with s₂ B | Bs₂ | ↦-⊎ʳ {s₂ = s₂}{B}{vᵇ}{s₁} Bs₂ | ≡s B</a>
<a id="2360" class="Comment">-- ... | .(just vᵇ) | refl | .(s₁ ⁉⁰ B) , refl , q | sB≡</a>
<a id="2417" class="Comment">--   with s A | trans (sym sA≡) p</a>
<a id="2451" class="Comment">-- ... | .(just (vᵃ ⊎ (s₂ ⁉⁰ A))) | refl</a>
<a id="2492" class="Comment">--   with s B | trans (sym sB≡) q</a>
<a id="2526" class="Comment">-- ... | .(just ((s₁ ⁉⁰ B) ⊎ vᵇ)) | refl</a>
<a id="2567" class="Comment">--   with v ≤? vᵃ ⊎ (s₂ ⁉⁰ A)</a>
<a id="2597" class="Comment">-- ... | no  v≰ = ⊥-elim $ v≰ $ Nat.≤-stepsʳ (s₂ ⁉⁰ A) $ vᵃ≤v</a>
<a id="2659" class="Comment">-- ... | yes v≤</a>
<a id="2675" class="Comment">--   = ret↑ (_s₁′ , _s₂′ , ≡s′ , As₁′ , Bs₂′)</a>
<a id="2721" class="Comment">--   where</a>
<a id="2732" class="Comment">--     sA≡′ : s A ≡ just (vᵃ ⊎ (s₂ ⁉⁰ A))</a>
<a id="2774" class="Comment">--     sA≡′ = trans (sym sA≡) p</a>

<a id="2807" class="Comment">--     sB≡′ : s B ≡ just ((s₁ ⁉⁰ B) ⊎ vᵇ)</a>
<a id="2849" class="Comment">--     sB≡′ = trans (sym sB≡) q</a>

<a id="2882" class="Comment">--     _s₁′ = s₁ [ A ↝ (_∸ v) ]</a>
<a id="2914" class="Comment">--     _s₂′ = s₂ [ B ↝ (_+ v) ]</a>

<a id="2947" class="Comment">--     _s′ = s [ A ↝ (_∸ v) ]</a>
<a id="2977" class="Comment">--             [ B ↝ (_+ v) ]</a>

<a id="3008" class="Comment">--     As₁′ : _s₁′ A ≡ just (vᵃ ∸ v)</a>
<a id="3045" class="Comment">--     As₁′ rewrite As₁ | ≟-refl A = refl</a>

<a id="3088" class="Comment">--     Bs₂′ : _s₂′ B ≡ just (vᵇ + v)</a>
<a id="3125" class="Comment">--     Bs₂′ rewrite Bs₂ | ≟-refl B = refl</a>

<a id="3168" class="Comment">--     ≡s′ : ⟨ _s₁′ ⊎ _s₂′ ⟩≡ _s′</a>
<a id="3202" class="Comment">--     ≡s′ k</a>
<a id="3215" class="Comment">--       rewrite sym $ ≡s k</a>
<a id="3243" class="Comment">--       with k ≟ A | k ≟ B</a>
<a id="3271" class="Comment">--     ≡s′ k | yes refl | yes refl -- ∙ k ≡ A ≡ B</a>
<a id="3321" class="Comment">--       rewrite ≟-refl A | ≟-refl B | As₁ | Bs₂</a>
<a id="3370" class="Comment">--       = cong just</a>
<a id="3391" class="Comment">--       $ begin (vᵃ ∸ v) + (vᵇ + v) ≡⟨ sym $ Nat.+-∸-comm _ vᵃ≤v ⟩</a>
<a id="3459" class="Comment">--               vᵃ + (vᵇ + v) ∸ v   ≡⟨ cong (_∸ v) $ sym $ Nat.+-assoc _ vᵇ v ⟩</a>
<a id="3540" class="Comment">--               (vᵃ + vᵇ) + v ∸ v   ≡⟨ Nat.m+n∸n≡m _ v ⟩</a>
<a id="3598" class="Comment">--               (vᵃ + vᵇ)           ≡⟨ sym $ Nat.m∸n+n≡m v≤ ⟩</a>
<a id="3661" class="Comment">--               (vᵃ + vᵇ) ∸ v + v   ∎ where open ≡-Reasoning</a>
<a id="3723" class="Comment">--     ≡s′ k | yes refl | no k≢B -- ∙ k ≡ A</a>
<a id="3767" class="Comment">--       rewrite ≟-refl A | As₁</a>
<a id="3799" class="Comment">--       with s₂ A</a>
<a id="3818" class="Comment">--     ... | nothing = refl</a>
<a id="3846" class="Comment">--     ... | just _  = cong just $ sym $ Nat.+-∸-comm _ vᵃ≤v</a>
<a id="3907" class="Comment">--     ≡s′ k | no k≢A   | yes refl -- ∙ k ≡ B</a>
<a id="3953" class="Comment">--       rewrite ≟-refl B | Bs₂</a>
<a id="3985" class="Comment">--       with s₁ B</a>
<a id="4004" class="Comment">--     ... | nothing  = refl</a>
<a id="4033" class="Comment">--     ... | just _   = cong just $ sym $ Nat.+-assoc _ vᵇ v</a>
<a id="4094" class="Comment">--     ≡s′ k | no k≢A   | no k≢B -- ∙ k ∉ {A, B}</a>
<a id="4143" class="Comment">--       rewrite M.map-id (s₁ k) | M.map-id (s₂ k) | M.map-id (s₁ k ⊎ s₂ k) | M.map-id (s₁ k ⊎ s₂ k)</a>
<a id="4244" class="Comment">--       = refl</a>

<a id="4261" class="Comment">-- _↝⁰_ : ∀ A B → ⟨ A ↦ v ∗ B ↦ v′ ⟩ [ A —→⟨ v ⟩ B ] ⟨ A ↦ 0 ∗ B ↦ (v′ + v) ⟩</a>
<a id="4339" class="Comment">-- _↝⁰_ {v = v} {v′ = v′} A B with p ← (A ↝⟨ v ⟩ B) {vᵇ = v′} {v≤ = ≤-refl {x = v}} rewrite Nat.n∸n≡0 v = p</a>

<a id="4448" class="Comment">-- _↜⟨_⟩_ : ∀ A v B {vᵃ}{vᵇ}{v≤ : v ≤ vᵇ} → ⟨ A ↦ vᵃ ∗ B ↦ vᵇ ⟩ [ B —→⟨ v ⟩ A ] ⟨ A ↦ (vᵃ + v) ∗ B ↦ (vᵇ ∸ v) ⟩</a>
<a id="4560" class="Comment">-- (A ↜⟨ v ⟩ B) {vᵃ}{vᵇ}{v≤} (s₁ , s₂ , ≡s , As₁ , Bs₂)</a>
<a id="4616" class="Comment">--   = map↑ (λ where (s₁′ , s₂′ , ≡s′ , As₁′ , Bs₂′) → s₂′ , s₁′ , ⊎≡-comm {x = s₁′} ≡s′ , Bs₂′ , As₁′)</a>
<a id="4720" class="Comment">--          ((B ↝⟨ v ⟩ A) {v≤ = v≤} (s₂ , s₁ , ⊎≡-comm {x = s₁} ≡s , Bs₂ , As₁))</a>

<a id="4802" class="Comment">-- _↜⁰_ : ∀ A B → ⟨ A ↦ v′ ∗ B ↦ v ⟩ [ B —→⟨ v ⟩ A ] ⟨ A ↦ (v′ + v) ∗ B ↦ 0 ⟩</a>
<a id="4880" class="Comment">-- _↜⁰_ {v′ = v′} {v = v} A B with p ← (A ↜⟨ v ⟩ B) {vᵃ = v′} {v≤ = ≤-refl {x = v}} rewrite Nat.n∸n≡0 v = p</a>
</pre></body></html>